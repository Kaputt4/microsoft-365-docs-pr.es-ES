---
title: Configurar la clave de cliente
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: Obtenga información sobre cómo configurar la clave de cliente de Microsoft 365 para Exchange Online, Skype empresarial, SharePoint Online, OneDrive para la empresa y los archivos de Teams.
ms.openlocfilehash: c9c02f697e04a5cd01ddce1546b6712091712025
ms.sourcegitcommit: 2614f8b81b332f8dab461f4f64f3adaa6703e0d6
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/21/2020
ms.locfileid: "43634202"
---
# <a name="set-up-customer-key"></a><span data-ttu-id="ad799-103">Configurar la clave de cliente</span><span class="sxs-lookup"><span data-stu-id="ad799-103">Set up Customer Key</span></span>

<span data-ttu-id="ad799-104">Con la clave de cliente, se controlan las claves de cifrado de la organización y, a continuación, se configura Microsoft 365 para usarlas para cifrar los datos en reposo en los centros de datos de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ad799-104">With Customer Key, you control your organization's encryption keys and then configure Microsoft 365 to use them to encrypt your data at rest in Microsoft's data centers.</span></span> <span data-ttu-id="ad799-105">Es decir, la clave de cliente permite a los clientes agregar una capa de cifrado que les pertenece, con sus claves.</span><span class="sxs-lookup"><span data-stu-id="ad799-105">In other words, Customer Key allows customers to add a layer of encryption that belongs to them, with their keys.</span></span> <span data-ttu-id="ad799-106">Los datos en reposo incluyen datos de Exchange Online y Skype Empresarial que se almacenan en buzones y archivos en SharePoint Online y OneDrive para la Empresa.</span><span class="sxs-lookup"><span data-stu-id="ad799-106">Data at rest includes data from Exchange Online and Skype for Business that is stored in mailboxes and files that are stored in SharePoint Online and OneDrive for Business.</span></span>

<span data-ttu-id="ad799-107">Debe configurar Azure antes de poder usar la clave de cliente de Office 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-107">You must set up Azure before you can use Customer Key for Office 365.</span></span> <span data-ttu-id="ad799-108">En este tema se describen los pasos que debe seguir para crear y configurar los recursos necesarios de Azure y, a continuación, se proporcionan los pasos para configurar la clave de cliente en Office 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-108">This topic describes the steps you need to follow to create and configure the required Azure resources and then provides the steps for setting up Customer Key in Office 365.</span></span> <span data-ttu-id="ad799-109">Una vez completada la configuración de Azure, determine qué directivas y, por lo tanto, qué claves asignar a los buzones de correo y los archivos de su organización.</span><span class="sxs-lookup"><span data-stu-id="ad799-109">After you have completed Azure setup, you determine which policy, and therefore, which keys, to assign to mailboxes and files in your organization.</span></span> <span data-ttu-id="ad799-110">Los buzones de correo y los archivos para los que no se asigna una directiva usarán directivas de cifrado controladas y administradas por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ad799-110">Mailboxes and files for which you don't assign a policy will use encryption policies that are controlled and managed by Microsoft.</span></span> <span data-ttu-id="ad799-111">Para obtener más información acerca de la clave de cliente o para obtener información general, consulte [Service Encryption with Customer key in Office 365](customer-key-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ad799-111">For more information about Customer Key, or for a general overview, see [Service encryption with Customer Key in Office 365](customer-key-overview.md).</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="ad799-112">Se recomienda encarecidamente seguir los procedimientos recomendados de este tema.</span><span class="sxs-lookup"><span data-stu-id="ad799-112">We strongly recommend that you follow the best practices in this topic.</span></span> <span data-ttu-id="ad799-113">Se les llama como **Tip** e **Important**.</span><span class="sxs-lookup"><span data-stu-id="ad799-113">These are called out as **TIP** and **IMPORTANT**.</span></span> <span data-ttu-id="ad799-114">La clave de cliente le da control sobre las claves de cifrado raíz cuyo ámbito puede ser tan grande como toda la organización.</span><span class="sxs-lookup"><span data-stu-id="ad799-114">Customer Key gives you control over root encryption keys whose scope can be as large as your entire organization.</span></span> <span data-ttu-id="ad799-115">Esto significa que los errores realizados con estas claves pueden tener un gran impacto y pueden dar lugar a interrupciones en el servicio o la pérdida irrevocable de los datos.</span><span class="sxs-lookup"><span data-stu-id="ad799-115">This means that mistakes made with these keys can have a broad impact and may result in service interruptions or irrevocable loss of your data.</span></span>
  
## <a name="before-you-set-up-customer-key"></a><span data-ttu-id="ad799-116">Antes de configurar la clave de cliente</span><span class="sxs-lookup"><span data-stu-id="ad799-116">Before you set up Customer Key</span></span>

<span data-ttu-id="ad799-117">Antes de empezar, asegúrese de que dispone de la licencia adecuada para su organización.</span><span class="sxs-lookup"><span data-stu-id="ad799-117">Before you get started, ensure that you have the appropriate licensing for your organization.</span></span> <span data-ttu-id="ad799-118">La clave de cliente de Microsoft 365 se ofrece en Office 365 E5 o en la SKU de cumplimiento avanzada.</span><span class="sxs-lookup"><span data-stu-id="ad799-118">Customer Key in Microsoft 365 is offered in Office 365 E5 or the Advanced Compliance SKU.</span></span> <span data-ttu-id="ad799-119">Para comprender los conceptos y procedimientos de este tema, revise la documentación de [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/) .</span><span class="sxs-lookup"><span data-stu-id="ad799-119">To understand the concepts and procedures in this topic, review the [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/) documentation.</span></span> <span data-ttu-id="ad799-120">Además, familiarícese con los términos que se usan en Azure, por ejemplo, [tenant](https://docs.microsoft.com/previous-versions/azure/azure-services/jj573650(v=azure.100)).</span><span class="sxs-lookup"><span data-stu-id="ad799-120">Also, become familiar with the terms used in Azure, for example, [tenant](https://docs.microsoft.com/previous-versions/azure/azure-services/jj573650(v=azure.100)).</span></span>

<span data-ttu-id="ad799-121">FastTrack solo se usa para recopilar la información de configuración de servicio y el inquilino necesario que se usa para registrar la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-121">FastTrack is only used to collect the required tenant and service configuration information used to register for Customer Key.</span></span> <span data-ttu-id="ad799-122">Las ofertas de clave de cliente se publican a través de FastTrack para que sea conveniente para usted y para nuestros partners enviar la información necesaria con el mismo método.</span><span class="sxs-lookup"><span data-stu-id="ad799-122">The Customer Key Offers are published via FastTrack so that it is convenient for you and our partners to submit the required information using the same method.</span></span> <span data-ttu-id="ad799-123">FastTrack también facilita el archivado de los datos facilitados en la oferta.</span><span class="sxs-lookup"><span data-stu-id="ad799-123">FastTrack also makes it easy to archive the data that you provide in the Offer.</span></span>
  
<span data-ttu-id="ad799-124">Si necesita más información sobre la documentación, póngase en contacto con los servicios de consultoría de Microsoft (MCS), el servicio de ingeniería de campo (PFE) de Premier o un socio de Microsoft para obtener ayuda.</span><span class="sxs-lookup"><span data-stu-id="ad799-124">If you need additional support beyond the documentation, contact Microsoft Consulting Services (MCS), Premier Field Engineering (PFE), or a Microsoft partner for assistance.</span></span> <span data-ttu-id="ad799-125">Para proporcionar comentarios sobre la clave de cliente, incluida la documentación, envíe sus ideas, sugerencias y perspectivas a customerkeyfeedback@microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="ad799-125">To provide feedback on Customer Key, including the documentation, send your ideas, suggestions, and perspectives to customerkeyfeedback@microsoft.com.</span></span>
  
## <a name="overview-of-steps-to-set-up-customer-key"></a><span data-ttu-id="ad799-126">Información general sobre los pasos para configurar la clave de cliente</span><span class="sxs-lookup"><span data-stu-id="ad799-126">Overview of steps to set up Customer Key</span></span>

<span data-ttu-id="ad799-127">Para configurar la clave de cliente, complete estas tareas en el orden indicado.</span><span class="sxs-lookup"><span data-stu-id="ad799-127">To set up Customer Key, complete these tasks in the listed order.</span></span> <span data-ttu-id="ad799-128">En el resto de este artículo se proporcionan instrucciones detalladas para cada tarea o vínculos a más información para cada paso del proceso.</span><span class="sxs-lookup"><span data-stu-id="ad799-128">The rest of this article provides detailed instructions for each task, or links out to more information for each step in the process.</span></span>
  
<span data-ttu-id="ad799-129">**En Azure y Microsoft FastTrack:**</span><span class="sxs-lookup"><span data-stu-id="ad799-129">**In Azure and Microsoft FastTrack:**</span></span>
  
<span data-ttu-id="ad799-130">Completará la mayoría de estas tareas conectándose de forma remota a Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-130">You will complete most of these tasks by remotely connecting to Azure PowerShell.</span></span> <span data-ttu-id="ad799-131">Para obtener los mejores resultados, use la versión 4.4.0 o posterior de Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-131">For best results, use version 4.4.0 or later of Azure PowerShell.</span></span>
  
- [<span data-ttu-id="ad799-132">Crear dos nuevas suscripciones de Azure</span><span class="sxs-lookup"><span data-stu-id="ad799-132">Create two new Azure subscriptions</span></span>](#create-two-new-azure-subscriptions)

- [<span data-ttu-id="ad799-133">Registrar suscripciones de Azure para usar un período de retención obligatorio</span><span class="sxs-lookup"><span data-stu-id="ad799-133">Register Azure subscriptions to use a mandatory retention period</span></span>](#register-azure-subscriptions-to-use-a-mandatory-retention-period)

  <span data-ttu-id="ad799-134">El registro puede tardar de uno a cinco días hábiles.</span><span class="sxs-lookup"><span data-stu-id="ad799-134">Registration can take from one to five business days.</span></span>

- [<span data-ttu-id="ad799-135">Enviar una solicitud para activar la clave de cliente de Office 365</span><span class="sxs-lookup"><span data-stu-id="ad799-135">Submit a request to activate Customer Key for Office 365</span></span>](#submit-a-request-to-activate-customer-key-for-office-365)

<span data-ttu-id="ad799-136">Una vez que haya creado las dos nuevas suscripciones de Azure, deberá enviar la solicitud de oferta de la clave de cliente correspondiente completando un formulario web hospedado en el portal de Microsoft FastTrack.</span><span class="sxs-lookup"><span data-stu-id="ad799-136">Once you've created the two new Azure subscriptions, you'll need to submit the appropriate Customer Key offer request by completing a web form that is hosted in the Microsoft FastTrack portal.</span></span> <span data-ttu-id="ad799-137">**El equipo de FastTrack no proporciona asistencia con la clave de cliente. Office simplemente usa el portal de FastTrack para permitirle enviar el formulario y ayudar a hacer un seguimiento de las ofertas relevantes para la clave de cliente**.</span><span class="sxs-lookup"><span data-stu-id="ad799-137">**The FastTrack team doesn't provide assistance with Customer Key. Office simply uses the FastTrack portal to allow you to submit the form and to help us track the relevant offers for Customer Key**.</span></span>

- [<span data-ttu-id="ad799-138">Crear un almacén de claves Premium de Azure en cada suscripción</span><span class="sxs-lookup"><span data-stu-id="ad799-138">Create a premium Azure Key Vault in each subscription</span></span>](#create-a-premium-azure-key-vault-in-each-subscription)

- [<span data-ttu-id="ad799-139">Asignar permisos a cada almacén clave</span><span class="sxs-lookup"><span data-stu-id="ad799-139">Assign permissions to each key vault</span></span>](#assign-permissions-to-each-key-vault)

- [<span data-ttu-id="ad799-140">Habilitar y, a continuación, confirmar la eliminación de software en los depósitos clave</span><span class="sxs-lookup"><span data-stu-id="ad799-140">Enable and then confirm soft delete on your key vaults</span></span>](#enable-and-then-confirm-soft-delete-on-your-key-vaults)

- [<span data-ttu-id="ad799-141">Agregar una clave a cada depósito clave creando o importando una clave</span><span class="sxs-lookup"><span data-stu-id="ad799-141">Add a key to each key vault either by creating or importing a key</span></span>](#add-a-key-to-each-key-vault-either-by-creating-or-importing-a-key)

- [<span data-ttu-id="ad799-142">Comprobar el nivel de recuperación de las claves</span><span class="sxs-lookup"><span data-stu-id="ad799-142">Check the recovery level of your keys</span></span>](#check-the-recovery-level-of-your-keys)

- [<span data-ttu-id="ad799-143">Copia de seguridad de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ad799-143">Back up Azure Key Vault</span></span>](#back-up-azure-key-vault)

- [<span data-ttu-id="ad799-144">Validar las opciones de configuración de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ad799-144">Validate Azure Key Vault configuration settings</span></span>](#validate-azure-key-vault-configuration-settings)

- [<span data-ttu-id="ad799-145">Obtener el URI para cada clave de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ad799-145">Obtain the URI for each Azure Key Vault key</span></span>](#obtain-the-uri-for-each-azure-key-vault-key)

<span data-ttu-id="ad799-146">**En Office 365:**</span><span class="sxs-lookup"><span data-stu-id="ad799-146">**In Office 365:**</span></span>
  
<span data-ttu-id="ad799-147">Exchange Online y Skype empresarial:</span><span class="sxs-lookup"><span data-stu-id="ad799-147">Exchange Online and Skype for Business:</span></span>
  
- [<span data-ttu-id="ad799-148">Crear una directiva de cifrado de datos (DEP) para su uso con Exchange Online y Skype empresarial</span><span class="sxs-lookup"><span data-stu-id="ad799-148">Create a data encryption policy (DEP) for use with Exchange Online and Skype for Business</span></span>](#create-a-data-encryption-policy-dep-for-use-with-exchange-online-and-skype-for-business)

- [<span data-ttu-id="ad799-149">Asignar una DEP a un buzón</span><span class="sxs-lookup"><span data-stu-id="ad799-149">Assign a DEP to a mailbox</span></span>](#assign-a-dep-to-a-mailbox)

- [<span data-ttu-id="ad799-150">Validar el cifrado de buzones</span><span class="sxs-lookup"><span data-stu-id="ad799-150">Validate mailbox encryption</span></span>](#validate-mailbox-encryption)

<span data-ttu-id="ad799-151">SharePoint Online y OneDrive para la empresa:</span><span class="sxs-lookup"><span data-stu-id="ad799-151">SharePoint Online and OneDrive for Business:</span></span>
  
- [<span data-ttu-id="ad799-152">Crear una directiva de cifrado de datos (DEP) para cada geográfico de SharePoint Online y OneDrive para la empresa</span><span class="sxs-lookup"><span data-stu-id="ad799-152">Create a data encryption policy (DEP) for each SharePoint Online and OneDrive for Business geo</span></span>](#create-a-data-encryption-policy-dep-for-each-sharepoint-online-and-onedrive-for-business-geo)

- [<span data-ttu-id="ad799-153">Validar el cifrado de archivos para los archivos de SharePoint Online, OneDrive para la empresa y Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="ad799-153">Validate file encryption for SharePoint Online, OneDrive for Business, and Teams files</span></span>](#validate-file-encryption)

## <a name="complete-tasks-in-azure-key-vault-and-microsoft-fasttrack-for-customer-key"></a><span data-ttu-id="ad799-154">Completar las tareas en Azure Key Vault y Microsoft FastTrack para la clave de cliente</span><span class="sxs-lookup"><span data-stu-id="ad799-154">Complete tasks in Azure Key Vault and Microsoft FastTrack for Customer Key</span></span>

<span data-ttu-id="ad799-155">Complete estas tareas en Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ad799-155">Complete these tasks in Azure Key Vault.</span></span> <span data-ttu-id="ad799-156">Deberá completar estos pasos independientemente de si desea configurar la clave de cliente para los archivos de Exchange Online y Skype empresarial o para SharePoint Online, OneDrive para la empresa y Teams, o para todos los servicios admitidos en Office 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-156">You will need to complete these steps regardless of whether you intend to set up Customer Key for Exchange Online and Skype for Business or for SharePoint Online, OneDrive for Business, and Teams files, or for all supported services in Office 365.</span></span>
  
### <a name="create-two-new-azure-subscriptions"></a><span data-ttu-id="ad799-157">Crear dos nuevas suscripciones de Azure</span><span class="sxs-lookup"><span data-stu-id="ad799-157">Create two new Azure subscriptions</span></span>

<span data-ttu-id="ad799-158">La clave de cliente requiere dos suscripciones de Azure.</span><span class="sxs-lookup"><span data-stu-id="ad799-158">Customer Key requires two Azure subscriptions.</span></span> <span data-ttu-id="ad799-159">Como práctica recomendada, Microsoft recomienda crear nuevas suscripciones de Azure para usarlas con la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-159">As a best practice, Microsoft recommends that you create new Azure subscriptions for use with Customer Key.</span></span> <span data-ttu-id="ad799-160">Las claves de Azure Key Vault solo pueden estar autorizadas para aplicaciones en el mismo inquilino de Azure Active Directory (AAD), debe crear las nuevas suscripciones con el mismo inquilino de Azure AD que se usa con la organización y al que se asignará la DEPs.</span><span class="sxs-lookup"><span data-stu-id="ad799-160">Azure Key Vault keys can only be authorized for applications in the same Azure Active Directory (AAD) tenant, you must create the new subscriptions using the same Azure AD tenant used with your organization where the DEPs will be assigned.</span></span> <span data-ttu-id="ad799-161">Por ejemplo, con su cuenta profesional o educativa con privilegios de administrador global en su organización.</span><span class="sxs-lookup"><span data-stu-id="ad799-161">For example, using your work or school account that has global administrator privileges in your organization.</span></span> <span data-ttu-id="ad799-162">Para obtener los pasos detallados, consulte [registrarse para Azure como organización](https://azure.microsoft.com/documentation/articles/sign-up-organization/).</span><span class="sxs-lookup"><span data-stu-id="ad799-162">For detailed steps, see [Sign up for Azure as an organization](https://azure.microsoft.com/documentation/articles/sign-up-organization/).</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="ad799-163">La clave de cliente requiere dos claves para cada directiva de cifrado de datos (DEP).</span><span class="sxs-lookup"><span data-stu-id="ad799-163">Customer Key requires two keys for each data encryption policy (DEP).</span></span> <span data-ttu-id="ad799-164">Para ello, debe crear dos suscripciones de Azure.</span><span class="sxs-lookup"><span data-stu-id="ad799-164">In order to achieve this, you must create two Azure subscriptions.</span></span> <span data-ttu-id="ad799-165">Como procedimiento recomendado, Microsoft recomienda que los miembros de la organización se configuren como una clave en cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="ad799-165">As a best practice, Microsoft recommends that you have separate members of your organization configure one key in each subscription.</span></span> <span data-ttu-id="ad799-166">Además, estas suscripciones de Azure solo deben usarse para administrar claves de cifrado para Office 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-166">In addition, these Azure subscriptions should only be used to administer encryption keys for Office 365.</span></span> <span data-ttu-id="ad799-167">Esto protege a su organización en caso de que uno de sus operadores elimine accidentalmente, de forma intencionada, o de una mala administración de las claves de las que es responsable.</span><span class="sxs-lookup"><span data-stu-id="ad799-167">This protects your organization in case one of your operators accidentally, intentionally, or maliciously deletes or otherwise mismanages the keys for which they are responsible.</span></span> <br/> <span data-ttu-id="ad799-168">Le recomendamos que configure nuevas suscripciones de Azure que solo se usan para administrar recursos de Azure Key Vault para usarlas con la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-168">We recommend that you set up new Azure subscriptions that are solely used for managing Azure Key Vault resources for use with Customer Key.</span></span> <span data-ttu-id="ad799-169">No hay ningún límite práctico en el número de suscripciones de Azure que puede crear para su organización.</span><span class="sxs-lookup"><span data-stu-id="ad799-169">There is no practical limit to the number of Azure subscriptions that you can create for your organization.</span></span> <span data-ttu-id="ad799-170">Siga estos procedimientos recomendados para minimizar el impacto de los errores humanos mientras ayuda a administrar los recursos usados por la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-170">Following these best practices will minimize the impact of human error while helping to manage the resources used by Customer Key.</span></span>
  
### <a name="submit-a-request-to-activate-customer-key-for-office-365"></a><span data-ttu-id="ad799-171">Enviar una solicitud para activar la clave de cliente de Office 365</span><span class="sxs-lookup"><span data-stu-id="ad799-171">Submit a request to activate Customer Key for Office 365</span></span>

<span data-ttu-id="ad799-172">Una vez que haya completado los pasos de Azure, tendrá que enviar una solicitud de oferta en el [portal de Microsoft FastTrack](https://fasttrack.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="ad799-172">Once you've completed the Azure steps, you'll need to submit an offer request in the [Microsoft FastTrack portal](https://fasttrack.microsoft.com/).</span></span> <span data-ttu-id="ad799-173">Una vez que haya enviado una solicitud a través del portal web FastTrack, Microsoft comprueba los datos de configuración de Azure Key Vault y la información de contacto que ha proporcionado.</span><span class="sxs-lookup"><span data-stu-id="ad799-173">Once you have submitted a request through the FastTrack web portal, Microsoft verifies the Azure Key Vault configuration data and contact information you provided.</span></span> <span data-ttu-id="ad799-174">Las selecciones que realice en el formulario de oferta en relación con los agentes autorizados de su organización son críticas y necesarias para completar el registro de la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-174">The selections that you make in the offer form regarding the authorized officers of your organization is critical and necessary for completion of Customer Key registration.</span></span> <span data-ttu-id="ad799-175">Los agentes de la organización que seleccione en el formulario se usarán para garantizar la autenticidad de cualquier solicitud de revocar y destruir todas las claves utilizadas con una directiva de clave de cifrado de datos de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-175">The officers of your organization that you select in the form will be the used to ensure the authenticity of any request to revoke and destroy all keys used with a Customer Key data encryption policy.</span></span> <span data-ttu-id="ad799-176">Deberá realizar este paso una vez para activar la cobertura del cliente para la cobertura de Exchange Online y Skype empresarial, y una segunda vez para activar la clave de cliente de SharePoint Online y OneDrive para la empresa.</span><span class="sxs-lookup"><span data-stu-id="ad799-176">You'll need to do this step once to activate Customer Key for Exchange Online and Skype for Business coverage and a second time to activate Customer Key for SharePoint Online and OneDrive for Business.</span></span>
  
<span data-ttu-id="ad799-177">Para enviar una oferta para activar la clave de cliente, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="ad799-177">To submit an offer to activate Customer Key, complete these steps:</span></span>
  
1. <span data-ttu-id="ad799-178">Con una cuenta profesional o educativa que tenga permisos de administrador global en su organización, inicie sesión en el [portal de Microsoft FastTrack](https://fasttrack.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="ad799-178">Using a work or school account that has global administrator permissions in your organization, log in to the [Microsoft FastTrack portal](https://fasttrack.microsoft.com/).</span></span>

2. <span data-ttu-id="ad799-179">Una vez que haya iniciado sesión, vaya al **Panel**.</span><span class="sxs-lookup"><span data-stu-id="ad799-179">Once you're logged in, browse to the **Dashboard**.</span></span>

3. <span data-ttu-id="ad799-180">Elija **ofertas**y revise la lista de ofertas actuales.</span><span class="sxs-lookup"><span data-stu-id="ad799-180">Choose **Offers**, and review the list of current offers.</span></span>

4. <span data-ttu-id="ad799-181">Elija más **información** para la oferta que se le aplique:</span><span class="sxs-lookup"><span data-stu-id="ad799-181">Choose **Learn More** for the offer that applies to you:</span></span>

   - <span data-ttu-id="ad799-182">**Exchange Online y Skype empresarial:** Elija más **información** en la **clave de cliente de la oferta de Exchange** .</span><span class="sxs-lookup"><span data-stu-id="ad799-182">**Exchange Online and Skype for Business:** Choose **Learn More** on the **Customer Key for Exchange** offer.</span></span>

   - <span data-ttu-id="ad799-183">**Archivos de SharePoint Online, OneDrive para la empresa y Microsoft Teams:** Elija más **información** sobre la oferta de **clave de cliente para SharePoint y OneDrive para la empresa** .</span><span class="sxs-lookup"><span data-stu-id="ad799-183">**SharePoint Online, OneDrive for Business, and Teams files:** Choose **Learn More** on the **Customer Key for SharePoint and OneDrive for Business** offer.</span></span>

5. <span data-ttu-id="ad799-184">En la página Detalles de la **oferta** , elija **crear solicitud**.</span><span class="sxs-lookup"><span data-stu-id="ad799-184">On the **Offer details** page, choose **Create Request**.</span></span>

6. <span data-ttu-id="ad799-185">Rellene todos los detalles aplicables y la información solicitada en el formulario de oferta.</span><span class="sxs-lookup"><span data-stu-id="ad799-185">Fill out all applicable details and requested information on the offer form.</span></span> <span data-ttu-id="ad799-186">Preste especial atención a las selecciones de los funcionarios de su organización a los que desea conceder autorización para aprobar la destrucción permanente e irreversible de claves de cifrado y datos.</span><span class="sxs-lookup"><span data-stu-id="ad799-186">Pay particular attention to your selections for which officers of your organization you want to authorize to approve the permanent and irreversible destruction of encryption keys and data.</span></span> <span data-ttu-id="ad799-187">Una vez que haya completado el formulario, elija **Enviar**.</span><span class="sxs-lookup"><span data-stu-id="ad799-187">Once you've completed the form, choose **Submit**.</span></span>

### <a name="register-azure-subscriptions-to-use-a-mandatory-retention-period"></a><span data-ttu-id="ad799-188">Registrar suscripciones de Azure para usar un período de retención obligatorio</span><span class="sxs-lookup"><span data-stu-id="ad799-188">Register Azure subscriptions to use a mandatory retention period</span></span>

<span data-ttu-id="ad799-189">La pérdida temporal o permanente de las claves de cifrado raíz puede ser muy disruptiva o incluso catastróficas para el funcionamiento del servicio y puede provocar la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="ad799-189">The temporary or permanent loss of root encryption keys can be very disruptive or even catastrophic to service operation and can result in data loss.</span></span> <span data-ttu-id="ad799-190">Por este motivo, los recursos usados con la clave de cliente requieren una protección segura.</span><span class="sxs-lookup"><span data-stu-id="ad799-190">For this reason, the resources used with Customer Key require strong protection.</span></span> <span data-ttu-id="ad799-191">Todos los recursos de Azure que se usan con la clave de cliente ofrecen mecanismos de protección más allá de la configuración predeterminada.</span><span class="sxs-lookup"><span data-stu-id="ad799-191">All the Azure resources that are used with Customer Key offer protection mechanisms beyond the default configuration.</span></span> <span data-ttu-id="ad799-192">Las suscripciones de Azure se pueden etiquetar o registrar de manera que se evite la cancelación inmediata y irrevocable.</span><span class="sxs-lookup"><span data-stu-id="ad799-192">Azure subscriptions can be tagged or registered in a way that will prevent immediate and irrevocable cancellation.</span></span> <span data-ttu-id="ad799-193">Esto se conoce como registro de un período de retención obligatorio.</span><span class="sxs-lookup"><span data-stu-id="ad799-193">This is referred to as registering for a mandatory retention period.</span></span> <span data-ttu-id="ad799-194">Los pasos necesarios para registrar las suscripciones de Azure durante un período de retención obligatorio requieren la colaboración con el equipo de Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-194">The steps required to register Azure subscriptions for a mandatory retention period require collaboration with the Microsoft 365 team.</span></span> <span data-ttu-id="ad799-195">Este proceso puede tardar de uno a cinco días laborables.</span><span class="sxs-lookup"><span data-stu-id="ad799-195">This process can take from one to five business days.</span></span> <span data-ttu-id="ad799-196">Anteriormente, a veces se hacía referencia a esto como "no cancelar".</span><span class="sxs-lookup"><span data-stu-id="ad799-196">Previously, this was sometimes referred to as "Do Not Cancel".</span></span>
  
<span data-ttu-id="ad799-197">Antes de ponerse en contacto con el equipo de Microsoft 365, debe realizar los siguientes pasos para cada suscripción de Azure que use con la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-197">Before contacting the Microsoft 365 team, you must perform the following steps for each Azure subscription that you use with Customer Key.</span></span> <span data-ttu-id="ad799-198">Asegúrese de que tiene instalado el módulo de [Azure PowerShell AZ](https://docs.microsoft.com/powershell/azure/new-azureps-module-az) antes de empezar.</span><span class="sxs-lookup"><span data-stu-id="ad799-198">Ensure that you have the [Azure PowerShell Az](https://docs.microsoft.com/powershell/azure/new-azureps-module-az) module installed before you start.</span></span>
  
1. <span data-ttu-id="ad799-199">Inicie sesión con Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-199">Sign in with Azure PowerShell.</span></span> <span data-ttu-id="ad799-200">Para obtener instrucciones, vea [iniciar sesión con Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span><span class="sxs-lookup"><span data-stu-id="ad799-200">For instructions, see [Sign in with Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span></span>

2. <span data-ttu-id="ad799-201">Ejecute el cmdlet Register-AzProviderFeature para registrar sus suscripciones para usar un período de retención obligatorio.</span><span class="sxs-lookup"><span data-stu-id="ad799-201">Run the Register-AzProviderFeature cmdlet to register your subscriptions to use a mandatory retention period.</span></span> <span data-ttu-id="ad799-202">Realice esta acción para cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="ad799-202">Perform this action for each subscription.</span></span>

   ```powershell
   Set-AzContext -SubscriptionId <SubscriptionId>
   Register-AzProviderFeature -FeatureName mandatoryRetentionPeriodEnabled -ProviderNamespace Microsoft.KeyVault
   ```

3. <span data-ttu-id="ad799-203">Póngase en contacto con Microsoft para finalizar el proceso.</span><span class="sxs-lookup"><span data-stu-id="ad799-203">Contact Microsoft to have the process finalized.</span></span> <span data-ttu-id="ad799-204">Para el equipo de SharePoint y OneDrive para la empresa, póngase en contacto con [Spock@microsoft.com](mailto:spock@microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="ad799-204">For the SharePoint and OneDrive for Business team, contact [spock@microsoft.com](mailto:spock@microsoft.com).</span></span> <span data-ttu-id="ad799-205">Para Exchange Online y Skype empresarial, póngase en contacto con [exock@microsoft.com](mailto:exock@microsoft.com).</span><span class="sxs-lookup"><span data-stu-id="ad799-205">For Exchange Online and Skype for Business, contact [exock@microsoft.com](mailto:exock@microsoft.com).</span></span> <span data-ttu-id="ad799-206">Incluya lo siguiente en su correo electrónico:</span><span class="sxs-lookup"><span data-stu-id="ad799-206">Include the following in your email:</span></span>

   <span data-ttu-id="ad799-207">**Asunto**: clave del cliente \<para *el nombre de dominio completo del espacio empresarial*\></span><span class="sxs-lookup"><span data-stu-id="ad799-207">**Subject**: Customer Key for \<*Your tenant's fully-qualified domain name*\></span></span>

   <span data-ttu-id="ad799-208">**Cuerpo**: identificadores de suscripción para los que desea finalizar el período de retención obligatorio.</span><span class="sxs-lookup"><span data-stu-id="ad799-208">**Body**: Subscription IDs for which you want to have the mandatory retention period finalized.</span></span>
   <span data-ttu-id="ad799-209">El resultado de Get-AzProviderFeature para cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="ad799-209">The output of Get-AzProviderFeature for each subscription.</span></span>

   <span data-ttu-id="ad799-210">El contrato de nivel de servicio (SLA) para completar este proceso es cinco días hábiles después de que Microsoft haya notificado (y comprobado) que ha registrado sus suscripciones para usar un período de retención obligatorio.</span><span class="sxs-lookup"><span data-stu-id="ad799-210">The Service Level Agreement (SLA) for completion of this process is five business days once Microsoft has been notified (and verified) that you have registered your subscriptions to use a mandatory retention period.</span></span>

4. <span data-ttu-id="ad799-211">Una vez que reciba la notificación de Microsoft de que se ha completado el registro, compruebe el estado del registro ejecutando el comando Get-AzProviderFeature de la siguiente manera.</span><span class="sxs-lookup"><span data-stu-id="ad799-211">Once you receive notification from Microsoft that registration is complete, verify the status of your registration by running the Get-AzProviderFeature command as follows.</span></span> <span data-ttu-id="ad799-212">Si se comprueba, el comando Get-AzProviderFeature devuelve un valor de **registrado** para la propiedad de **Estado de registro** .</span><span class="sxs-lookup"><span data-stu-id="ad799-212">If verified, the Get-AzProviderFeature command returns a value of **Registered** for the **Registration State** property.</span></span> <span data-ttu-id="ad799-213">Realice esta acción para cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="ad799-213">Perform this action for each subscription.</span></span>

   ```powershell
   Set-AzContext -SubscriptionId <SubscriptionId>
   Get-AzProviderFeature -ProviderNamespace Microsoft.Resources -FeatureName mandatoryRetentionPeriodEnabled
   ```

5. <span data-ttu-id="ad799-214">Para completar el proceso, ejecute el comando Register-AzResourceProvider.</span><span class="sxs-lookup"><span data-stu-id="ad799-214">To complete the process, run the Register-AzResourceProvider command.</span></span> <span data-ttu-id="ad799-215">Realice esta acción para cada suscripción.</span><span class="sxs-lookup"><span data-stu-id="ad799-215">Perform this action for each subscription.</span></span>

   ```powershell
   Set-AzContext -SubscriptionId <SubscriptionId>
   Register-AzResourceProvider -ProviderNamespace Microsoft.KeyVault
   ```

### <a name="create-a-premium-azure-key-vault-in-each-subscription"></a><span data-ttu-id="ad799-216">Crear un almacén de claves Premium de Azure en cada suscripción</span><span class="sxs-lookup"><span data-stu-id="ad799-216">Create a premium Azure Key Vault in each subscription</span></span>

<span data-ttu-id="ad799-217">Los pasos para crear un almacén de claves se documentan en [Getting Started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/), que le guiará a través de la instalación y el inicio de Azure PowerShell, la conexión a su suscripción de Azure, la creación de un grupo de recursos y la creación de un almacén de claves en ese grupo de recursos.</span><span class="sxs-lookup"><span data-stu-id="ad799-217">The steps to create a key vault are documented in [Getting Started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/), which guides you through installing and launching Azure PowerShell, connecting to your Azure subscription, creating a resource group, and creating a key vault in that resource group.</span></span>
  
<span data-ttu-id="ad799-218">Al crear un almacén de claves, debe elegir una SKU: estándar o Premium.</span><span class="sxs-lookup"><span data-stu-id="ad799-218">When you create a key vault, you must choose a SKU: either Standard or Premium.</span></span> <span data-ttu-id="ad799-219">La SKU estándar permite que las claves de Azure Key Vault estén protegidas con software (no hay protección de clave de módulo de seguridad de hardware (HSM) y la SKU Premium permite usar los HSM para proteger las claves de la bóveda clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-219">The Standard SKU allows Azure Key Vault keys to be protected with software - there is no Hardware Security Module (HSM) key protection - and the Premium SKU allows the use of HSMs for protection of Key Vault keys.</span></span> <span data-ttu-id="ad799-220">La clave de cliente acepta almacenes clave que usan una SKU, pero Microsoft recomienda encarecidamente usar solo la SKU Premium.</span><span class="sxs-lookup"><span data-stu-id="ad799-220">Customer Key accepts key vaults that use either SKU, though Microsoft strongly recommends that you use only the Premium SKU.</span></span> <span data-ttu-id="ad799-221">El costo de las operaciones con claves de cualquier tipo es el mismo, por lo que la única diferencia de costo es el costo cada mes para cada clave protegida por HSM.</span><span class="sxs-lookup"><span data-stu-id="ad799-221">The cost of operations with keys of either type is the same, so the only difference in cost is the cost per month for each HSM-protected key.</span></span> <span data-ttu-id="ad799-222">Consulte [tarifas clave](https://azure.microsoft.com/pricing/details/key-vault/) de la bóveda para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="ad799-222">See [Key Vault pricing](https://azure.microsoft.com/pricing/details/key-vault/) for details.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="ad799-223">Use los almacenes clave de SKU Premium y las claves protegidas por HSM para los datos de producción y use únicamente las claves y los almacenes de claves de SKU estándar para fines de prueba y validación.</span><span class="sxs-lookup"><span data-stu-id="ad799-223">Use the Premium SKU key vaults and HSM-protected keys for production data, and only use Standard SKU key vaults and keys for testing and validation purposes.</span></span>
  
<span data-ttu-id="ad799-224">Para cada servicio de Microsoft 365 con el que va a usar la clave de cliente, cree un almacén de claves en cada una de las dos suscripciones de Azure que ha creado.</span><span class="sxs-lookup"><span data-stu-id="ad799-224">For each Microsoft 365 service with which you will use Customer Key, create a key vault in each of the two Azure subscriptions that you created.</span></span> <span data-ttu-id="ad799-225">Por ejemplo, solo para Exchange Online y Skype empresarial, o SharePoint Online y OneDrive para la empresa, solo se creará un par de depósitos.</span><span class="sxs-lookup"><span data-stu-id="ad799-225">For example, for Exchange Online and Skype for Business only or SharePoint Online and OneDrive for Business only, you will create only one pair of vaults.</span></span> <span data-ttu-id="ad799-226">Para habilitar la clave de cliente para Exchange Online y SharePoint Online, deberá crear dos pares de depósitos clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-226">To enable Customer Key for both Exchange Online and SharePoint Online, you will create two pairs of key vaults.</span></span>
  
<span data-ttu-id="ad799-227">Use una Convención de nomenclatura para los depósitos clave que refleje el uso previsto de la Directiva de cifrado de datos con la que va a asociar los almacenes.</span><span class="sxs-lookup"><span data-stu-id="ad799-227">Use a naming convention for key vaults that reflects the intended use of the data encryption policy with which you will associate the vaults.</span></span> <span data-ttu-id="ad799-228">Consulte la sección procedimientos recomendados a continuación para conocer las recomendaciones de Convención de nomenclatura.</span><span class="sxs-lookup"><span data-stu-id="ad799-228">See the Best Practices section below for naming convention recommendations.</span></span>
  
<span data-ttu-id="ad799-229">Cree un conjunto independiente y emparejado de depósitos para cada directiva de cifrado de datos.</span><span class="sxs-lookup"><span data-stu-id="ad799-229">Create a separate, paired set of vaults for each data encryption policy.</span></span> <span data-ttu-id="ad799-230">Para Exchange Online, el ámbito de una directiva de cifrado de datos se elige cuando se asigna la Directiva al buzón.</span><span class="sxs-lookup"><span data-stu-id="ad799-230">For Exchange Online, the scope of a data encryption policy is chosen by you when you assign the policy to mailbox.</span></span> <span data-ttu-id="ad799-231">Un buzón puede tener solo una directiva asignada y puede crear hasta 50 directivas.</span><span class="sxs-lookup"><span data-stu-id="ad799-231">A mailbox can have only one policy assigned, and you can create up to fifty policies.</span></span> <span data-ttu-id="ad799-232">Para SharePoint Online el ámbito de una Directiva son todos los datos de una organización en una ubicación geográfica o _geográfica_.</span><span class="sxs-lookup"><span data-stu-id="ad799-232">For SharePoint Online the scope of a policy is all of the data within an organization in a geographic location, or _geo_.</span></span>

<span data-ttu-id="ad799-233">La creación de almacenes clave también requiere la creación de grupos de recursos de Azure, ya que las bóvedas clave necesitan capacidad de almacenamiento (aunque muy pequeña) y el registro de la bóveda clave, si está habilitado, también genera datos almacenados.</span><span class="sxs-lookup"><span data-stu-id="ad799-233">The creation of key vaults also requires the creation of Azure resource groups, since key vaults need storage capacity (though very small) and Key Vault logging, if enabled, also generates stored data.</span></span> <span data-ttu-id="ad799-234">Como procedimiento recomendado, Microsoft recomienda el uso de administradores independientes para administrar cada grupo de recursos, con la administración alineada con el conjunto de administradores que administrarán todos los recursos de clave de cliente relacionados.</span><span class="sxs-lookup"><span data-stu-id="ad799-234">As a best practice Microsoft recommends using separate administrators to manage each resource group, with the administration aligned with the set of administrators that will manage all related Customer Key resources.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="ad799-235">Para maximizar la disponibilidad, los depósitos clave deben estar en regiones cercanas a su servicio Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-235">To maximize availability, your key vaults should be in regions close to your Microsoft 365 service.</span></span> <span data-ttu-id="ad799-236">Por ejemplo, si su organización de Exchange Online está en Norteamérica, ubique sus depósitos clave en Norteamérica.</span><span class="sxs-lookup"><span data-stu-id="ad799-236">For example, if your Exchange Online organization is in North America, place your key vaults in North America.</span></span> <span data-ttu-id="ad799-237">Si su organización de Exchange Online está en Europa, ubique los depósitos clave en Europa.</span><span class="sxs-lookup"><span data-stu-id="ad799-237">If your Exchange Online organization is in Europe, place your key vaults in Europe.</span></span><br/><span data-ttu-id="ad799-238">Use un prefijo común para los depósitos clave e incluya una abreviatura del uso y el alcance de las claves y el almacén de claves (por ejemplo, para el servicio de SharePoint de Contoso donde los almacenes se ubicarán en Norteamérica, un posible par de nombres es contoso-O365SP-NA-VaultA1 y contoso-O365SP-NA-VaultA2.</span><span class="sxs-lookup"><span data-stu-id="ad799-238">Use a common prefix for key vaults, and include an abbreviation of the use and scope of the key vault and keys (e.g., for the Contoso SharePoint service where the vaults will be located in North America, a possible pair of names is Contoso-O365SP-NA-VaultA1 and Contoso-O365SP-NA-VaultA2.</span></span> <span data-ttu-id="ad799-239">Los nombres de almacén son cadenas únicas de forma global dentro de Azure, por lo que es posible que deba probar variantes de sus nombres deseados en caso de que otros clientes de Azure ya hayan reclamado los nombres deseados.</span><span class="sxs-lookup"><span data-stu-id="ad799-239">Vault names are globally unique strings within Azure, so you may need to try variations of your desired names in case the desired names are already claimed by other Azure customers.</span></span> <span data-ttu-id="ad799-240">A partir de julio 2017 los nombres de almacén no se pueden cambiar, por lo que un procedimiento recomendado es tener un plan escrito para la configuración y usar una segunda persona para comprobar que el plan se ejecuta correctamente.</span><span class="sxs-lookup"><span data-stu-id="ad799-240">As of July 2017 vault names cannot be changed, so a best practice is to have a written plan for setup and use a second person to verify the plan is executed correctly.</span></span><br/><span data-ttu-id="ad799-241">Si es posible, cree sus depósitos en regiones no emparejadas.</span><span class="sxs-lookup"><span data-stu-id="ad799-241">If possible, create your vaults in non-paired regions.</span></span> <span data-ttu-id="ad799-242">Las regiones de Azure emparejadas proporcionan alta disponibilidad en todos los dominios de error de servicio.</span><span class="sxs-lookup"><span data-stu-id="ad799-242">Paired Azure regions provide high availability across service failure domains.</span></span> <span data-ttu-id="ad799-243">Por lo tanto, los pares regionales pueden considerarse como una región de copia de seguridad de cada uno.</span><span class="sxs-lookup"><span data-stu-id="ad799-243">Therefore, regional pairs can be thought of as each other's backup region.</span></span> <span data-ttu-id="ad799-244">Esto significa que un recurso de Azure que se coloca en una región está obteniendo automáticamente la tolerancia a errores a través de la región emparejada.</span><span class="sxs-lookup"><span data-stu-id="ad799-244">This means that an Azure resource that is placed in one region is automatically gaining fault tolerance through the paired region.</span></span> <span data-ttu-id="ad799-245">Por este motivo, la elección de regiones para dos almacenes usados en una directiva de cifrado de datos en la que las regiones están emparejadas significa que solo se usa un total de dos regiones de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="ad799-245">For this reason, choosing regions for two vaults used in a data encryption policy where the regions are paired means that only a total of two regions of availability are in use.</span></span> <span data-ttu-id="ad799-246">La mayoría de las zonas geográficas solo tienen dos regiones, por lo que todavía no es posible seleccionar regiones no emparejadas.</span><span class="sxs-lookup"><span data-stu-id="ad799-246">Most geographies only have two regions, so it's not yet possible to select non-paired regions.</span></span> <span data-ttu-id="ad799-247">Si es posible, elija dos regiones no emparejadas para las dos Vaults que se usan con una directiva de cifrado de datos.</span><span class="sxs-lookup"><span data-stu-id="ad799-247">If possible, choose two non-paired regions for the two vaults used with a data encryption policy.</span></span> <span data-ttu-id="ad799-248">Esto beneficia de un total de cuatro regiones de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="ad799-248">This benefits from a total of four regions of availability.</span></span> <span data-ttu-id="ad799-249">Para obtener más información, vea [continuidad empresarial y recuperación ante desastres (BCDR): regiones emparejadas de Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions) para obtener una lista actual de pares regionales.</span><span class="sxs-lookup"><span data-stu-id="ad799-249">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](https://docs.microsoft.com/azure/best-practices-availability-paired-regions) for a current list of regional pairs.</span></span>
  
### <a name="assign-permissions-to-each-key-vault"></a><span data-ttu-id="ad799-250">Asignar permisos a cada almacén clave</span><span class="sxs-lookup"><span data-stu-id="ad799-250">Assign permissions to each key vault</span></span>

<span data-ttu-id="ad799-251">Para cada almacén de claves, tendrá que definir tres conjuntos de permisos distintos para la clave de cliente, según la implementación.</span><span class="sxs-lookup"><span data-stu-id="ad799-251">For each key vault, you will need to define three separate sets of permissions for Customer Key, depending on your implementation.</span></span> <span data-ttu-id="ad799-252">Por ejemplo, tendrá que definir un conjunto de permisos para cada uno de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="ad799-252">For example, you will need to define one set of permissions for each of the following:</span></span>
  
- <span data-ttu-id="ad799-253">**Administradores de la bóveda clave** que realizarán la administración cotidiana de su almacén clave para su organización.</span><span class="sxs-lookup"><span data-stu-id="ad799-253">**Key vault administrators** that will perform day-to-day management of your key vault for your organization.</span></span> <span data-ttu-id="ad799-254">Estas tareas incluyen copia de seguridad, crear, obtener, importar, enumerar y restaurar.</span><span class="sxs-lookup"><span data-stu-id="ad799-254">These tasks include backup, create, get, import, list, and restore.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="ad799-255">El conjunto de permisos asignado a los administradores de la bóveda de claves no incluye el permiso para eliminar claves.</span><span class="sxs-lookup"><span data-stu-id="ad799-255">The set of permissions assigned to key vault administrators does not include the permission to delete keys.</span></span> <span data-ttu-id="ad799-256">Esto es intencionado y es un ejercicio importante.</span><span class="sxs-lookup"><span data-stu-id="ad799-256">This is intentional and an important practice.</span></span> <span data-ttu-id="ad799-257">La eliminación de claves de cifrado no suele realizarse, ya que al hacerlo se destruyen los datos de forma permanente.</span><span class="sxs-lookup"><span data-stu-id="ad799-257">Deleting encryption keys is not typically done, since doing so permanently destroys data.</span></span> <span data-ttu-id="ad799-258">Como procedimiento recomendado, no conceda este permiso a los administradores de la bóveda clave de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="ad799-258">As a best practice, do not grant this permission to key vault administrators by default.</span></span> <span data-ttu-id="ad799-259">En su lugar, Reserve esto para los colaboradores clave de la bóveda y asígnelo solo a un administrador a corto plazo una vez que comprenda claramente las consecuencias.</span><span class="sxs-lookup"><span data-stu-id="ad799-259">Instead, reserve this for key vault contributors and only assign it to an administrator on a short term basis once a clear understanding of the consequences is understood.</span></span>
  
  <span data-ttu-id="ad799-260">Para asignar estos permisos a un usuario de su organización, inicie sesión en su suscripción de Azure con Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-260">To assign these permissions to a user in your organization, log in to your Azure subscription with Azure PowerShell.</span></span> <span data-ttu-id="ad799-261">Para obtener instrucciones, vea [iniciar sesión con Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span><span class="sxs-lookup"><span data-stu-id="ad799-261">For instructions, see [Sign in with Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span></span>

- <span data-ttu-id="ad799-262">Ejecute el cmdlet Set-AzKeyVaultAccessPolicy para asignar los permisos necesarios.</span><span class="sxs-lookup"><span data-stu-id="ad799-262">Run the Set-AzKeyVaultAccessPolicy cmdlet to assign the necessary permissions.</span></span>

   ```powershell
   Set-AzKeyVaultAccessPolicy -VaultName <vault name> -UserPrincipalName <UPN of user> -PermissionsToKeys create,import,list,get,backup,restore
   ```

   <span data-ttu-id="ad799-263">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ad799-263">For example:</span></span>

   ```powershell
   Set-AzKeyVaultAccessPolicy -VaultName Contoso-O365EX-NA-VaultA1 -UserPrincipalName alice@contoso.com -PermissionsToKeys create,import,list,get,backup,restore
   ```

- <span data-ttu-id="ad799-264">**Contribute de Key Vault** que puede cambiar los permisos en el propio almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="ad799-264">**Key vault contributors** that can change permissions on the Azure Key Vault itself.</span></span> <span data-ttu-id="ad799-265">Tendrá que cambiar estos permisos a medida que los empleados abandonen o se unan a su equipo, o en la situación extremadamente inusual de que los administradores de la bóveda clave necesiten de forma legítima permiso para eliminar o restaurar una clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-265">You'll need to change these permissions as employees leave or join your team, or in the extremely rare situation that the key vault administrators legitimately need permission to delete or restore a key.</span></span> <span data-ttu-id="ad799-266">Este conjunto de colaboradores clave del almacén debe tener concedido el rol **colaborador** en su almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="ad799-266">This set of key vault contributors needs to be granted the **Contributor** role on your key vault.</span></span> <span data-ttu-id="ad799-267">Puede asignar este rol mediante el administrador de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="ad799-267">You can assign this role by using Azure Resource Manager.</span></span> <span data-ttu-id="ad799-268">Para obtener los pasos detallados, consulte [usar el control de acceso basado en roles para administrar el acceso a los recursos de suscripción de Azure](https://docs.microsoft.com/azure/active-directory/role-based-access-control-configure).</span><span class="sxs-lookup"><span data-stu-id="ad799-268">For detailed steps, see [Use Role-Based Access Control to manage access to your Azure subscription resources](https://docs.microsoft.com/azure/active-directory/role-based-access-control-configure).</span></span> <span data-ttu-id="ad799-269">El administrador que crea una suscripción tiene este acceso de forma implícita, así como la capacidad de asignar otros administradores al rol colaborador.</span><span class="sxs-lookup"><span data-stu-id="ad799-269">The administrator who creates a subscription has this access implicitly, as well as the ability to assign other administrators to the Contributor role.</span></span>

- <span data-ttu-id="ad799-270">Si tiene previsto usar la clave de cliente con Exchange Online y Skype empresarial, debe conceder permiso a Microsoft 365 para usar el almacén de claves en nombre de Exchange Online y Skype empresarial.</span><span class="sxs-lookup"><span data-stu-id="ad799-270">If you intend to use Customer Key with Exchange Online and Skype for Business, you need to give permission to Microsoft 365 to use the key vault on behalf of Exchange Online and Skype for Business.</span></span> <span data-ttu-id="ad799-271">Del mismo modo, si tiene previsto usar la clave de cliente con SharePoint Online y OneDrive para la empresa, debe agregar el permiso para que Microsoft 365 use el almacén de claves en nombre de SharePoint Online y OneDrive para la empresa.</span><span class="sxs-lookup"><span data-stu-id="ad799-271">Likewise, if you intend to use Customer Key with SharePoint Online and OneDrive for Business, you need to add permission for the Microsoft 365 to use the key vault on behalf of SharePoint Online and OneDrive for Business.</span></span> <span data-ttu-id="ad799-272">Para conceder permiso a Microsoft 365, ejecute el cmdlet **set-AzKeyVaultAccessPolicy** con la siguiente sintaxis:</span><span class="sxs-lookup"><span data-stu-id="ad799-272">To give permission to Microsoft 365, run the **Set-AzKeyVaultAccessPolicy** cmdlet using the following syntax:</span></span> 

   ```powershell
   Set-AzKeyVaultAccessPolicy -VaultName <vault name> -PermissionsToKeys wrapKey,unwrapKey,get -ServicePrincipalName <Office 365 appID>
   ```

   <span data-ttu-id="ad799-273">Donde:</span><span class="sxs-lookup"><span data-stu-id="ad799-273">Where:</span></span>

    - <span data-ttu-id="ad799-274">el *nombre del almacén* es el nombre del almacén de claves que ha creado.</span><span class="sxs-lookup"><span data-stu-id="ad799-274">*vault name* is the name of the key vault you created.</span></span>

    - <span data-ttu-id="ad799-275">Para Exchange Online y Skype empresarial, reemplace *Office 365 appID* por`00000002-0000-0ff1-ce00-000000000000`</span><span class="sxs-lookup"><span data-stu-id="ad799-275">For Exchange Online and Skype for Business, replace  *Office 365 appID* with `00000002-0000-0ff1-ce00-000000000000`</span></span>

    - <span data-ttu-id="ad799-276">Para los archivos de SharePoint Online, OneDrive para la empresa y Microsoft Teams, reemplace *Office 365 appID* por`00000003-0000-0ff1-ce00-000000000000`</span><span class="sxs-lookup"><span data-stu-id="ad799-276">For SharePoint Online, OneDrive for Business, and Teams files, replace  *Office 365 appID* with `00000003-0000-0ff1-ce00-000000000000`</span></span>

  <span data-ttu-id="ad799-277">Ejemplo: establecer permisos para Exchange Online y Skype empresarial:</span><span class="sxs-lookup"><span data-stu-id="ad799-277">Example: Setting permissions for Exchange Online and Skype for Business:</span></span>

   ```powershell
   Set-AzKeyVaultAccessPolicy -VaultName Contoso-O365EX-NA-VaultA1 -PermissionsToKeys wrapKey,unwrapKey,get -ServicePrincipalName 00000002-0000-0ff1-ce00-000000000000
   ```

  <span data-ttu-id="ad799-278">Ejemplo: establecer permisos para los archivos de SharePoint Online, OneDrive para la empresa y Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="ad799-278">Example: Setting permissions for SharePoint Online, OneDrive for Business, and Teams files:</span></span>

   ```powershell
   Set-AzKeyVaultAccessPolicy -VaultName Contoso-O365SP-NA-VaultA1 -PermissionsToKeys wrapKey,unwrapKey,get -ServicePrincipalName 00000003-0000-0ff1-ce00-000000000000
   ```

### <a name="enable-and-then-confirm-soft-delete-on-your-key-vaults"></a><span data-ttu-id="ad799-279">Habilitar y, a continuación, confirmar la eliminación de software en los depósitos clave</span><span class="sxs-lookup"><span data-stu-id="ad799-279">Enable and then confirm soft delete on your key vaults</span></span>

<span data-ttu-id="ad799-280">Cuando puede recuperar rápidamente las claves, es menos probable que experimente una interrupción del servicio prolongada debido a claves eliminadas accidental o malintencionadamente.</span><span class="sxs-lookup"><span data-stu-id="ad799-280">When you can quickly recover your keys, you are less likely to experience an extended service outage due to accidentally or maliciously deleted keys.</span></span> <span data-ttu-id="ad799-281">Debe habilitar esta configuración, que se conoce como eliminación temporal, para poder usar las claves con la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-281">You need to enable this configuration, referred to as Soft Delete, before you can use your keys with Customer Key.</span></span> <span data-ttu-id="ad799-282">La habilitación de la eliminación temporal permite recuperar claves o depósitos en un plazo de 90 días de eliminación sin tener que restaurarlos a partir de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="ad799-282">Enabling Soft Delete allows you to recover keys or vaults within 90 days of deletion without having to restore them from backup.</span></span>
  
<span data-ttu-id="ad799-283">Para habilitar la eliminación temporal en los almacenes clave, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="ad799-283">To enable Soft Delete on your key vaults, complete these steps:</span></span>
  
1. <span data-ttu-id="ad799-284">Inicie sesión en su suscripción de Azure con Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-284">Sign in to your Azure subscription with Windows Powershell.</span></span> <span data-ttu-id="ad799-285">Para obtener instrucciones, vea [iniciar sesión con Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span><span class="sxs-lookup"><span data-stu-id="ad799-285">For instructions, see [Sign in with Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).</span></span>

2. <span data-ttu-id="ad799-286">Ejecute el cmdlet [Get-AzKeyVault](https://docs.microsoft.com/powershell/module/az.keyvault/get-azkeyvault) .</span><span class="sxs-lookup"><span data-stu-id="ad799-286">Run the [Get-AzKeyVault](https://docs.microsoft.com/powershell/module/az.keyvault/get-azkeyvault) cmdlet.</span></span> <span data-ttu-id="ad799-287">En este ejemplo, el *nombre del almacén* es el nombre del almacén de claves para el que se va a habilitar la eliminación temporal:</span><span class="sxs-lookup"><span data-stu-id="ad799-287">In this example, *vault name* is the name of the key vault for which you are enabling soft delete:</span></span>

   ```powershell
   $v = Get-AzKeyVault -VaultName <vault name>
   $r = Get-AzResource -ResourceId $v.ResourceId
   $r.Properties | Add-Member -MemberType NoteProperty -Name enableSoftDelete -Value 'True'
   Set-AzResource -ResourceId $r.ResourceId -Properties $r.Properties
   ```

3. <span data-ttu-id="ad799-288">Confirme que la eliminación de software está configurada para el almacén de claves mediante la ejecución del cmdlet **Get-AzKeyVault** .</span><span class="sxs-lookup"><span data-stu-id="ad799-288">Confirm soft delete is configured for the key vault by running the **Get-AzKeyVault** cmdlet.</span></span> <span data-ttu-id="ad799-289">Si la eliminación temporal está configurada correctamente para el almacén de claves, la propiedad _eliminación temporal habilitada_ devuelve un valor **true**:</span><span class="sxs-lookup"><span data-stu-id="ad799-289">If soft delete is configured properly for the key vault, then the _Soft Delete Enabled_ property returns a value of **True**:</span></span>

   ```powershell
   Get-AzKeyVault -VaultName <vault name> | fl
   ```

### <a name="add-a-key-to-each-key-vault-either-by-creating-or-importing-a-key"></a><span data-ttu-id="ad799-290">Agregar una clave a cada depósito clave creando o importando una clave</span><span class="sxs-lookup"><span data-stu-id="ad799-290">Add a key to each key vault either by creating or importing a key</span></span>

<span data-ttu-id="ad799-291">Hay dos formas de agregar claves a un almacén de claves de Azure; puede crear una clave directamente en el almacén de claves, o puede importar una clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-291">There are two ways to add keys to an Azure Key Vault; you can create a key directly in Key Vault, or you can import a key.</span></span> <span data-ttu-id="ad799-292">La creación de una clave directamente en el almacén de claves es el método menos complicado, mientras que la importación de una clave proporciona un control total sobre la forma en que se genera la clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-292">Creating a key directly in Key Vault is the less complicated method, while importing a key provides total control over how the key is generated.</span></span>
  
<span data-ttu-id="ad799-293">Para crear una clave directamente en el almacén de claves, ejecute el cmdlet [Add-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/add-azkeyvaultkey) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-293">To create a key directly in your key vault, run the [Add-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/add-azkeyvaultkey) cmdlet as follows:</span></span>
  
```powershell
Add-AzKeyVaultKey -VaultName <vault name> -Name <key name> -Destination <HSM|Software> -KeyOps wrapKey,unwrapKey
```

<span data-ttu-id="ad799-294">Donde:</span><span class="sxs-lookup"><span data-stu-id="ad799-294">Where:</span></span>

- <span data-ttu-id="ad799-295">*nombre del almacén* es el nombre del almacén de clave en el que desea crear la clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-295">*vault name* is the name of the key vault in which you want to create the key.</span></span>

- <span data-ttu-id="ad799-296">*nombre de clave* es el nombre que desea asignar a la nueva clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-296">*key name* is the name you want to give the new key.</span></span>

  > [!TIP]
  > <span data-ttu-id="ad799-297">Denomine claves con una Convención de nomenclatura similar, como se ha descrito anteriormente para los almacenes de claves.</span><span class="sxs-lookup"><span data-stu-id="ad799-297">Name keys using a similar naming convention as described above for key vaults.</span></span> <span data-ttu-id="ad799-298">De este modo, en las herramientas que solo muestran el nombre de la clave, la cadena es autodescriptivo.</span><span class="sxs-lookup"><span data-stu-id="ad799-298">This way, in tools that show only the key name, the string is self-describing.</span></span>
  
- <span data-ttu-id="ad799-299">Si piensa proteger la clave con un HSM, asegúrese de especificar **HSM** como el valor del parámetro _Destination_ ; de lo contrario, especifique el **software**.</span><span class="sxs-lookup"><span data-stu-id="ad799-299">If you intend to protect the key with an HSM, ensure that you specify **HSM** as the value of the _Destination_ parameter, otherwise, specify **Software**.</span></span>

<span data-ttu-id="ad799-300">For example,</span><span class="sxs-lookup"><span data-stu-id="ad799-300">For example,</span></span>
  
```powershell
Add-AzKeyVaultKey -VaultName Contoso-O365EX-NA-VaultA1 -Name Contoso-O365EX-NA-VaultA1-Key001 -Destination Software -KeyOps wrapKey,unwrapKey
```

<span data-ttu-id="ad799-301">Para importar una clave directamente en el almacén de claves, debe tener un módulo de seguridad de hardware de Thales nShield.</span><span class="sxs-lookup"><span data-stu-id="ad799-301">To import a key directly into your key vault, you need to have a Thales nShield Hardware Security Module.</span></span>
  
<span data-ttu-id="ad799-302">Algunas organizaciones prefieren este enfoque para establecer la procedencia de sus claves y este método también ofrece lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="ad799-302">Some organizations prefer this approach to establish the provenance of their keys, and the this method also provides the following:</span></span>
  
- <span data-ttu-id="ad799-303">El conjunto de herramientas usado para la importación incluye atestación de Thales de que la clave de intercambio de claves (KEK) que se usa para cifrar la clave que se genera no es exportable y se genera dentro de un HSM genuino fabricado por Thales.</span><span class="sxs-lookup"><span data-stu-id="ad799-303">The tool set used for import includes attestation from Thales that the Key Exchange Key (KEK) that is used to encrypt the key you generate is not exportable and is generated inside a genuine HSM that was manufactured by Thales.</span></span>

- <span data-ttu-id="ad799-304">El conjunto de herramientas incluye la atestación de Thales que el mundo de seguridad de la clave de Azure Key Vault también se generó en un HSM auténtico fabricado por Thales.</span><span class="sxs-lookup"><span data-stu-id="ad799-304">The tool set includes attestation from Thales that the Azure Key Vault security world was also generated on a genuine HSM manufactured by Thales.</span></span> <span data-ttu-id="ad799-305">Esta atestación le demuestra que Microsoft también usa hardware de Thales genuino.</span><span class="sxs-lookup"><span data-stu-id="ad799-305">This attestation proves to you that Microsoft is also using genuine Thales hardware.</span></span>

<span data-ttu-id="ad799-306">Consulte a su grupo de seguridad para determinar si se requieren las atestaciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="ad799-306">Check with your security group to determine if the above attestations are required.</span></span> <span data-ttu-id="ad799-307">Para obtener instrucciones detalladas para crear una clave local e importarla en el almacén de claves, consulte [How to generate HSM-Protected Keys for Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-hsm-protected-keys/).</span><span class="sxs-lookup"><span data-stu-id="ad799-307">For detailed steps to create a key on-premises and import it into your key vault, see [How to generate and transfer HSM-protected keys for Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-hsm-protected-keys/).</span></span> <span data-ttu-id="ad799-308">Use las instrucciones de Azure para crear una clave en cada almacén de clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-308">Use the Azure instructions to create a key in each key vault.</span></span>
  
### <a name="check-the-recovery-level-of-your-keys"></a><span data-ttu-id="ad799-309">Comprobar el nivel de recuperación de las claves</span><span class="sxs-lookup"><span data-stu-id="ad799-309">Check the recovery level of your keys</span></span>

<span data-ttu-id="ad799-310">Microsoft 365 requiere que la suscripción de Azure Key Vault esté definida como no cancelar y que las claves usadas por la clave de cliente tengan habilitada la eliminación temporal.</span><span class="sxs-lookup"><span data-stu-id="ad799-310">Microsoft 365 requires that the Azure Key Vault subscription is set to Do Not Cancel and that the keys used by Customer Key have soft delete enabled.</span></span> <span data-ttu-id="ad799-311">Para confirmarlo, consulte el nivel de recuperación de las claves.</span><span class="sxs-lookup"><span data-stu-id="ad799-311">You can confirm this by looking at the recovery level on your keys.</span></span>
  
<span data-ttu-id="ad799-312">Para comprobar el nivel de recuperación de una clave, en Azure PowerShell, ejecute el cmdlet Get-AzKeyVaultKey de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-312">To check the recovery level of a key, in Azure PowerShell, run the Get-AzKeyVaultKey cmdlet as follows:</span></span>
  
```powershell
(Get-AzKeyVaultKey -VaultName <vault name> -Name <key name>).Attributes
```

<span data-ttu-id="ad799-313">Si la propiedad _nivel de recuperación_ devuelve cualquier cosa que no sea un valor **recuperable + ProtectedSubscription**, tendrá que revisar este tema y asegurarse de que ha seguido todos los pasos necesarios para poner la suscripción en la lista no cancelar y que tiene habilitada la eliminación temporal en cada uno de los almacenes clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-313">If the _Recovery Level_ property returns anything other than a value of **Recoverable+ProtectedSubscription**, you will need to review this topic and ensure that you have followed all of the steps to put the subscription on the Do Not Cancel list and that you have soft delete enabled on each of your key vaults.</span></span>
  
### <a name="back-up-azure-key-vault"></a><span data-ttu-id="ad799-314">Copia de seguridad de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ad799-314">Back up Azure Key Vault</span></span>

<span data-ttu-id="ad799-315">Inmediatamente después de la creación o de cualquier cambio en una clave, realice una copia de seguridad y almacene copias de la copia de seguridad, tanto en línea como sin conexión.</span><span class="sxs-lookup"><span data-stu-id="ad799-315">Immediately following creation or any change to a key, perform a backup and store copies of the backup, both online and offline.</span></span> <span data-ttu-id="ad799-316">Las copias sin conexión no deben estar conectadas a ninguna red, como en un servicio de almacenamiento comercial o seguro físico.</span><span class="sxs-lookup"><span data-stu-id="ad799-316">Offline copies should not be connected to any network, such as in a physical safe or commercial storage facility.</span></span> <span data-ttu-id="ad799-317">Al menos una copia de la copia de seguridad debe almacenarse en una ubicación a la que se pueda tener acceso en caso de desastre.</span><span class="sxs-lookup"><span data-stu-id="ad799-317">At least one copy of the backup should be stored in a location that will be accessible in the event of a disaster.</span></span> <span data-ttu-id="ad799-318">Los blobs de copia de seguridad son los únicos medios de restaurar el material clave en caso de que una clave de almacén clave se destruya de forma permanente o no pueda ser procesada de forma inservible.</span><span class="sxs-lookup"><span data-stu-id="ad799-318">The backup blobs are the sole means of restoring key material should a Key Vault key be permanently destroyed or otherwise rendered inoperable.</span></span> <span data-ttu-id="ad799-319">Las claves externas a Azure Key Vault y que se importaron a Azure Key Vault no se califican como una copia de seguridad porque los metadatos necesarios para que la clave de cliente use la clave no existe con la clave externa.</span><span class="sxs-lookup"><span data-stu-id="ad799-319">Keys that are external to Azure Key Vault and were imported to Azure Key Vault do not qualify as a backup because the metadata necessary for Customer Key to use the key does not exist with the external key.</span></span> <span data-ttu-id="ad799-320">Solo se puede usar una copia de seguridad tomada de Azure Key Vault para las operaciones de restauración con la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-320">Only a backup taken from Azure Key Vault can be used for restore operations with Customer Key.</span></span> <span data-ttu-id="ad799-321">Por lo tanto, es fundamental realizar una copia de seguridad del almacén de claves de Azure una vez que se haya cargado o creado una clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-321">Therefore, it is essential that a backup of Azure Key Vault be made once a key is uploaded or created.</span></span>
  
<span data-ttu-id="ad799-322">Para crear una copia de seguridad de una clave de Azure Key Vault, ejecute el cmdlet [backup-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/backup-azkeyvaultkey) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-322">To create a backup of an Azure Key Vault key, run the [Backup-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/backup-azkeyvaultkey) cmdlet as follows:</span></span>

```powershell
Backup-AzKeyVaultKey -VaultName <vault name> -Name <key name>
-OutputFile <filename.backup>
```

<span data-ttu-id="ad799-323">Asegúrese de que el archivo de salida Use `.backup`el sufijo.</span><span class="sxs-lookup"><span data-stu-id="ad799-323">Ensure that your output file uses the suffix `.backup`.</span></span>
  
<span data-ttu-id="ad799-324">El archivo de salida resultante de este cmdlet está cifrado y no se puede usar fuera de Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ad799-324">The output file resulting from this cmdlet is encrypted and cannot be used outside of Azure Key Vault.</span></span> <span data-ttu-id="ad799-325">La copia de seguridad solo se puede restaurar a la suscripción de Azure desde la que se realizó la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="ad799-325">The backup can be restored only to the Azure subscription from which the backup was taken.</span></span>
  
> [!TIP]
> <span data-ttu-id="ad799-326">Para el archivo de salida, elija una combinación del nombre de la caja fuerte y el nombre de la clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-326">For the output file, choose a combination of your vault name and key name.</span></span> <span data-ttu-id="ad799-327">Esto hará que el nombre de archivo se describa automáticamente.</span><span class="sxs-lookup"><span data-stu-id="ad799-327">This will make the file name self-describing.</span></span> <span data-ttu-id="ad799-328">También se asegurará de que los nombres de archivo de copia de seguridad no entren en conflicto.</span><span class="sxs-lookup"><span data-stu-id="ad799-328">It will also ensure that backup file names do not collide.</span></span>
  
<span data-ttu-id="ad799-329">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ad799-329">For example:</span></span>
  
```powershell
Backup-AzKeyVaultKey -VaultName Contoso-O365EX-NA-VaultA1 -Name Contoso-O365EX-NA-VaultA1-Key001 -OutputFile Contoso-O365EX-NA-VaultA1-Key001-Backup-20170802.backup
```

### <a name="validate-azure-key-vault-configuration-settings"></a><span data-ttu-id="ad799-330">Validar las opciones de configuración de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ad799-330">Validate Azure Key Vault configuration settings</span></span>

<span data-ttu-id="ad799-331">La validación antes de usar claves en un DEP es opcional, pero se recomienda encarecidamente.</span><span class="sxs-lookup"><span data-stu-id="ad799-331">Performing validation before using keys in a DEP is optional, but highly recommended.</span></span> <span data-ttu-id="ad799-332">En particular, si usa los pasos para configurar las claves y los almacenes distintos de los que se describen en este tema, debe validar el estado de los recursos de Azure Key Vault antes de configurar la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-332">In particular, if you use steps to set up your keys and vaults other than the ones described in this topic, you should validate the health of your Azure Key Vault resources before you configure Customer Key.</span></span>
  
<span data-ttu-id="ad799-333">Para comprobar que las claves tienen las operaciones GET, wrapKey y unwrapKey habilitadas:</span><span class="sxs-lookup"><span data-stu-id="ad799-333">To verify that your keys have get, wrapKey, and unwrapKey operations enabled:</span></span>
  
<span data-ttu-id="ad799-334">Ejecute el cmdlet [Get-AzKeyVault](https://docs.microsoft.com/powershell/module/az.keyvault/get-azkeyvault) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-334">Run the [Get-AzKeyVault](https://docs.microsoft.com/powershell/module/az.keyvault/get-azkeyvault) cmdlet as follows:</span></span>
  
```powershell
Get-AzKeyVault -VaultName <vault name>
```

<span data-ttu-id="ad799-335">En el resultado, busque la Directiva de acceso y la identidad de Exchange Online (GUID) o la identidad de SharePoint Online (GUID) según corresponda.</span><span class="sxs-lookup"><span data-stu-id="ad799-335">In the output, look for the Access Policy and for the Exchange Online identity (GUID) or the SharePoint Online identity (GUID) as appropriate.</span></span> <span data-ttu-id="ad799-336">Los tres permisos anteriores deben mostrarse en permisos a claves.</span><span class="sxs-lookup"><span data-stu-id="ad799-336">All three of the above permissions must be shown under Permissions to Keys.</span></span>
  
<span data-ttu-id="ad799-337">Si la configuración de la Directiva de acceso no es correcta, ejecute el cmdlet Set-AzKeyVaultAccessPolicy de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-337">If the access policy configuration is incorrect, run the Set-AzKeyVaultAccessPolicy cmdlet as follows:</span></span>
  
```powershell
Set-AzKeyVaultAccessPolicy -VaultName <vault name> -PermissionsToKeys wrapKey,unwrapKey,get -ServicePrincipalName <Office 365 appID>
```

<span data-ttu-id="ad799-338">Por ejemplo, para Exchange Online y Skype empresarial:</span><span class="sxs-lookup"><span data-stu-id="ad799-338">For example, for Exchange Online and Skype for Business:</span></span>
  
```powershell
Set-AzKeyVaultAccessPolicy -VaultName Contoso-O365EX-NA-VaultA1 
-PermissionsToKeys wrapKey,unwrapKey,get -ServicePrincipalName 00000002-0000-0ff1-ce00-000000000000
```

<span data-ttu-id="ad799-339">Por ejemplo, para SharePoint Online y OneDrive para la empresa:</span><span class="sxs-lookup"><span data-stu-id="ad799-339">For example, for SharePoint Online and OneDrive for Business:</span></span>
  
```powershell
Set-AzKeyVaultAccessPolicy -VaultName Contoso-O365SP-NA-VaultA1
-PermissionsToKeys wrapKey,unwrapKey,get -ServicePrincipalName TBD
```

<span data-ttu-id="ad799-340">Para comprobar que no se ha establecido una fecha de expiración para las claves, ejecute el cmdlet [Get-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/get-azkeyvault) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-340">To verify that an expiration date is not set for your keys run the [Get-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/get-azkeyvault) cmdlet as follows:</span></span>
  
```powershell
Get-AzKeyVaultKey -VaultName <vault name>
```

<span data-ttu-id="ad799-341">La clave de cliente no puede usar una clave expirada y las operaciones que se intentan con una clave expirada fallarán y, posiblemente, se producirá una interrupción del servicio.</span><span class="sxs-lookup"><span data-stu-id="ad799-341">An expired key cannot be used by Customer Key and operations attempted with an expired key will fail, and possibly result in a service outage.</span></span> <span data-ttu-id="ad799-342">Se recomienda encarecidamente que las claves usadas con la clave de cliente no tengan una fecha de expiración.</span><span class="sxs-lookup"><span data-stu-id="ad799-342">We strongly recommend that keys used with Customer Key do not have an expiration date.</span></span> <span data-ttu-id="ad799-343">Una fecha de expiración, una vez establecida, no se puede quitar, pero se puede cambiar a una fecha distinta.</span><span class="sxs-lookup"><span data-stu-id="ad799-343">An expiration date, once set, cannot be removed, but can be changed to a different date.</span></span> <span data-ttu-id="ad799-344">Si se debe usar una clave que tenga establecida una fecha de expiración, cambie el valor de expiración a 12/31/9999.</span><span class="sxs-lookup"><span data-stu-id="ad799-344">If a key must be used that has an expiration date set, change the expiration value to 12/31/9999.</span></span> <span data-ttu-id="ad799-345">Las claves con una fecha de expiración establecida en una fecha distinta a 12/31/9999 no pasarán la validación 365 de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ad799-345">Keys with an expiration date set to a date other than 12/31/9999 will not pass Microsoft 365 validation.</span></span>
  
<span data-ttu-id="ad799-346">Para cambiar una fecha de expiración que se haya establecido en cualquier valor distinto de 12/31/9999, ejecute el cmdlet [Update-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/update-azkeyvaultkey) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-346">To change an expiration date that has been set to any value other than 12/31/9999, run the [Update-AzKeyVaultKey](https://docs.microsoft.com/powershell/module/az.keyvault/update-azkeyvaultkey) cmdlet as follows:</span></span>
  
```powershell
Update-AzKeyVaultKey -VaultName <vault name> -Name <key name> -Expires (Get-Date -Date "12/31/9999")
```

> [!CAUTION]
> <span data-ttu-id="ad799-347">No establezca fechas de expiración en las claves de cifrado que use con la clave de cliente.</span><span class="sxs-lookup"><span data-stu-id="ad799-347">Don't set expiration dates on encryption keys you use with Customer Key.</span></span>
  
### <a name="obtain-the-uri-for-each-azure-key-vault-key"></a><span data-ttu-id="ad799-348">Obtener el URI para cada clave de Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ad799-348">Obtain the URI for each Azure Key Vault key</span></span>

<span data-ttu-id="ad799-349">Una vez que haya completado todos los pasos de Azure para configurar los almacenes clave y haya agregado las claves, ejecute el siguiente comando para obtener el URI de la clave en cada almacén de clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-349">Once you've completed all the steps in Azure to set up your key vaults and added your keys, run the following command to get the URI for the key in each key vault.</span></span> <span data-ttu-id="ad799-350">Tendrá que usar estos URI cuando cree y asigne cada DEP más adelante, por lo que debe guardar esta información en un lugar seguro.</span><span class="sxs-lookup"><span data-stu-id="ad799-350">You will need to use these URIs when you create and assign each DEP later, so save this information in a safe place.</span></span> <span data-ttu-id="ad799-351">Recuerde ejecutar este comando una vez para cada almacén de clave.</span><span class="sxs-lookup"><span data-stu-id="ad799-351">Remember to run this command once for each key vault.</span></span>
  
<span data-ttu-id="ad799-352">En Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="ad799-352">In Azure PowerShell:</span></span>
  
```powershell
(Get-AzKeyVaultKey -VaultName <vault name>).Id
```

## <a name="office-365-setting-up-customer-key-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="ad799-353">Office 365: configuración de la clave de cliente para Exchange Online y Skype empresarial</span><span class="sxs-lookup"><span data-stu-id="ad799-353">Office 365: Setting up Customer Key for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="ad799-354">Antes de empezar, asegúrese de haber completado las tareas necesarias para configurar el almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="ad799-354">Before you begin, ensure that you have completed the tasks required to set up Azure Key Vault.</span></span> <span data-ttu-id="ad799-355">Vea la [clave de cliente completar tareas en Azure Key Vault y Microsoft FastTrack](#complete-tasks-in-azure-key-vault-and-microsoft-fasttrack-for-customer-key) para obtener información.</span><span class="sxs-lookup"><span data-stu-id="ad799-355">See [Complete tasks in Azure Key Vault and Microsoft FastTrack for Customer Key](#complete-tasks-in-azure-key-vault-and-microsoft-fasttrack-for-customer-key) for information.</span></span>
  
<span data-ttu-id="ad799-356">Para configurar la clave de cliente de Exchange Online y Skype empresarial, tendrá que realizar estos pasos conectándose de forma remota a Exchange Online con Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-356">To set up Customer Key for Exchange Online and Skype for Business, you will need to perform these steps by remotely connecting to Exchange Online with Windows PowerShell.</span></span>
  
### <a name="create-a-data-encryption-policy-dep-for-use-with-exchange-online-and-skype-for-business"></a><span data-ttu-id="ad799-357">Crear una directiva de cifrado de datos (DEP) para su uso con Exchange Online y Skype empresarial</span><span class="sxs-lookup"><span data-stu-id="ad799-357">Create a data encryption policy (DEP) for use with Exchange Online and Skype for Business</span></span>

<span data-ttu-id="ad799-358">Un DEP está asociado a un conjunto de claves almacenadas en Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ad799-358">A DEP is associated with a set of keys stored in Azure Key Vault.</span></span> <span data-ttu-id="ad799-359">Asigna un DEP a un buzón de correo en Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="ad799-359">You assign a DEP to a mailbox in Microsoft 365.</span></span> <span data-ttu-id="ad799-360">A continuación, Microsoft 365 usará las claves identificadas en la Directiva para cifrar el buzón de correo.</span><span class="sxs-lookup"><span data-stu-id="ad799-360">Microsoft 365 will then use the keys identified in the policy to encrypt the mailbox.</span></span> <span data-ttu-id="ad799-361">Para crear la DEP, necesita los URI de la bóveda de clave que obtuvo antes.</span><span class="sxs-lookup"><span data-stu-id="ad799-361">To create the DEP, you need the Key Vault URIs you obtained earlier.</span></span> <span data-ttu-id="ad799-362">Consulte [obtener el URI de cada clave de Azure Key Vault](#obtain-the-uri-for-each-azure-key-vault-key) para obtener instrucciones.</span><span class="sxs-lookup"><span data-stu-id="ad799-362">See [Obtain the URI for each Azure Key Vault key](#obtain-the-uri-for-each-azure-key-vault-key) for instructions.</span></span>
  
<span data-ttu-id="ad799-363">Recuerde!</span><span class="sxs-lookup"><span data-stu-id="ad799-363">Remember!</span></span> <span data-ttu-id="ad799-364">Cuando se crea un DEP, se especifican dos claves que residen en dos depósitos de clave de Azure diferentes.</span><span class="sxs-lookup"><span data-stu-id="ad799-364">When you create a DEP, you specify two keys that reside in two different Azure Key Vaults.</span></span> <span data-ttu-id="ad799-365">Asegúrese de que estas claves se encuentran en dos regiones de Azure independientes para garantizar la redundancia geográfica.</span><span class="sxs-lookup"><span data-stu-id="ad799-365">Ensure that these keys are located in two separate Azure regions to ensure geo-redundancy.</span></span>
  
<span data-ttu-id="ad799-366">Para crear la DEP, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="ad799-366">To create the DEP, follow these steps:</span></span>
  
1. <span data-ttu-id="ad799-367">En el equipo local, con una cuenta profesional o educativa que tenga permisos de administrador global en su organización, [Conéctese a PowerShell de Exchange Online](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps) abriendo Windows PowerShell y ejecutando el siguiente comando.</span><span class="sxs-lookup"><span data-stu-id="ad799-367">On your local computer, using a work or school account that has global administrator permissions in your organization, [connect to Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps) by opening Windows PowerShell and running the following command.</span></span>

   ```powershell
   $UserCredential = Get-Credential
   ```

2. <span data-ttu-id="ad799-368">En el cuadro de diálogo solicitud de credenciales para Windows PowerShell, escriba la información de su cuenta profesional o educativa, haga clic en **Aceptar**y, a continuación, escriba el siguiente comando.</span><span class="sxs-lookup"><span data-stu-id="ad799-368">In the Windows PowerShell Credential Request dialog box, enter your work or school account information, click **OK**, and then enter the following command.</span></span>

   ```powershell
   $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://outlook.office365.com/powershell-liveid/ -Credential $UserCredential -Authentication Basic -AllowRedirection
   ```

3. <span data-ttu-id="ad799-369">Ejecute el comando siguiente.</span><span class="sxs-lookup"><span data-stu-id="ad799-369">Run the following command.</span></span>

   ```powershell
   Import-PSSession $Session
   ```

4. <span data-ttu-id="ad799-370">Para crear un DEP, use el cmdlet New-DataEncryptionPolicy; para ello, escriba el siguiente comando.</span><span class="sxs-lookup"><span data-stu-id="ad799-370">To create a DEP, use the New-DataEncryptionPolicy cmdlet by typing the following command.</span></span>

   ```powershell
   New-DataEncryptionPolicy -Name <PolicyName> -Description "Policy Description" -AzureKeyIDs <KeyVaultURI1>, <KeyVaultURI2>
   ```

   <span data-ttu-id="ad799-371">Donde:</span><span class="sxs-lookup"><span data-stu-id="ad799-371">Where:</span></span>

   - <span data-ttu-id="ad799-372">*PolicyName* es el nombre que desea usar para la Directiva.</span><span class="sxs-lookup"><span data-stu-id="ad799-372">*PolicyName* is the name you want to use for the policy.</span></span> <span data-ttu-id="ad799-373">Los nombres no pueden contener espacios.</span><span class="sxs-lookup"><span data-stu-id="ad799-373">Names cannot contain spaces.</span></span> <span data-ttu-id="ad799-374">Por ejemplo, USA_mailboxes.</span><span class="sxs-lookup"><span data-stu-id="ad799-374">For example, USA_mailboxes.</span></span>

   - <span data-ttu-id="ad799-375">La descripción de la *Directiva* es una descripción de la Directiva que le ayudará a recordar qué es la Directiva.</span><span class="sxs-lookup"><span data-stu-id="ad799-375">*Policy Description* is a user friendly description of the policy that will help you remember what the policy is for.</span></span> <span data-ttu-id="ad799-376">Puede incluir espacios en la descripción.</span><span class="sxs-lookup"><span data-stu-id="ad799-376">You can include spaces in the description.</span></span> <span data-ttu-id="ad799-377">Por ejemplo, "clave raíz para buzones de correo en Estados Unidos y sus zonas de ventas".</span><span class="sxs-lookup"><span data-stu-id="ad799-377">For example, "Root key for mailboxes in USA and its territories".</span></span>

   - <span data-ttu-id="ad799-378">*KeyVaultURI1* es el URI para la primera clave de la Directiva.</span><span class="sxs-lookup"><span data-stu-id="ad799-378">*KeyVaultURI1* is the URI for the first key in the policy.</span></span> <span data-ttu-id="ad799-379">Por ejemplo, https://contoso_EastUSvault01.vault.azure.net/keys/USA_key_01.</span><span class="sxs-lookup"><span data-stu-id="ad799-379">For example, https://contoso_EastUSvault01.vault.azure.net/keys/USA_key_01.</span></span>

   - <span data-ttu-id="ad799-380">*KeyVaultURI2* es el URI de la segunda clave de la Directiva.</span><span class="sxs-lookup"><span data-stu-id="ad799-380">*KeyVaultURI2* is the URI for the second key in the policy.</span></span> <span data-ttu-id="ad799-381">Por ejemplo, https://contoso_EastUS2vault01.vault.azure.net/keys/USA_Key_02.</span><span class="sxs-lookup"><span data-stu-id="ad799-381">For example, https://contoso_EastUS2vault01.vault.azure.net/keys/USA_Key_02.</span></span> <span data-ttu-id="ad799-382">Separe los dos URI por una coma y un espacio.</span><span class="sxs-lookup"><span data-stu-id="ad799-382">Separate the two URIs by a comma and a space.</span></span>

   <span data-ttu-id="ad799-383">Ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ad799-383">Example:</span></span>
  
   ```powershell
   New-DataEncryptionPolicy -Name USA_mailboxes -Description "Root key for mailboxes in USA and its territories" -AzureKeyIDs https://contoso_EastUSvault01.vault.azure.net/keys/USA_key_01, https://contoso_EastUS2vault01.vault.azure.net/keys/USA_Key_02
   ```

### <a name="assign-a-dep-to-a-mailbox"></a><span data-ttu-id="ad799-384">Asignar una DEP a un buzón</span><span class="sxs-lookup"><span data-stu-id="ad799-384">Assign a DEP to a mailbox</span></span>

<span data-ttu-id="ad799-385">Asigne la DEP a un buzón mediante el cmdlet Set-Mailbox.</span><span class="sxs-lookup"><span data-stu-id="ad799-385">Assign the DEP to a mailbox by using the Set-Mailbox cmdlet.</span></span> <span data-ttu-id="ad799-386">Una vez asignada la Directiva, Microsoft 365 puede cifrar el buzón con la clave designada en la DEP.</span><span class="sxs-lookup"><span data-stu-id="ad799-386">Once you assign the policy, Microsoft 365 can encrypt the mailbox with the key designated in the DEP.</span></span>
  
```powershell
Set-Mailbox -Identity <MailboxIdParameter> -DataEncryptionPolicy <PolicyName>
```

<span data-ttu-id="ad799-387">Donde *MailboxIdParameter* especifica un buzón.</span><span class="sxs-lookup"><span data-stu-id="ad799-387">Where *MailboxIdParameter* specifies a mailbox.</span></span> <span data-ttu-id="ad799-388">Para obtener más información acerca del cmdlet Set-Mailbox, consulte [set-Mailbox](https://docs.microsoft.com/powershell/module/exchange/mailboxes/set-mailbox?view=exchange-ps).</span><span class="sxs-lookup"><span data-stu-id="ad799-388">For more information about the Set-Mailbox cmdlet, see [Set-Mailbox](https://docs.microsoft.com/powershell/module/exchange/mailboxes/set-mailbox?view=exchange-ps).</span></span>
  
### <a name="validate-mailbox-encryption"></a><span data-ttu-id="ad799-389">Validar el cifrado de buzones</span><span class="sxs-lookup"><span data-stu-id="ad799-389">Validate mailbox encryption</span></span>

<span data-ttu-id="ad799-390">El cifrado de un buzón puede tardar algún tiempo.</span><span class="sxs-lookup"><span data-stu-id="ad799-390">Encrypting a mailbox can take some time.</span></span> <span data-ttu-id="ad799-391">Para la asignación de directivas primera vez, el buzón también debe moverse completamente de una base de datos a otra antes de que el servicio pueda cifrar el buzón.</span><span class="sxs-lookup"><span data-stu-id="ad799-391">For first time policy assignment, the mailbox must also completely move from one database to another before the service can encrypt the mailbox.</span></span> <span data-ttu-id="ad799-392">Se recomienda esperar 72 horas antes de intentar validar el cifrado después de cambiar una DEP o la primera vez que asigna un DEP a un buzón.</span><span class="sxs-lookup"><span data-stu-id="ad799-392">We recommend that you wait 72 hours before you attempt to validate encryption after you change a DEP or the first time you assign a DEP to a mailbox.</span></span>
  
<span data-ttu-id="ad799-393">Use el cmdlet Get-MailboxStatistics para determinar si un buzón está cifrado.</span><span class="sxs-lookup"><span data-stu-id="ad799-393">Use the Get-MailboxStatistics cmdlet to determine if a mailbox is encrypted.</span></span>
  
```powershell
Get-MailboxStatistics -Identity <GeneralMailboxOrMailUserIdParameter> | fl IsEncrypted
```

<span data-ttu-id="ad799-394">La propiedad IsEncrypted devuelve un valor **true** si el buzón está cifrado y un valor de **false** si el buzón no está cifrado.</span><span class="sxs-lookup"><span data-stu-id="ad799-394">The IsEncrypted property returns a value of **true** if the mailbox is encrypted and a value of **false** if the mailbox is not encrypted.</span></span>

<span data-ttu-id="ad799-395">El tiempo para completar los movimientos de buzones depende del número de buzones a los que se asigna la DEP por primera vez, así como del tamaño de los buzones.</span><span class="sxs-lookup"><span data-stu-id="ad799-395">The time to complete mailbox moves depends on the number of mailboxes to which you assign a DEP for the first time, as well as the size of the mailboxes.</span></span> <span data-ttu-id="ad799-396">Si los buzones no se han cifrado después de una semana desde el momento en que asignó la DEP, póngase en contacto con Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ad799-396">If the mailboxes have not been encrypted after a week from the time you assigned the DEP, contact Microsoft.</span></span>

## <a name="office-365-setting-up-customer-key-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="ad799-397">Office 365: configuración de la clave de cliente para SharePoint Online, OneDrive para la empresa y archivos de Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="ad799-397">Office 365: Setting up Customer Key for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="ad799-398">Antes de empezar, asegúrese de haber completado las tareas necesarias para configurar el almacén de claves de Azure.</span><span class="sxs-lookup"><span data-stu-id="ad799-398">Before you begin, ensure that you have completed the tasks required to set up Azure Key Vault.</span></span> <span data-ttu-id="ad799-399">Vea la [clave de cliente completar tareas en Azure Key Vault y Microsoft FastTrack](#complete-tasks-in-azure-key-vault-and-microsoft-fasttrack-for-customer-key) para obtener información.</span><span class="sxs-lookup"><span data-stu-id="ad799-399">See [Complete tasks in Azure Key Vault and Microsoft FastTrack for Customer Key](#complete-tasks-in-azure-key-vault-and-microsoft-fasttrack-for-customer-key) for information.</span></span>
  
<span data-ttu-id="ad799-400">Para configurar la clave de cliente para SharePoint Online, OneDrive para la empresa y los archivos de Teams, debe realizar estos pasos conectándose de forma remota a SharePoint Online con Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-400">To set up Customer Key for SharePoint Online, OneDrive for Business, and Teams files you will need to perform these steps by remotely connecting to SharePoint Online with Windows PowerShell.</span></span>
  
### <a name="create-a-data-encryption-policy-dep-for-each-sharepoint-online-and-onedrive-for-business-geo"></a><span data-ttu-id="ad799-401">Crear una directiva de cifrado de datos (DEP) para cada geográfico de SharePoint Online y OneDrive para la empresa</span><span class="sxs-lookup"><span data-stu-id="ad799-401">Create a data encryption policy (DEP) for each SharePoint Online and OneDrive for Business geo</span></span>

<span data-ttu-id="ad799-402">Asocia un DEP con un conjunto de claves almacenadas en Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="ad799-402">You associate a DEP with a set of keys stored in Azure Key Vault.</span></span> <span data-ttu-id="ad799-403">Se aplica una DEP a todos los datos en una ubicación geográfica, también denominada geo.</span><span class="sxs-lookup"><span data-stu-id="ad799-403">You apply a DEP to all of your data in one geographic location, also called a geo.</span></span> <span data-ttu-id="ad799-404">Si usa la característica multigeográfica de Office 365, puede crear un DEP por geográfico con la capacidad de usar diferentes claves por geográfico.</span><span class="sxs-lookup"><span data-stu-id="ad799-404">If you use the multi-geo feature of Office 365, you can create one DEP per geo with the capability to use different keys per geo.</span></span> <span data-ttu-id="ad799-405">Si no usa multigeográfico, puede crear un DEP en su organización para usarlo con los archivos de SharePoint Online, OneDrive para la empresa y Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="ad799-405">If you are not using multi-geo, you can create one DEP in your organization for use with SharePoint Online, OneDrive for Business, and Teams files.</span></span> <span data-ttu-id="ad799-406">Microsoft 365 usa las claves identificadas en el DEP para cifrar los datos en esa geografía.</span><span class="sxs-lookup"><span data-stu-id="ad799-406">Microsoft 365 uses the keys identified in the DEP to encrypt your data in that geo.</span></span> <span data-ttu-id="ad799-407">Para crear la DEP, necesita los URI de la bóveda de clave que obtuvo antes.</span><span class="sxs-lookup"><span data-stu-id="ad799-407">To create the DEP, you need the Key Vault URIs you obtained earlier.</span></span> <span data-ttu-id="ad799-408">Consulte [obtener el URI de cada clave de Azure Key Vault](#obtain-the-uri-for-each-azure-key-vault-key) para obtener instrucciones.</span><span class="sxs-lookup"><span data-stu-id="ad799-408">See [Obtain the URI for each Azure Key Vault key](#obtain-the-uri-for-each-azure-key-vault-key) for instructions.</span></span>
  
<span data-ttu-id="ad799-409">Recuerde!</span><span class="sxs-lookup"><span data-stu-id="ad799-409">Remember!</span></span> <span data-ttu-id="ad799-410">Cuando se crea un DEP, se especifican dos claves que residen en dos depósitos de clave de Azure diferentes.</span><span class="sxs-lookup"><span data-stu-id="ad799-410">When you create a DEP, you specify two keys that reside in two different Azure Key Vaults.</span></span> <span data-ttu-id="ad799-411">Asegúrese de que estas claves se encuentran en dos regiones de Azure independientes para garantizar la redundancia geográfica.</span><span class="sxs-lookup"><span data-stu-id="ad799-411">Ensure that these keys are located in two separate Azure regions to ensure geo-redundancy.</span></span>
  
<span data-ttu-id="ad799-412">Para crear un DEP, debe conectarse de forma remota a SharePoint Online mediante Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ad799-412">To create a DEP, you need to remotely connect to SharePoint Online by using Windows PowerShell.</span></span>
  
1. <span data-ttu-id="ad799-413">En el equipo local, con una cuenta profesional o educativa que tenga permisos de administrador global en su organización, [Conéctese a SharePoint Online PowerShell](https://docs.microsoft.com/powershell/sharepoint/sharepoint-online/connect-sharepoint-online?view=sharepoint-ps).</span><span class="sxs-lookup"><span data-stu-id="ad799-413">On your local computer, using a work or school account that has global administrator permissions in your organization, [Connect to SharePoint Online Powershell](https://docs.microsoft.com/powershell/sharepoint/sharepoint-online/connect-sharepoint-online?view=sharepoint-ps).</span></span>

2. <span data-ttu-id="ad799-414">En el shell de administración de Microsoft SharePoint Online, ejecute el cmdlet Register-SPODataEncryptionPolicy de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="ad799-414">In the Microsoft SharePoint Online Management Shell, run the Register-SPODataEncryptionPolicy cmdlet as follows:</span></span>

   ```powershell
   Register-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl> -PrimaryKeyVaultName <PrimaryKeyVaultName> -PrimaryKeyName <PrimaryKeyName> -PrimaryKeyVersion <PrimaryKeyVersion> -SecondaryKeyVaultName <SecondaryKeyVaultName> -SecondaryKeyName <SecondaryKeyName> -SecondaryKeyVersion <SecondaryKeyVersion>
   ```

   <span data-ttu-id="ad799-415">Cuando registra el DEP, el cifrado comienza en los datos de la geografía.</span><span class="sxs-lookup"><span data-stu-id="ad799-415">When you register the DEP, encryption begins on the data in the geo.</span></span> <span data-ttu-id="ad799-416">Esto puede tardar algún tiempo.</span><span class="sxs-lookup"><span data-stu-id="ad799-416">This can take some time.</span></span>

### <a name="validate-file-encryption"></a><span data-ttu-id="ad799-417">Validar el cifrado de archivos</span><span class="sxs-lookup"><span data-stu-id="ad799-417">Validate file encryption</span></span>

 <span data-ttu-id="ad799-418">Para validar el cifrado de los archivos de SharePoint Online, OneDrive para la empresa y Microsoft Teams, [Conéctese a SharePoint Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps)y, a continuación, use el cmdlet Get-SPODataEncryptionPolicy para comprobar el estado del espacio empresarial.</span><span class="sxs-lookup"><span data-stu-id="ad799-418">To validate encryption of SharePoint Online, OneDrive for Business, and Teams files, [connect to SharePoint Online PowerShell](https://docs.microsoft.com/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps), and then use the Get-SPODataEncryptionPolicy cmdlet to check the status of your tenant.</span></span> <span data-ttu-id="ad799-419">La propiedad _State_ devuelve un valor de **registrado** si el cifrado de clave de cliente está habilitado y todos los archivos de todos los sitios se han cifrado.</span><span class="sxs-lookup"><span data-stu-id="ad799-419">The _State_ property returns a value of **registered** if Customer Key encryption is enabled and all files in all sites have been encrypted.</span></span> <span data-ttu-id="ad799-420">Si el cifrado todavía está en curso, este cmdlet proporciona información sobre el porcentaje de sitios que se ha completado.</span><span class="sxs-lookup"><span data-stu-id="ad799-420">If encryption is still in progress, this cmdlet provides information on what percentage of sites is complete.</span></span>

## <a name="related-articles"></a><span data-ttu-id="ad799-421">Artículos relacionados</span><span class="sxs-lookup"><span data-stu-id="ad799-421">Related articles</span></span>

- [<span data-ttu-id="ad799-422">Cifrado de servicio con clave de cliente</span><span class="sxs-lookup"><span data-stu-id="ad799-422">Service encryption with Customer Key</span></span>](customer-key-overview.md)

- [<span data-ttu-id="ad799-423">Administrar la clave de cliente</span><span class="sxs-lookup"><span data-stu-id="ad799-423">Manage Customer Key</span></span>](customer-key-manage.md)

- [<span data-ttu-id="ad799-424">Rotar o alternar una Clave de cliente o una clave de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="ad799-424">Roll or rotate a Customer Key or an availability key</span></span>](customer-key-availability-key-roll.md)

- [<span data-ttu-id="ad799-425">Obtener información sobre la clave de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="ad799-425">Learn about the availability key</span></span>](customer-key-availability-key-understand.md)

- [<span data-ttu-id="ad799-426">Cifrado de servicio</span><span class="sxs-lookup"><span data-stu-id="ad799-426">Service Encryption</span></span>](office-365-service-encryption.md)
