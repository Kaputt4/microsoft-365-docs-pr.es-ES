---
title: Configurar directivas antimalware
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
ms.localizationpriority: medium
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
- m365initiative-defender-office365
description: Los administradores pueden aprender a ver, crear, modificar y quitar directivas antimalware en Exchange Online Protection (EOP).
ms.custom:
- seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 755eddad6062def1f4f6c0b20d117bfa78afa6d0
ms.sourcegitcommit: 997eb64f80da99b1099daba62994c722bbb25d72
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/16/2022
ms.locfileid: "66128885"
---
# <a name="configure-anti-malware-policies-in-eop"></a>Configuración de directivas antimalware en EOP

[!INCLUDE [MDO Trial banner](../includes/mdo-trial-banner.md)]

**Se aplica a**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Plan 1 y Plan 2 de Microsoft Defender para Office 365](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

En Microsoft 365 organizaciones con buzones de correo en organizaciones Exchange Online o independientes de Exchange Online Protection (EOP) sin Exchange Online buzones, los mensajes de correo electrónico se protegen automáticamente contra malware mediante EOP. EOP usa directivas antimalware para la configuración de protección contra malware. Para obtener más información, consulte [Protección contra malware](anti-malware-protection.md).

Los administradores pueden ver, editar y configurar (pero no eliminar) la directiva antimalware predeterminada para satisfacer las necesidades de sus organizaciones. Para una mayor granularidad, también puede crear directivas antimalware personalizadas que se apliquen a usuarios, grupos o dominios específicos de la organización. Las directivas personalizadas siempre tienen prioridad sobre las directivas predeterminadas, pero su prioridad (el orden de ejecución) se puede cambiar.

Puede configurar directivas antimalware en el portal de Microsoft 365 Defender o en PowerShell (Exchange Online PowerShell para organizaciones Microsoft 365 con buzones en Exchange Online; PowerShell EOP independiente para organizaciones sin Exchange Online buzones).

## <a name="what-do-you-need-to-know-before-you-begin"></a>¿Qué necesita saber antes de comenzar?

- Abra el portal de Microsoft 365 Defender en <https://security.microsoft.com>. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

- Para conectarse al PowerShell de Exchange Online, consulte [Conexión a Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell). Para conectarse a EOP PowerShell independiente, consulte [Connect to Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell) (Conexión a Exchange Online Protection PowerShell).

- Debe tener permisos asignados en **Exchange Online** antes de poder realizar los procedimientos de este artículo:
  - Para agregar, modificar y eliminar directivas antimalware, debe ser miembro de los grupos de roles Administración de la **organización** o **Administrador de seguridad** .
  - Para el acceso de solo lectura a las directivas antimalware, debe ser miembro de los grupos de roles **Lector global** o **Lector de seguridad** .

  Para obtener más información, consulte los [permisos en Exchange Online](/exchange/permissions-exo/permissions-exo).

  **Notas**:

  - La adición de usuarios al rol correspondiente de Azure Active Directory en el Centro de administración de Microsoft 365 proporciona a los usuarios los permisos necesarios _y_ los permisos para otras características de Microsoft 365. Para obtener más información, consulte [Acerca de los roles de administrador](../../admin/add-users/about-admin-roles.md).
  - El grupo de roles **Administración de organización de solo lectura** en [Exchange Online](/Exchange/permissions-exo/permissions-exo#role-groups) también proporciona acceso de solo lectura a la característica.

- Para ver nuestra configuración recomendada para las directivas antimalware, consulte [Configuración de directivas antimalware de EOP](recommended-settings-for-eop-and-office365.md#eop-anti-malware-policy-settings).

## <a name="use-the-microsoft-365-defender-portal-to-create-anti-malware-policies"></a>Uso del portal de Microsoft 365 Defender para crear directivas antimalware

La creación de una directiva antimalware personalizada en el portal de Microsoft 365 Defender crea la regla de filtro de malware y la directiva de filtro de malware asociada al mismo tiempo con el mismo nombre para ambos.

1. En el portal de Microsoft 365 Defender en <https://security.microsoft.com>, vaya a **Correo electrónico &** Directivas de colaboración \> **& Reglas** \> **Directivas de amenazas** \> **antimalware** en la sección **Directivas**. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

2. En la página **Antimalware** , haga clic en ![el icono Crear.](../../media/m365-cc-sc-create-icon.png) **Create**.

3. Se abrirá el asistente para directivas. En la página **Nombre de la directiva** , configure estas opciones:
   - **Nombre**: escriba un nombre único y descriptivo para la directiva.
   - **Descripción**: escriba una descripción opcional para la directiva.

   Cuando termine, haga clic en **Siguiente**.

4. En la página **Usuarios y dominios** que aparece, identifique los destinatarios internos a los que se aplica la directiva (condiciones de destinatario):
   - **Usuarios**: los buzones de correo, los usuarios de correo o los contactos de correo especificados.
   - **Grupos**:
     - Miembros de los grupos de distribución o grupos de seguridad habilitados para correo especificados.
     - Los Grupos de Microsoft 365 especificados.
   - **Dominios**: todos los destinatarios de los [dominios aceptados](/exchange/mail-flow-best-practices/manage-accepted-domains/manage-accepted-domains) especificados en la organización.

   Haga clic en el cuadro correspondiente, comience a escribir un valor y seleccione el valor que desee de los resultados. Repita este proceso tantas veces como sea necesario. Para quitar un valor existente, haga clic en Quitar ![Icono Quitar.](../../media/m365-cc-sc-remove-selection-icon.png) junto al valor.

   Para los usuarios o grupos, puede utilizar la mayoría de los identificadores (nombre, nombre para mostrar, alias, dirección de correo electrónico, nombre de la cuenta, etc.), pero el nombre para mostrar correspondiente se muestra en los resultados. Para los usuarios, introduzca un asterisco (\*) por sí mismo para ver todos los valores disponibles.

   Varios valores en la misma condición usan la lógica OR (por ejemplo, _\<recipient1\>_ o _\<recipient2\>_). Hay diferentes condiciones que usan la lógica AND (por ejemplo, _\<recipient1\>_ y _\<member of group 1\>_).

   - **Excluir estos usuarios, grupos y dominios**: para agregar excepciones para los destinatarios internos a los que se aplica la directiva (excepciones de destinatarios), seleccione esta opción y configure las excepciones. La configuración y el comportamiento son exactamente iguales a las condiciones.

   > [!IMPORTANT]
   > Varias condiciones o excepciones diferentes no son aditivas; son inclusivos. La directiva _solo_ se aplica a los destinatarios que coinciden _con todos los_ filtros de destinatarios especificados. Por ejemplo, configure una condición de filtro de destinatario en la directiva con los siguientes valores:
   >
   > - El destinatario es: romain@contoso.com
   > - El destinatario es miembro de: Ejecutivos
   >
   > La política se aplica a romain@contoso.com _solo_ si también es miembro de los grupos ejecutivos. Si no es miembro del grupo, la directiva no se aplica a él.
   >
   > Del mismo modo, si usa el mismo filtro de destinatario como excepción a la directiva, la directiva no se aplica a romain@contoso.com _solo_ si también es miembro de los grupos ejecutivos. Si no es miembro del grupo, la política se aplica a él.

   Cuando termine, haga clic en **Siguiente**.

5. En la página **Configuración de protección** que aparece, configure los siguientes valores:

   - **Habilitar el filtro de datos adjuntos comunes**: si selecciona esta opción, los mensajes con los datos adjuntos especificados se tratan como malware y se ponen en cuarentena automáticamente. Para modificar la lista predeterminada, seleccione **Personalizar tipos de archivo**.

   - **Habilitar la purga automática de cero horas para malware**: si selecciona esta opción, ZAP pone en cuarentena los mensajes de malware que ya se han entregado. Para obtener más información, vea [Purga automática de hora cero (ZAP) en Exchange Online](zero-hour-auto-purge.md). Seleccione uno de estos valores:

   - **Directiva de cuarentena**: seleccione la directiva de cuarentena que se aplica a los mensajes que se ponen en cuarentena como malware. Las directivas de cuarentena definen qué pueden hacer los usuarios en los mensajes en cuarentena y si los usuarios reciben notificaciones de cuarentena. Para más información, vea [Directivas de cuarentena](quarantine-policies.md).

     Un valor en blanco significa que se usa la directiva de cuarentena predeterminada (AdminOnlyAccessPolicy para las detecciones de malware). Cuando más adelante edite la directiva antimalware o vea la configuración, se muestra el nombre predeterminado de la directiva de cuarentena. Para obtener más información sobre las directivas de cuarentena predeterminadas que se usan para veredictos de filtrado de protección admitidos, consulte [esta tabla](quarantine-policies.md#step-2-assign-a-quarantine-policy-to-supported-features).

     > [!NOTE]
     > Los usuarios no pueden liberar sus propios mensajes que se pusieron en cuarentena como malware. En el mejor de los escenarios, los administradores pueden configurar la directiva de cuarentena para que los usuarios puedan solicitar la liberación de sus mensajes de malware en cuarentena.

   - **Notificar a los destinatarios cuando los mensajes se ponen en cuarentena como malware**:
     - Si selecciona esta opción, el mensaje se pone en cuarentena. Se entrega una copia del mensaje a los destinatarios, pero _todos los_ datos adjuntos (no solo los datos adjuntos de malware) se reemplazan por un único archivo de texto denominado **Alerta de malware Text.txt**.

       El texto predeterminado del archivo de texto de reemplazo se describe en [Directivas antimalware](anti-malware-protection.md#anti-malware-policies). Para usar texto personalizado en su lugar, escriba el texto en el cuadro **Texto de notificación personalizado al destinatario** .

     - Si no selecciona esta opción, el mensaje se pone en cuarentena silenciosamente.

     > [!NOTE]
     > Independientemente de la opción que seleccione, la directiva de cuarentena determina si los destinatarios reciben notificaciones de cuarentena (notificaciones por correo electrónico para los mensajes que se pusieron en cuarentena como malware).

   - **Notificaciones del remitente**: seleccione ninguna, una o ambas opciones:
       - **Notificar a los remitentes internos cuando los mensajes se ponen en cuarentena como malware**: un remitente interno está dentro de la organización.
       - **Notificar a los remitentes externos cuando los mensajes se ponen en cuarentena como malware**: un remitente externo está fuera de la organización.

   - **Administración notificaciones**: seleccione ninguna, una o ambas opciones:
       - **Notificar a un administrador acerca de los mensajes no entregados de remitentes internos**: si selecciona esta opción, escriba una dirección de correo electrónico de notificación en el cuadro **Administración dirección de correo electrónico** que aparece.
       - **Notificar a un administrador acerca de los mensajes no entregados de remitentes externos**: si selecciona esta opción, escriba una dirección de correo electrónico de notificación en el cuadro **Administración dirección de correo electrónico** que aparece.

     > [!NOTE]
     > Administración notificaciones solo se envían para _los datos adjuntos_ que se clasifican como malware.

   - **Personalizar notificaciones**: esta configuración reemplaza el texto de notificación predeterminado que se usa para remitentes o administradores. Para obtener más información sobre los valores predeterminados, consulte [Directivas antimalware](anti-malware-protection.md#anti-malware-policies).
       - **Usar texto de notificación personalizado**: si selecciona esta opción, debe usar los cuadros **De nombre** y **Desde dirección** para especificar el nombre del remitente y la dirección de correo electrónico que se usan en el mensaje de notificación personalizado.
       - **Personalización de notificaciones para mensajes de remitentes internos**: si decide notificar a los remitentes o administradores acerca de los mensajes no entregados de remitentes internos, debe usar los cuadros **Asunto** y **Mensaje** para especificar el asunto y el cuerpo del mensaje personalizado.
       - **Personalización de notificaciones para mensajes de remitentes externos**: si decide notificar a los remitentes o administradores sobre los mensajes no entregados de remitentes externos, debe usar los cuadros **Asunto** y **Mensaje** para especificar el asunto y el cuerpo del mensaje personalizado.

   Cuando termine, haga clic en **Siguiente**.

6. En la página **Revisar** que aparece, revise la configuración. Puede seleccionar **Editar** en cada sección para modificar la configuración dentro de la sección. También puede hacer clic en **Volver atrás** o seleccionar la página específica del asistente.

   Cuando haya terminado, haga clic en **Enviar**.

7. En la página de confirmación que aparece, haga clic en **Listo**.

## <a name="use-the-microsoft-365-defender-portal-to-view-anti-malware-policies"></a>Uso del portal de Microsoft 365 Defender para ver las directivas antimalware

1. En el portal de Microsoft 365 Defender en <https://security.microsoft.com>, vaya a **Correo electrónico &** Directivas de colaboración \> **& Reglas** \> **Directivas de amenazas** \> **antimalware** en la sección **Directivas**. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

2. En la página **Antimalware** , se muestran las siguientes propiedades en la lista de directivas antimalware:
   - **Nombre**
   - **Estado**
   - **Prioridad**

3. Al seleccionar una directiva haciendo clic en el nombre, la configuración de la directiva se muestra en un control flotante.

## <a name="use-the-microsoft-365-defender-portal-to-modify-anti-malware-policies"></a>Uso del portal de Microsoft 365 Defender para modificar directivas antimalware

1. En el portal de Microsoft 365 Defender en <https://security.microsoft.com>, vaya a **Correo electrónico &** Directivas de colaboración \> **& Reglas** \> **Directivas de amenazas** \> **antimalware** en la sección **Directivas**. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

2. En la página **Antimalware** , seleccione una directiva de la lista haciendo clic en el nombre.

3. En el control flotante de detalles de la directiva que aparece, seleccione **Editar** en cada sección para modificar la configuración dentro de la sección. Para obtener más información sobre la configuración, consulte la sección [Anterior Uso del portal de Microsoft 365 Defender para crear directivas antimalware](#use-the-microsoft-365-defender-portal-to-create-anti-malware-policies) en este artículo.

   Para la directiva antimalware predeterminada, la sección **Usuarios, grupos y dominios** no está disponible (la directiva se aplica a todos) y no se puede cambiar el nombre de la directiva.

Para habilitar o deshabilitar una directiva o establecer el orden de prioridad de la directiva, consulte las secciones siguientes.

### <a name="enable-or-disable-custom-anti-malware-policies"></a>Habilitación o deshabilitación de directivas de antimalware personalizadas

No se puede deshabilitar la directiva antimalware predeterminada.

1. En el portal de Microsoft 365 Defender en <https://security.microsoft.com>, vaya a **Correo electrónico &** Directivas de colaboración \> **& Reglas** \> **Directivas de amenazas** \> **antimalware** en la sección **Directivas**. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

2. En la página **Antimalware** , seleccione una directiva personalizada en la lista haciendo clic en el nombre.

3. En la parte superior del control flotante de detalles de la directiva que aparece, verá uno de los siguientes valores:
   - **Directiva desactivada**: para activar la directiva, haga clic en ![icono Activar.](../../media/m365-cc-sc-turn-on-off-icon.png) **Activar** .
   - **Directiva activada**: para desactivar la directiva, haga clic en el ![Icono Desactivar](../../media/m365-cc-sc-turn-on-off-icon.png) **Desactivar**.

4. En el cuadro de diálogo de confirmación que aparece, haga clic **Activar** o **Desactivar**.

5. Haga clic en **Cerrar** en el control flotante de detalles de la directiva.

De nuevo en la página principal de la directiva, el valor **Estado** de la directiva estará **Activado** o **Desactivado**.

### <a name="set-the-priority-of-custom-anti-malware-policies"></a>Establecer la prioridad de las directivas antimalware personalizadas

De forma predeterminada, las directivas antimalware tienen una prioridad que se basa en el orden en el que se crearon (las directivas más recientes tienen una prioridad menor que las directivas anteriores). Un número de prioridad más bajo indica una prioridad mayor de la directiva (0 es el más alto) y las directivas se procesan por orden de prioridad (las directivas de prioridad mayor se procesan antes que las directivas de prioridad menor). Ninguna de las dos directivas puede tener la misma prioridad, y el procesamiento de directivas se detendrá cuando se aplique la primera directiva.

Para cambiar la prioridad de una directiva, haga clic en **Aumentar prioridad** o **Reducir prioridad** en las propiedades de la directiva (no puede modificar directamente el número de **Prioridad** en el portal de Microsoft 365 Defender). Cambiar la prioridad de una directiva sólo tiene sentido si tiene varias directivas.

 **Notas**:

- En el portal de Microsoft 365 Defender, solo puede cambiar la prioridad de la directiva antimalware después de crearla. En PowerShell, puede invalidar la prioridad predeterminada al crear la regla de filtro de malware (que puede afectar a la prioridad de las reglas existentes).
- Las directivas antimalware se procesan en el orden en que se muestran (la primera directiva tiene el valor **de prioridad** 0). La directiva antimalware predeterminada tiene el valor de prioridad **Más bajo** y no se puede cambiar.

1. En el portal de Microsoft 365 Defender en <https://security.microsoft.com>, vaya a **Correo electrónico &** Directivas de colaboración \> **& Reglas** \> **Directivas de amenazas** \> **antimalware** en la sección **Directivas**. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

2. En la página **Antimalware** , seleccione una directiva personalizada en la lista haciendo clic en el nombre.

3. En la parte superior del control flotante de detalles de la directiva que aparece, verá **Aumentar la prioridad** o **Disminuir la prioridad** en función del valor de prioridad actual y del número de directivas personalizadas:
   - La directiva con el valor **De prioridad** **0** solo tiene la opción **Reducir prioridad** disponible.
   - La directiva con el valor **de prioridad** más bajo (por ejemplo, **3**) solo tiene la opción **Aumentar prioridad** disponible.
   - Si tiene tres o más directivas, las directivas entre los valores de prioridad más altos y más bajos tienen disponibles las opciones **Aumentar prioridad** y **Reducir prioridad** .

   Haga clic en el ![Icono Aumentar la prioridad.](../../media/m365-cc-sc-increase-icon.png) **Aumentar la prioridad** o en el ![Icono Disminuir la prioridad](../../media/m365-cc-sc-decrease-icon.png) **Reducir la prioridad** para cambiar el valor de **Prioridad**.

4. Cuando haya terminado, haga clic en **Cerrar** en el control flotante de detalles de la directiva.

## <a name="use-the-microsoft-365-defender-portal-to-remove-custom-anti-malware-policies"></a>Uso del portal de Microsoft 365 Defender para quitar directivas antimalware personalizadas

Cuando se usa el portal de Microsoft 365 Defender para quitar una directiva antimalware personalizada, se eliminan la regla de filtro de malware y la directiva de filtro de malware correspondiente. No se puede quitar la directiva antimalware predeterminada.

1. En el portal de Microsoft 365 Defender en <https://security.microsoft.com>, vaya a **Correo electrónico &** Directivas de colaboración \> **& Reglas** \> **Directivas de amenazas** \> **antimalware** en la sección **Directivas**. Para ir directamente a la página **Antimalware** , use <https://security.microsoft.com/antimalwarev2>.

2. En la **página Antimalware**, seleccione una directiva personalizada en la lista haciendo clic en el nombre.

3. En la parte superior del control flotante de detalles de la directiva que aparece, haga clic en ![icono Más acciones.](../../media/m365-cc-sc-more-actions-icon.png) **Más acciones** \> ![Icono Eliminar directiva](../../media/m365-cc-sc-delete-icon.png)**Eliminar directiva**.

4. En el cuadro de diálogo de confirmación que aparece, haga clic en **Sí**.

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>Use Exchange Online PowerShell o PowerShell EOP independiente para configurar directivas antimalware.

Para obtener más información sobre las directivas contra correo no deseado en PowerShell, consulte [Directivas antimalware en el portal de Microsoft 365 Defender frente a PowerShell](anti-malware-protection.md#anti-malware-policies-in-the-microsoft-365-defender-portal-vs-powershell).

### <a name="use-powershell-to-create-anti-malware-policies"></a>Uso de PowerShell para crear directivas antimalware

La creación de una directiva antimalware en PowerShell es un proceso de dos pasos:

1. Cree la directiva de filtro de malware.
2. Cree la regla de filtro de malware que especifica la directiva de filtro de malware a la que se aplica la regla.

 **Notas**:

- Puede crear una nueva regla de filtro de malware y asignarle una directiva de filtro de malware existente y no asociada. Una regla de filtro de malware no se puede asociar a más de una directiva de filtro de malware.
- Hay dos opciones que puede configurar en las nuevas directivas antimalware en PowerShell que no están disponibles en el portal de Microsoft 365 Defender hasta después de crear la directiva:
  - Cree la nueva directiva como deshabilitada (_Habilitada_ `$false` en el cmdlet **New-MalwareFilterRule** ).
  - Establezca la prioridad de la directiva durante la creación (_Prioridad_ _\<Number\>_) en el cmdlet **New-MalwareFilterRule** .
- Una nueva directiva de filtro de malware que cree en PowerShell no será visible en el portal de Microsoft 365 Defender hasta que asigne la directiva a una regla de filtro de malware.

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>Paso 1: Uso de PowerShell para crear una directiva de filtro de malware

**Nota**: En el servicio basado en la nube, los valores `DeleteMessage`del parámetro _Action_ , `DeleteAttachmentAndUseDefaultAlert`y `DeleteAttachmentAndUseCustomAlert` no eliminan los mensajes. En su lugar, los mensajes siempre se ponen en cuarentena. Para obtener más información sobre cómo recuperar mensajes en cuarentena, consulte [Administración de mensajes y archivos en cuarentena como administrador en EOP](manage-quarantined-messages-and-files.md).

Para crear una directiva de filtro de malware, use esta sintaxis:

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>] [-QuarantineTag <QuarantineTagName>]
```

En este ejemplo se crea una nueva directiva de filtro de malware denominada Contoso Malware Filter Policy con esta configuración:

- Poner en cuarentena los mensajes que contienen malware sin notificar a los destinatarios (no se usa el parámetro _Action_ y el valor predeterminado es `DeleteMessage`).
- No notifique al remitente del mensaje cuando se detecte malware en el mensaje (no se usan los parámetros _EnableExternalSenderNotifications_ o _EnableInternalSenderNotifications_ y el valor predeterminado para ambos es `$false`).
- Notificar al administrador admin@contoso.com cuando se detecta malware en un mensaje de un remitente interno.
- Se usa la [directiva de cuarentena](quarantine-policies.md) predeterminada para las detecciones de malware (no se usa el parámetro _QuarantineTag_ ).

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

Para obtener información detallada sobre la sintaxis y los parámetros, consulte [New-MalwareFilterPolicy](/powershell/module/exchange/new-malwarefilterpolicy).

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>Paso 2: Uso de PowerShell para crear una regla de filtro de malware

Para crear una regla de filtro de malware, use esta sintaxis:

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

En este ejemplo se crea una nueva regla de filtro de malware denominada Destinatarios de Contoso con esta configuración:

- La directiva de filtro de malware denominada Contoso Malware Filter Policy está asociada a la regla.
- La regla se aplica a los destinatarios del dominio contoso.com.

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

Para obtener información detallada sobre la sintaxis y los parámetros, vea [New-MalwareFilterRule](/powershell/module/exchange/new-malwarefilterrule).

### <a name="use-powershell-to-view-malware-filter-policies"></a>Uso de PowerShell para ver las directivas de filtro de malware

Para devolver una lista de resumen de todas las directivas de filtro de malware, ejecute este comando:

```PowerShell
Get-MalwareFilterPolicy
```

Para devolver información detallada sobre una directiva de filtro de malware específica, use esta sintaxis:

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

En este ejemplo se devuelven todos los valores de propiedad de la directiva de filtro de malware denominada Ejecutivos.

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

En este ejemplo solo se devuelven las propiedades especificadas para la misma directiva.

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

Para obtener información detallada sobre la sintaxis y los parámetros, consulte [Get-MalwareFilterPolicy](/powershell/module/exchange/get-malwarefilterpolicy).

### <a name="use-powershell-to-view-malware-filter-rules"></a>Uso de PowerShell para ver las reglas de filtro de malware

Para devolver una lista de resumen de todas las reglas de filtro de malware, ejecute este comando:

```PowerShell
Get-MalwareFilterRule
```

Para filtrar la lista mediante las reglas habilitadas o deshabilitadas, ejecute los siguientes comandos:

```PowerShell
Get-MalwareFilterRule -State Disabled
```

```PowerShell
Get-MalwareFilterRule -State Enabled
```

Para devolver información detallada sobre una regla de filtro de malware específica, use esta sintaxis:

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

En este ejemplo se devuelven todos los valores de propiedad de la regla de filtro de malware denominada Ejecutivos.

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

En el ejemplo solo se devuelven las propiedades especificadas para la misma regla.

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

Para obtener información detallada sobre la sintaxis y los parámetros, consulte [Get-MalwareFilterRule](/powershell/module/exchange/get-malwarefilterrule).

### <a name="use-powershell-to-modify-malware-filter-policies"></a>Uso de PowerShell para modificar directivas de filtro de malware

Aparte de los siguientes elementos, la misma configuración está disponible al modificar una directiva de filtro de malware en PowerShell que al crear la directiva como se describe en la sección [Paso 1: Usar PowerShell para crear una](#step-1-use-powershell-to-create-a-malware-filter-policy) directiva de filtro de malware anterior en este artículo.

- El modificador _MakeDefault_ que convierte la directiva especificada en la directiva predeterminada (aplicada a todos, prioridad **mínima** no modificable y no se puede eliminar) solo está disponible al modificar una directiva de filtro de malware en PowerShell.
- No se puede cambiar el nombre de una directiva de filtro de malware (el cmdlet **Set-MalwareFilterPolicy** no tiene ningún parámetro _Name_ ). Al cambiar el nombre de una directiva antimalware en el portal de Microsoft 365 Defender, solo se cambia el nombre de la _regla_ de filtro de malware.

Para modificar una directiva de filtro de malware, use esta sintaxis:

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

Para obtener información detallada sobre la sintaxis y los parámetros, consulte [Set-MalwareFilterPolicy](/powershell/module/exchange/set-malwarefilterpolicy).

> [!NOTE]
> Para obtener instrucciones detalladas para especificar la [directiva de cuarentena](quarantine-policies.md) que se usará en una directiva de filtro de malware, consulte [Uso de PowerShell para especificar la directiva de cuarentena en directivas antimalware](quarantine-policies.md#anti-malware-policies-in-powershell).

### <a name="use-powershell-to-modify-malware-filter-rules"></a>Uso de PowerShell para modificar las reglas de filtro de malware

La única configuración que no está disponible al modificar una regla de filtro de malware en PowerShell es el parámetro _Enabled_ que permite crear una regla deshabilitada. Para habilitar o deshabilitar las reglas de filtro de malware existentes, consulte la sección siguiente.

De lo contrario, no hay ninguna configuración adicional disponible al modificar una regla de filtro de malware en PowerShell. La misma configuración está disponible al crear una regla como se describe en la sección [Paso 2: Uso de PowerShell para crear una regla de filtro de malware](#step-2-use-powershell-to-create-a-malware-filter-rule) anteriormente en este artículo.

Para modificar una regla de filtro de malware, use esta sintaxis:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

Para obtener información detallada sobre la sintaxis y los parámetros, consulte [Set-MalwareFilterRule](/powershell/module/exchange/set-malwarefilterrule).

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>Uso de PowerShell para habilitar o deshabilitar reglas de filtro de malware

La habilitación o deshabilitación de una regla de filtro de malware en PowerShell habilita o deshabilita toda la directiva antimalware (la regla de filtro de malware y la directiva de filtro de malware asignada). No se puede habilitar ni deshabilitar la directiva antimalware predeterminada (siempre se aplica a todos los destinatarios).

Para habilitar o deshabilitar una regla de filtro de malware en PowerShell, use esta sintaxis:

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

En este ejemplo se deshabilita la regla de filtro de malware denominada Departamento de marketing.

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

Este ejemplo habilita la misma regla.

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

Para obtener información detallada sobre la sintaxis y los parámetros, vea [Enable-MalwareFilterRule](/powershell/module/exchange/enable-malwarefilterrule) y [Disable-MalwareFilterRule](/powershell/module/exchange/disable-malwarefilterrule).

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>Uso de PowerShell para establecer la prioridad de las reglas de filtro de malware

El valor de prioridad máximo que se puede establecer en una regla es 0. El valor mínimo depende del número de reglas. Por ejemplo, si tiene cinco reglas, puede usar los valores de prioridad del 0 al 4. El cambio de prioridad de una regla existente puede tener un efecto cascada en otras reglas. Por ejemplo, si tiene cinco reglas personalizadas (prioridades del 0 al 4) y cambia la prioridad de una regla a 2, la regla existente de prioridad 2 cambia a prioridad 3 y la regla de prioridad 3 cambia a prioridad 4.

Para establecer la prioridad de una regla de filtro de malware en PowerShell, use la sintaxis siguiente:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

En el ejemplo siguiente, la prioridad de la regla denominada "Marketing Department" se establece en 2. Todas las reglas existentes que tienen una prioridad menor o igual a 2 se reducen en 1 (sus números de prioridad aumentan en 1).

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**Notas**:

- Para establecer la prioridad de una nueva regla al crearla, use el parámetro _Priority_ en el cmdlet **New-MalwareFilterRule** en su lugar.
- La directiva de filtro de malware predeterminada no tiene una regla de filtro de malware correspondiente y siempre tiene el valor de prioridad no modificable **Más bajo**.

### <a name="use-powershell-to-remove-malware-filter-policies"></a>Uso de PowerShell para quitar directivas de filtro de malware

Cuando se usa PowerShell para quitar una directiva de filtro de malware, no se quita la regla de filtro de malware correspondiente.

Para quitar una directiva de filtro de malware en PowerShell, use esta sintaxis:

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

En este ejemplo se quita la directiva de filtro de malware denominada Departamento de marketing.

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

Para obtener información detallada sobre la sintaxis y los parámetros, consulte [Remove-MalwareFilterPolicy](/powershell/module/exchange/remove-malwarefilterpolicy).

### <a name="use-powershell-to-remove-malware-filter-rules"></a>Uso de PowerShell para quitar reglas de filtro de malware

Cuando se usa PowerShell para quitar una regla de filtro de malware, no se quita la directiva de filtro de malware correspondiente.

Para quitar una regla de filtro de malware en PowerShell, use esta sintaxis:

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

En este ejemplo se quita la regla de filtro de malware denominada Departamento de marketing.

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

Para obtener información detallada sobre la sintaxis y los parámetros, vea [Remove-MalwareFilterRule](/powershell/module/exchange/remove-malwarefilterrule).

## <a name="how-do-you-know-these-procedures-worked"></a>¿Cómo saber si estos procedimientos han funcionado?

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>Use el archivo EICAR.TXT para comprobar la configuración de la directiva antimalware.

> [!IMPORTANT]
> El archivo EICAR.TXT no es un virus. El Instituto Europeo de Investigación de Antivirus Informáticos (EICAR) desarrolló este archivo para probar de forma segura instalaciones y configuraciones antivirus.

1. Abra Bloc de notas y pegue el texto siguiente en un archivo vacío:

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   Asegúrese de que estos son los únicos caracteres de texto del archivo. El tamaño del archivo debe ser de 68 bytes.

2. Guarde el archivo como EICAR.TXT

   En el programa antivirus de escritorio, asegúrese de excluir el EICAR.TXT del examen (de lo contrario, el archivo se pondrá en cuarentena).

3. Envíe un mensaje de correo electrónico que contenga el archivo EICAR.TXT como datos adjuntos, mediante un cliente de correo electrónico que no bloqueará automáticamente el archivo y mediante un servicio de correo electrónico que no bloquee automáticamente el correo no deseado saliente. Use la configuración de la directiva antimalware para determinar los siguientes escenarios para probar:
   - Correo electrónico de un buzón interno a un destinatario interno.
   - Correo electrónico de un buzón interno a un destinatario externo.
   - Correo electrónico de un buzón externo a un destinatario interno.

4. Compruebe que el mensaje se puso en cuarentena y compruebe los resultados de la notificación de destinatario y remitente en función de la configuración de la directiva antimalware. Por ejemplo:
   - No se notifica a los destinatarios o los destinatarios reciben el mensaje original con los datos adjuntos EICAR.TXT reemplazados por **Text.txtde alerta de malware** que contiene el texto predeterminado o personalizado.
   - Los remitentes internos o externos reciben una notificación con los mensajes de notificación predeterminados o personalizados.
   - La dirección de correo electrónico del administrador que especificó recibe una notificación para los remitentes de mensajes internos o externos, con los mensajes de notificación predeterminados o personalizados.

5. Elimine el archivo EICAR.TXT una vez completadas las pruebas (para que otros usuarios no se alarmen innecesariamente por él).
