---
title: Usar reglas de flujo de correo para bloquear mensajes con datos adjuntos ejecutables
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: Los administradores pueden aprender a crear reglas de flujo de correo (reglas de transporte) para bloquear los mensajes que contienen datos adjuntos ejecutables.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 49a77ec701f3a71e20de398e7b6f2dc2185eef7f
ms.sourcegitcommit: 786f90a163d34c02b8451d09aa1efb1e1d5f543c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/18/2021
ms.locfileid: "50289286"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a>Usar reglas de flujo de correo para bloquear mensajes con datos adjuntos ejecutables en EOP

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**Se aplica a**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Plan 1 y Plan 2 de Microsoft Defender para Office 365](office-365-atp.md)
- [Microsoft 365 Defender](../mtp/microsoft-threat-protection.md)

En organizaciones de Microsoft 365 con buzones en Exchange Online o organizaciones independientes de Exchange Online Protection (EOP) sin buzones de Exchange Online, EOP usa directivas antimalware para bloquear mensajes dañinos, incluidos los mensajes con datos adjuntos ejecutables. Para obtener más información, vea [Protección antimalware en EOP.](anti-malware-protection.md)

Para mejorar aún más la protección, puede usar reglas de flujo de correo (también conocidas como reglas de transporte) para identificar y bloquear mensajes que contienen datos adjuntos ejecutables, como se describe en este artículo.

Por ejemplo, después de un ataque de malware, una empresa podría aplicar esta regla con un límite de tiempo para que los usuarios afectados puedan volver a enviar datos adjuntos después de un período de tiempo especificado.

## <a name="what-do-you-need-to-know-before-you-begin"></a>¿Qué necesita saber antes de empezar?

- Deberá tener asignados permisos en Exchange Online o Exchange Online Protection antes de poder realizar los procedimientos descritos en este artículo. Específicamente, necesita el rol **Reglas** de transporte, que se asigna  a los grupos de roles Administración de la **organización,** Administración de cumplimiento y Administración de registros de forma predeterminada.

  Para obtener más información, consulte los siguientes temas:

  - [Permisos de Exchange Online](https://docs.microsoft.com/exchange/permissions-exo/permissions-exo)
  - [Permisos en EOP independiente](feature-permissions-in-eop.md)
  - [Usar el EAC modificar la lista de miembros en grupos de roles](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)

- Para abrir el EAC en Exchange Online, consulte [Centro de administración de Exchange en Exchange Online.](https://docs.microsoft.com/Exchange/exchange-admin-center) Para abrir el EAC en EOP independiente, vea el Centro [de administración de Exchange en EOP independiente.](exchange-admin-center-in-exchange-online-protection-eop.md)

- Para conectarse al PowerShell de Exchange Online, consulte [Conexión a Exchange Online PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-powershell). Para conectarse a EOP PowerShell independiente, consulte [Connect to Exchange Online Protection PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-exchange-online-protection-powershell) (Conexión a Exchange Online Protection PowerShell).

- Para obtener más información acerca de las reglas de flujo de correo en Exchange Online y EOP independiente, consulte los siguientes temas:

  - [Reglas de flujo de correo (reglas de transporte) en Exchange Online](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [Excepciones y condiciones de regla de flujo de correo (predicados) en Exchange Online](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [Acciones de regla de flujo de correo en Exchange Online](https://docs.microsoft.com/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a>Usar el EAC para crear una regla que bloquee los mensajes con datos adjuntos ejecutables

1. En el EAC, vaya a **Flujo de correo** \> **Reglas**.

2. Haga **clic en** el icono Agregar ![ ](../../media/ITPro-EAC-AddIcon.png) y, a **continuación, seleccione Crear una nueva regla.**

3. En la ventana **Nueva regla** que se abre, configure las siguientes opciones:

   - **Nombre:** escriba un nombre único y descriptivo para la regla.

   - Haga clic en **Más opciones**.

   - **Aplique esta regla si**: Seleccionar **cualquier dato adjunto** tiene \> **contenido ejecutable.**

   - **Haga lo siguiente:** seleccione **Bloquear el mensaje** y, a continuación, elija la acción que desee:

     - **rechazar el** mensaje e incluir  una explicación: en el cuadro de diálogo Especificar motivo de rechazo que aparece, escriba el texto que desea que aparezca en el informe de no entrega (también conocido como NDR o mensaje de de rebote). El código de estado mejorado que se usa es 5.7.1.

     - **rechazar el mensaje con** el código  de estado mejorado de: en el cuadro de diálogo Escribir código de estado mejorado que aparece, escriba el código de estado mejorado que desea que aparezca en el NDR. Los valores válidos son 5.7.1 o un valor de 5.7.900 a 5.7.999. El texto de rechazo predeterminado es: Entrega no autorizada, mensaje rechazado.

     - **rechazar el mensaje sin notificar a nadie**

4. Cuando haya terminado, haga clic en **Guardar**. La regla de bloqueo de datos adjuntos ya está en vigor.

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a>Usar PowerShell para crear una regla que bloquee los mensajes con datos adjuntos ejecutables

Use la siguiente sintaxis para crear una regla que bloquee los mensajes que contienen datos adjuntos ejecutables:

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

**Notas**:

- Si usa el parámetro _RejectMessageEnhancedStatusCode_ sin el parámetro _RejectMessageReasonText,_ el texto predeterminado es: Entrega no autorizada, mensaje rechazado.

- Si usa el parámetro _RejectMessageReasonText_ sin el parámetro _RejectMessageEnhancedStatusCode,_ el código predeterminado es 5.7.1.

En este ejemplo se crea una nueva regla denominada Bloquear datos adjuntos ejecutables que elimina silenciosamente los mensajes que contienen datos adjuntos ejecutables.

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

Para obtener información detallada acerca de la sintaxis y los parámetros, vea [New-TransportRule](https://docs.microsoft.com/powershell/module/exchange/new-transportrule).

## <a name="how-do-you-know-this-worked"></a>¿Cómo saber si el proceso se completó correctamente?

Para comprobar que ha creado correctamente una regla de flujo de correo para bloquear los mensajes que contienen datos adjuntos ejecutables, siga uno de estos pasos:

- En el EAC, vaya **a** Reglas de flujo de correo y seleccione la regla haga clic en el icono Editar \>  \> y \> compruebe la  ![ ](../../media/ITPro-EAC-EditIcon.png) configuración.

- En PowerShell, ejecute el siguiente comando para comprobar la configuración:

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```
