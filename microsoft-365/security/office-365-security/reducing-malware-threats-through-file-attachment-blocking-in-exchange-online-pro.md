---
title: Usar reglas de flujo de correo para bloquear mensajes con datos adjuntos ejecutables
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: Los administradores pueden aprender a crear reglas de flujo de correo (reglas de transporte) para bloquear mensajes que contienen datos adjuntos ejecutables.
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 012557b2e0e34cdafd33c2d4a8291283dbd5e35c
ms.sourcegitcommit: dcb97fbfdae52960ae62b6faa707a05358193ed5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/25/2021
ms.locfileid: "51207414"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="c7039-103">Usar reglas de flujo de correo para bloquear mensajes con datos adjuntos ejecutables en EOP</span><span class="sxs-lookup"><span data-stu-id="c7039-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

<span data-ttu-id="c7039-104">**Se aplica a**</span><span class="sxs-lookup"><span data-stu-id="c7039-104">**Applies to**</span></span>
- [<span data-ttu-id="c7039-105">Exchange Online Protection</span><span class="sxs-lookup"><span data-stu-id="c7039-105">Exchange Online Protection</span></span>](exchange-online-protection-overview.md)
- [<span data-ttu-id="c7039-106">Plan 1 y Plan 2 de Microsoft Defender para Office 365</span><span class="sxs-lookup"><span data-stu-id="c7039-106">Microsoft Defender for Office 365 plan 1 and plan 2</span></span>](defender-for-office-365.md)
- [<span data-ttu-id="c7039-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="c7039-107">Microsoft 365 Defender</span></span>](../defender/microsoft-365-defender.md)

<span data-ttu-id="c7039-108">En organizaciones de Microsoft 365 con buzones en Exchange Online o organizaciones independientes de Exchange Online Protection (EOP) sin buzones de Exchange Online, EOP usa directivas antimalware para bloquear mensajes dañinos, incluidos los mensajes con datos adjuntos ejecutables.</span><span class="sxs-lookup"><span data-stu-id="c7039-108">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="c7039-109">Para obtener más información, vea [Protección contra malware en EOP](anti-malware-protection.md).</span><span class="sxs-lookup"><span data-stu-id="c7039-109">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="c7039-110">Para mejorar aún más la protección, puede usar reglas de flujo de correo (también conocidas como reglas de transporte) para identificar y bloquear mensajes que contienen datos adjuntos ejecutables, como se describe en este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7039-110">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this article.</span></span>

<span data-ttu-id="c7039-111">Por ejemplo, después de un brote de malware, una empresa podría aplicar esta regla con un límite de tiempo para que los usuarios afectados puedan volver a enviar datos adjuntos después de un período de tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="c7039-111">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="c7039-112">¿Qué necesita saber antes de comenzar?</span><span class="sxs-lookup"><span data-stu-id="c7039-112">What do you need to know before you begin?</span></span>

- <span data-ttu-id="c7039-113">Debe tener asignados permisos en Exchange Online o Exchange Online Protection antes de poder realizar los procedimientos descritos en este artículo.</span><span class="sxs-lookup"><span data-stu-id="c7039-113">You need to be assigned permissions in Exchange Online or Exchange Online Protection before you can do the procedures in this article.</span></span> <span data-ttu-id="c7039-114">En concreto, necesita el rol **Reglas** de transporte, que se  asigna de forma predeterminada a los grupos de roles Administración de la **organización,** Administración de cumplimiento y Administración de registros.</span><span class="sxs-lookup"><span data-stu-id="c7039-114">Specifically, you need the **Transport Rules** role, which is assigned to the **Organization Management**, **Compliance Management**, and **Records Management** role groups by default.</span></span>

  <span data-ttu-id="c7039-115">Para obtener más información, consulte los siguientes temas:</span><span class="sxs-lookup"><span data-stu-id="c7039-115">For more information, see the following topics:</span></span>

  - [<span data-ttu-id="c7039-116">Permisos de Exchange Online</span><span class="sxs-lookup"><span data-stu-id="c7039-116">Permissions in Exchange Online</span></span>](/exchange/permissions-exo/permissions-exo)
  - [<span data-ttu-id="c7039-117">Permisos en EOP independiente</span><span class="sxs-lookup"><span data-stu-id="c7039-117">Permissions in standalone EOP</span></span>](feature-permissions-in-eop.md)
  - [<span data-ttu-id="c7039-118">Usar el EAC modificar la lista de miembros en grupos de roles</span><span class="sxs-lookup"><span data-stu-id="c7039-118">Use the EAC modify the list of members in role groups</span></span>](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)

- <span data-ttu-id="c7039-119">Para abrir el EAC en Exchange Online, vea [Centro de administración de Exchange en Exchange Online](/Exchange/exchange-admin-center).</span><span class="sxs-lookup"><span data-stu-id="c7039-119">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="c7039-120">Para abrir el EAC en EOP independiente, vea Centro de [administración de Exchange en EOP independiente.](exchange-admin-center-in-exchange-online-protection-eop.md)</span><span class="sxs-lookup"><span data-stu-id="c7039-120">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="c7039-121">Para conectarse al PowerShell de Exchange Online, consulte [Conexión a Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).</span><span class="sxs-lookup"><span data-stu-id="c7039-121">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="c7039-122">Para conectarse a EOP PowerShell independiente, consulte [Connect to Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell) (Conexión a Exchange Online Protection PowerShell).</span><span class="sxs-lookup"><span data-stu-id="c7039-122">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="c7039-123">Para obtener más información acerca de las reglas de flujo de correo en Exchange Online y EOP independiente, consulte los temas siguientes:</span><span class="sxs-lookup"><span data-stu-id="c7039-123">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="c7039-124">Reglas de flujo de correo (reglas de transporte) en Exchange Online</span><span class="sxs-lookup"><span data-stu-id="c7039-124">Mail flow rules (transport rules) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="c7039-125">Condiciones y excepciones de reglas de flujo de correo (predicados) en Exchange Online</span><span class="sxs-lookup"><span data-stu-id="c7039-125">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="c7039-126">Acciones de regla de flujo de correo en Exchange Online</span><span class="sxs-lookup"><span data-stu-id="c7039-126">Mail flow rule actions in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="c7039-127">Usar el EAC para crear una regla que bloquee los mensajes con datos adjuntos ejecutables</span><span class="sxs-lookup"><span data-stu-id="c7039-127">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="c7039-128">En el EAC, vaya a **Flujo de correo** \> **Reglas**.</span><span class="sxs-lookup"><span data-stu-id="c7039-128">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="c7039-129">Haga **clic en** Agregar icono Agregar ![ ](../../media/ITPro-EAC-AddIcon.png) **y, a continuación, seleccione Crear una nueva regla.**</span><span class="sxs-lookup"><span data-stu-id="c7039-129">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="c7039-130">En la ventana **Nueva regla** que se abre, configure las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="c7039-130">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="c7039-131">**Nombre:** escriba un nombre descriptivo único para la regla.</span><span class="sxs-lookup"><span data-stu-id="c7039-131">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="c7039-132">Haga clic en **Más opciones**.</span><span class="sxs-lookup"><span data-stu-id="c7039-132">Click **More Options**.</span></span>

   - <span data-ttu-id="c7039-133">**Aplique esta regla si**: Select **Any attachment** has \> **executable content**.</span><span class="sxs-lookup"><span data-stu-id="c7039-133">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="c7039-134">**Haga lo siguiente:** Seleccione **Bloquear el mensaje** y, a continuación, elija la acción que desee:</span><span class="sxs-lookup"><span data-stu-id="c7039-134">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="c7039-135">**rechazar el** mensaje e incluir  una explicación: en el cuadro de diálogo Especificar motivo de rechazo que aparece, escriba el texto que desea que aparezca en el informe de no entrega (también conocido como NDR o mensaje de desaprobado).</span><span class="sxs-lookup"><span data-stu-id="c7039-135">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="c7039-136">El código de estado mejorado que se usa es 5.7.1.</span><span class="sxs-lookup"><span data-stu-id="c7039-136">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="c7039-137">**rechazar el mensaje con el** código  de estado mejorado de : En el cuadro de diálogo Escribir código de estado mejorado que aparece, escriba el código de estado mejorado que desea que aparezca en el NDR.</span><span class="sxs-lookup"><span data-stu-id="c7039-137">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="c7039-138">Los valores válidos son 5.7.1 o un valor de 5.7.900 a 5.7.999.</span><span class="sxs-lookup"><span data-stu-id="c7039-138">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="c7039-139">El texto de rechazo predeterminado es: Entrega no autorizada, mensaje rechazado.</span><span class="sxs-lookup"><span data-stu-id="c7039-139">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="c7039-140">**rechazar el mensaje sin notificar a nadie**</span><span class="sxs-lookup"><span data-stu-id="c7039-140">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="c7039-141">Cuando haya terminado, haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="c7039-141">When you're finished, click **Save**.</span></span> <span data-ttu-id="c7039-142">La regla de bloqueo de datos adjuntos ya está en vigor.</span><span class="sxs-lookup"><span data-stu-id="c7039-142">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="c7039-143">Usar PowerShell para crear una regla que bloquee los mensajes con datos adjuntos ejecutables</span><span class="sxs-lookup"><span data-stu-id="c7039-143">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="c7039-144">Use la siguiente sintaxis para crear una regla para bloquear los mensajes que contienen datos adjuntos ejecutables:</span><span class="sxs-lookup"><span data-stu-id="c7039-144">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="c7039-145">**Notas**:</span><span class="sxs-lookup"><span data-stu-id="c7039-145">**Notes**:</span></span>

- <span data-ttu-id="c7039-146">Si usa el parámetro _RejectMessageEnhancedStatusCode_ sin el parámetro _RejectMessageReasonText,_ el texto predeterminado es: Entrega no autorizada, mensaje rechazado.</span><span class="sxs-lookup"><span data-stu-id="c7039-146">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="c7039-147">Si usa el parámetro _RejectMessageReasonText_ sin el parámetro _RejectMessageEnhancedStatusCode,_ el código predeterminado es 5.7.1.</span><span class="sxs-lookup"><span data-stu-id="c7039-147">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="c7039-148">En este ejemplo se crea una nueva regla denominada Bloquear datos adjuntos ejecutables que elimina silenciosamente los mensajes que contienen datos adjuntos ejecutables.</span><span class="sxs-lookup"><span data-stu-id="c7039-148">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="c7039-149">Para obtener información detallada acerca de la sintaxis y los parámetros, vea [New-TransportRule](/powershell/module/exchange/new-transportrule).</span><span class="sxs-lookup"><span data-stu-id="c7039-149">For detailed syntax and parameter information, see [New-TransportRule](/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="c7039-150">¿Cómo saber si el proceso se completó correctamente?</span><span class="sxs-lookup"><span data-stu-id="c7039-150">How do you know this worked?</span></span>

<span data-ttu-id="c7039-151">Para comprobar que ha creado correctamente una regla de flujo de correo para bloquear los mensajes que contienen datos adjuntos ejecutables, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="c7039-151">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="c7039-152">En el EAC, vaya a **Flujo** de correo Reglas seleccione la regla haga clic en \>  \> \> **Editar** icono Editar y compruebe ![ la ](../../media/ITPro-EAC-EditIcon.png) configuración.</span><span class="sxs-lookup"><span data-stu-id="c7039-152">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="c7039-153">En PowerShell, ejecute el siguiente comando para comprobar la configuración:</span><span class="sxs-lookup"><span data-stu-id="c7039-153">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```