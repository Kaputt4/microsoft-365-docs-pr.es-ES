---
title: Personalizar la protección contra vulnerabilidades de seguridad
keywords: Protección contra vulnerabilidades de seguridad, mitigaciones, enable, powershell, dep, cfg, emet, aslr
description: Puede habilitar o deshabilitar mitigaciones específicas usadas por la protección contra vulnerabilidades mediante la Seguridad de Windows o PowerShell. También puede auditar mitigaciones y exportar configuraciones.
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
ms.localizationpriority: medium
audience: ITPro
ms.topic: conceptual
author: dansimp
ms.author: dansimp
ms.reviewer: ''
manager: dansimp
ms.technology: mde
ms.collection: m365-security-compliance
ms.date: ''
ms.openlocfilehash: b52238069a69a08921fec79c67ab979bd7668bb7
ms.sourcegitcommit: bdd6ffc6ebe4e6cb212ab22793d9513dae6d798c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/08/2022
ms.locfileid: "63322749"
---
# <a name="customize-exploit-protection"></a>Personalizar la protección contra vulnerabilidades de seguridad

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


**Se aplica a:**
- [Microsoft Defender para punto de conexión Plan 1](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [Microsoft Defender para punto de conexión Plan 2](https://go.microsoft.com/fwlink/p/?linkid=2154037)
- [Microsoft 365 Defender](https://go.microsoft.com/fwlink/?linkid=2118804)

> ¿Desea experimentar Defender for Endpoint? [Regístrese para obtener una prueba gratuita.](https://signup.microsoft.com/create-account/signup?products=7f379fee-c4f9-4278-b0a1-e4c8c2fcdf7e&ru=https://aka.ms/MDEp2OpenTrial?ocid=docs-wdatp-assignaccess-abovefoldlink)

La protección contra vulnerabilidades aplica automáticamente una serie de técnicas de mitigación de vulnerabilidades en los procesos del sistema operativo y en aplicaciones individuales.

Configura estas opciones con la Seguridad de Windows aplicación en un dispositivo individual. A continuación, exporte la configuración como un archivo XML para que pueda implementarla en otros dispositivos. Use la directiva de grupo para distribuir el archivo XML a varios dispositivos a la vez. También puede configurar las mitigaciones con PowerShell.

En este artículo se enumeran cada una de las mitigaciones disponibles en la protección contra vulnerabilidades. Indica si la mitigación se puede aplicar en todo el sistema o en aplicaciones individuales, y proporciona una breve descripción de cómo funciona la mitigación.

También describe cómo habilitar o configurar las mitigaciones mediante Seguridad de Windows, PowerShell y proveedores de servicios de configuración (CSP) de administración de dispositivos móviles (MDM). Este es el primer paso para crear una configuración que puede implementar en toda la red. El siguiente paso consiste [en generar, exportar, importar e implementar la configuración en varios dispositivos](import-export-exploit-protection-emet-xml.md).

> [!WARNING]
> Algunas tecnologías de mitigación de seguridad pueden tener problemas de compatibilidad con algunas aplicaciones. Debería probar la protección contra vulnerabilidades de seguridad en todos los escenarios de uso de destino con el [modo auditoría](evaluate-exploit-protection.md) antes de implementar la configuración en un entorno de producción o en el resto de la red.

## <a name="exploit-protection-mitigations"></a>Mitigaciones de protección contra vulnerabilidades

Todas las mitigaciones se pueden configurar para aplicaciones individuales. Algunas mitigaciones también se pueden aplicar en el nivel del sistema operativo.

Puede establecer cada una de las mitigaciones en, desactivado o en su valor predeterminado. Algunas mitigaciones tienen opciones adicionales que se indican en la descripción de la tabla.

Los valores predeterminados siempre se especifican entre corchetes en la **opción Usar predeterminada** para cada mitigación. En el siguiente ejemplo, el valor predeterminado de Prevención de ejecución de datos es "On".

La **configuración predeterminada** Usar para cada una de las opciones de mitigación indica nuestra recomendación de un nivel base de protección para el uso diario de los usuarios de casa. Enterprise implementaciones deben tener en cuenta la protección necesaria para sus necesidades individuales y es posible que deban modificar la configuración lejos de los valores predeterminados.

Para los cmdlets de PowerShell asociados para cada mitigación, vea la tabla de referencia de [PowerShell](#cmdlets-table) en la parte inferior de este artículo.

|Mitigación|Descripción|Se puede aplicar a|Modo auditoría disponible|
|---|---|---|---|
|Protección de flujo de control (CFG)|Garantiza la integridad del flujo de control para las llamadas indirectas. Opcionalmente, puede suprimir las exportaciones y usar un CFG estricto.|Sistema y nivel de aplicación|No|
|Prevención de ejecución de datos (DEP)|Impide que el código se ejecute desde páginas de memoria de solo datos, como el montón y las pilas. Solo se puede configurar para aplicaciones de 32 bits (x86), habilitadas permanentemente para todas las demás arquitecturas. Opcionalmente, puede habilitar la emulación de thunk atl.|Sistema y nivel de aplicación|No|
|Forzar la selección aleatoria de imágenes (ASLR es obligatorio)|Reubica por la fuerza imágenes no compiladas con /DYNAMICBASE. Opcionalmente, se pueden producir errores al cargar imágenes que no tienen información de reubicación.|Sistema y nivel de aplicación|No|
|Aleatorizar las asignaciones de memoria (ASLR ascendente)|Aleatoriza las ubicaciones para asignaciones de memoria virtual. Incluye montóns de estructura del sistema, pilas, TEB y PEBs. Opcionalmente, puede usar una variación de aleatorización más amplia para procesos de 64 bits.|Sistema y nivel de aplicación|No|
|Validar cadenas de excepción (SEHOP)|Garantiza la integridad de una cadena de excepciones durante el envío de excepciones. Solo se puede configurar para aplicaciones de 32 bits (x86).|Sistema y nivel de aplicación|No|
|Validar la integridad del montón|Finaliza un proceso cuando se detectan daños en el montón.|Sistema y nivel de aplicación|No|
|Protección de código arbitrario (ACG)|Evita la introducción de código ejecutable no con copia de seguridad de imágenes e impide que se modifiquen las páginas de código. Opcionalmente, puede permitir la exclusión de subprocesos y permitir la degradación remota (configurable solo con PowerShell).|Solo a nivel de aplicación|Sí|
|Bloquear imágenes de integridad baja|Impide la carga de imágenes marcadas con integridad baja.|Solo a nivel de aplicación|Sí|
|Bloquear imágenes remotas|Impide la carga de imágenes desde dispositivos remotos.|Solo a nivel de aplicación|No|
|Bloquear fuentes que no son de confianza|Impide cargar fuentes basadas en GDI no instaladas en el directorio de fuentes del sistema, en particular fuentes de la web.|Solo a nivel de aplicación|Sí|
|Protección de integridad de código|Restringe la carga de imágenes firmadas por Microsoft, WHQL o posterior. Opcionalmente, puede permitir Microsoft Store imágenes firmadas.|Solo a nivel de aplicación|Sí|
|Deshabilitar los puntos de extensión|Deshabilita varios mecanismos de extensibilidad que permiten la inserción de DLL en todos los procesos, como ARCHIVOS DLL de AppInit, enlaces de ventana y proveedores de servicios Winsock.|Solo a nivel de aplicación|No|
|Deshabilitar llamadas del sistema de Win32k|Impide que una aplicación use la tabla de llamadas del sistema Win32k.|Solo a nivel de aplicación|Sí|
|No permitir procesos secundarios|Impide que una aplicación cree procesos secundarios.|Solo a nivel de aplicación|Sí|
|Exportar filtrado de direcciones (EAF)|Detecta operaciones peligrosas que se resuelven mediante código malintencionado. Opcionalmente, puede validar el acceso de los módulos usados habitualmente por los exploits.|Solo a nivel de aplicación|Sí|
|Importar filtrado de direcciones (IAF)|Detecta operaciones peligrosas que se resuelven mediante código malintencionado.|Solo a nivel de aplicación|Sí|
|Simular la ejecución (SimExec)|Garantiza que las llamadas a API confidenciales vuelvan a los autores de llamadas legítimos. Solo se puede configurar para aplicaciones de 32 bits (x86). No es compatible con ACG.|Solo a nivel de aplicación|Sí|
|Validar la invocación de la API (CallerCheck)|Garantiza que los autores de llamadas legítimos invocan las API confidenciales. Solo se puede configurar para aplicaciones de 32 bits (x86). No compatible con ACG|Solo a nivel de aplicación|Sí|
|Validar el uso de identificador|Hace que se genera una excepción en las referencias de identificador no válidas.|Solo a nivel de aplicación|No|
|Validar la integridad de la dependencia de imagen|Aplica la firma de código para la Windows de dependencia de imagen.|Solo a nivel de aplicación|No|
|Validar la integridad de la pila (StackPivot)|Garantiza que la pila no se haya redirigido para las API confidenciales. No es compatible con ACG.|Solo a nivel de aplicación|Sí|

> [!IMPORTANT]
> Si agregas una aplicación a la  sección Configuración del programa y configuras opciones de mitigación individuales allí, se respetarán por encima de la configuración para las mismas mitigaciones especificadas en la sección **Configuración del** sistema. La siguiente matriz y ejemplos ayudan a ilustrar cómo funcionan los valores predeterminados:
>
>
> |Habilitado en **configuración del programa**|Habilitado en **configuración del sistema**|Comportamiento|
> |---|---|---|
> |Sí|No|Tal como se define en **Configuración del programa**|
> |Sí|Sí|Tal como se define en **Configuración del programa**|
> |No|Sí|Tal como se define en **Configuración del sistema**|
> |No|Sí|Valor predeterminado tal como se define en **la opción Usar predeterminada**|
>
>
> - **Ejemplo 1**
>
>    Mikael configura la **prevención de ejecución de datos (DEP)** en la sección **Configuración** del sistema para que **esté desactivada de forma predeterminada**.
>
>    A continuación, Mikael *agrega eltest.exe* aplicación a la **sección Configuración del** programa. En las opciones de esa aplicación, en Prevención de ejecución de datos **(DEP),** habilita  la opción Invalidar configuración del sistema y establece el modificador en **Activado**. No hay otras aplicaciones enumeradas en la **sección Configuración del** programa.
>
>    El resultado será que DEP solo se habilitará para *test.exe*. El resto de aplicaciones no tendrán DEP aplicado.
>
>
> - **Ejemplo 2**
>
>    Josie configura la **prevención de ejecución de datos (DEP)** en la sección **Configuración** del sistema para que **esté desactivada de forma predeterminada**.
>
>    A continuación, Josie agrega *eltest.exeaplicación* a la **sección Configuración del** programa. En las opciones de esa aplicación, en **Prevención de ejecución de datos (DEP),** habilita  la opción Invalidar configuración del sistema y establece el modificador en **Activado**.
>
>    Josie también agrega la aplicación *miles.exea la* sección Configuración del  programa y configura **Control flow guard (CFG)** en **On**. No habilita la **opción Invalidar configuración** del sistema para DEP ni ninguna otra mitigación para esa aplicación.
>
>    El resultado será que DEP se habilitará para *test.exe*. DEP no se habilitará para ninguna otra aplicación, incluida *miles.exe*. CFG se habilitará para *miles.exe*.

> [!NOTE]
> Si ha encontrado algún problema en este artículo, puede notificarlo directamente a un partner de cliente de Windows Server/Windows o usar los números de soporte técnico de Microsoft para su país.

### <a name="configure-system-level-mitigations-with-the-windows-security-app"></a>Configurar mitigaciones de nivel del sistema con la Seguridad de Windows aplicación

1. Abra la aplicación Seguridad de Windows seleccionando el icono de escudo en la barra de tareas o buscando en el menú inicio para **Seguridad de Windows**.

2. Selecciona el **icono & control del explorador** (o el icono de la aplicación en la barra de menús izquierda) y, a continuación, selecciona **Protección contra vulnerabilidades de seguridad**.

3. En la **sección Configuración del** sistema, busque la mitigación que desea configurar y seleccione una de las siguientes opciones. Las aplicaciones que no están configuradas individualmente en la **sección Configuración del** programa usarán la configuración configurada aquí:
   - **Activado de forma predeterminada** : la mitigación está *habilitada* para aplicaciones que no tienen esta mitigación establecida en la sección Configuración del **programa específica de la** aplicación.
   - **Desactivado de forma predeterminada** : la mitigación *está* deshabilitada para las aplicaciones que no tienen esta mitigación establecida en la sección Configuración del programa específica de **la** aplicación.
   - **Usar** predeterminado: la mitigación está habilitada o deshabilitada, en función de la configuración predeterminada configurada por la instalación Windows 10 o Windows 11; el valor predeterminado (**Activado** **o Desactivado**) siempre se especifica junto a la etiqueta Usar predeterminada para cada mitigación 

   > [!NOTE]
   > Es posible que vea una ventana control de cuentas de usuario al cambiar algunas opciones de configuración. Escriba las credenciales de administrador para aplicar la configuración.

   Cambiar algunas configuraciones puede requerir un reinicio.

4. Repita esta acción para todas las mitigaciones de nivel del sistema que desee configurar.

5. Ve a la **sección Configuración del** programa y elige la aplicación a la que quieres aplicar mitigaciones:

   1. Si la aplicación que quieres configurar ya está en la lista, selecciónelo y, a continuación, selecciona **Editar**
   2. Si la aplicación no aparece, en la parte superior de la lista, selecciona **Agregar programa** para personalizar y, a continuación, elige cómo quieres agregar la aplicación:
      - Use **Agregar por nombre de programa** para aplicar la mitigación a cualquier proceso en ejecución con ese nombre. Debe especificar un archivo con una extensión. Puedes escribir una ruta de acceso completa para limitar la mitigación solo a la aplicación con ese nombre en esa ubicación.
      - Use **Elegir la ruta de acceso exacta del** archivo para usar una ventana estándar Windows selector de archivos del Explorador para buscar y seleccionar el archivo que desee.

6. Después de seleccionar la aplicación, verás una lista de todas las mitigaciones que se pueden aplicar. Para habilitar la mitigación, active la casilla y, a continuación, cambie el control deslizante a **Activar**. Seleccione cualquier opción adicional. Si elige **Audit** , solo se aplicará la mitigación en modo auditoría. Se te notificará si necesitas reiniciar el proceso o la aplicación, o si necesitas reiniciar Windows.

7. Repita estos pasos para todas las aplicaciones y mitigaciones que desee configurar. Seleccione **Aplicar** cuando haya terminado de configurar la configuración.

Ahora puede exportar [estas opciones como un archivo XML](import-export-exploit-protection-emet-xml.md) o continuar con la configuración de mitigaciones específicas de la aplicación.

La exportación de la configuración como archivo XML permite copiar la configuración de un dispositivo en otros dispositivos.

## <a name="powershell-reference"></a>Referencia de PowerShell

Puede usar la aplicación Seguridad de Windows para configurar protección contra vulnerabilidades de seguridad o puede usar cmdlets de PowerShell.

Las opciones de configuración que se modificaron más recientemente siempre se aplicarán, independientemente de si usa PowerShell o Seguridad de Windows. Esto significa que si usa la aplicación para configurar una mitigación y, a continuación, usa PowerShell para configurar la misma mitigación, la aplicación se actualizará para mostrar los cambios realizados con PowerShell. Si luego usas la aplicación para cambiar la mitigación de nuevo, ese cambio se aplicaría.

> [!IMPORTANT]
> Cualquier cambio que se implemente en un dispositivo a través de la directiva de grupo invalidará la configuración local. Al configurar una configuración inicial, usa un dispositivo que no tenga una configuración de directiva de grupo aplicada para garantizar que los cambios no se invalidan.

Puede usar el verbo de PowerShell `Get` o `Set` con el cmdlet `ProcessMitigation`. El `Get` uso enumerará el estado de configuración actual de las mitigaciones que se han habilitado en el dispositivo: `-Name` agregue el cmdlet y la aplicación exe para ver mitigaciones solo para esa aplicación:

```PowerShell
Get-ProcessMitigation -Name processName.exe
```

> [!IMPORTANT]
> Las mitigaciones de nivel de sistema que no se han configurado mostrarán un estado de `NOTSET`.
>
> Para la configuración de nivel del sistema, `NOTSET` indica que se ha aplicado la configuración predeterminada para esa mitigación.
>
> Para la configuración de nivel de aplicación, `NOTSET` indica la configuración de nivel del sistema para la mitigación que se aplicará.
>
> La configuración predeterminada para cada mitigación de nivel del sistema se puede ver en el Seguridad de Windows.

Se `Set` usa para configurar cada mitigación en el siguiente formato:

```PowerShell
Set-ProcessMitigation -<scope> <app executable> -<action> <mitigation or options>,<mitigation or options>,<mitigation or options>
```

Donde:

- \<Scope\>:
  - `-Name` para indicar que las mitigaciones deben aplicarse a una aplicación específica. Especifica el archivo ejecutable de la aplicación después de esta marca.
  - `-System` para indicar que la mitigación debe aplicarse en el nivel del sistema
- \<Action\>:
  - `-Enable` para habilitar la mitigación
  - `-Disable` para deshabilitar la mitigación
- \<Mitigation\>:
  - Cmdlet de mitigación tal como se define en la siguiente tabla [de cmdlets de mitigación](#cmdlets-table) , junto con cualquier subopción (rodeada de espacios). Cada mitigación se separa con una coma.

Por ejemplo, para habilitar la mitigación de prevención de ejecución de datos (DEP) con emulación de thunk ATL y para un archivo ejecutable denominado *testing.exe* en la carpeta *C:\Apps\LOB\tests*, y para evitar que ese archivo ejecutable cree procesos secundarios, debe usar el siguiente comando:

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable DEP, EmulateAtlThunks, DisallowChildProcessCreation
```

> [!IMPORTANT]
> Separe cada opción de mitigación con comas.

Si quisiera aplicar DEP en el nivel del sistema, usaría el siguiente comando:

```PowerShell
Set-Processmitigation -System -Enable DEP
```

Para deshabilitar las mitigaciones, puede reemplazar con `-Enable` `-Disable`. Sin embargo, en el caso de las mitigaciones de nivel de aplicación, esto obligará a deshabilitar la mitigación solo para esa aplicación.

Si necesita restaurar la mitigación al valor predeterminado del sistema, `-Remove` también debe incluir el cmdlet, como en el ejemplo siguiente:

```PowerShell
Set-Processmitigation -Name test.exe -Remove -Disable DEP
```

También puede establecer algunas mitigaciones en modo auditoría. En lugar de usar el cmdlet de PowerShell para la mitigación, use **el cmdlet del** modo auditoría tal como se especifica en la tabla [de cmdlets de mitigación siguiente](#cmdlets-table) .

Por ejemplo, para habilitar la Protección de código arbitrario (ACG) en modo de auditoría ** para eltesting.exeusado anteriormente, se usa el siguiente comando:

```PowerShell
Set-ProcessMitigation -Name c:\apps\lob\tests\testing.exe -Enable AuditDynamicCode
```

Puede deshabilitar el modo de auditoría mediante el mismo comando, pero reemplazando por `-Enable` `-Disable`.

### <a name="powershell-reference-table"></a>Tabla de referencia de PowerShell

En esta tabla se enumeran los cmdlets de PowerShell (y el cmdlet del modo de auditoría asociado) que se pueden usar para configurar cada mitigación.

<a id="cmdlets-table"></a>

|Mitigación|Se aplica a|Cmdlets de PowerShell|Cmdlet de modo auditoría|
|---|---|---|---|
|Protección de flujo de control (CFG)|Sistema y nivel de aplicación|CFG, StrictCFG, SuppressExports|Auditoría no disponible|
|Prevención de ejecución de datos (DEP)|Sistema y nivel de aplicación|DEP, EmulateAtlThunks|Auditoría no disponible|
|Forzar la selección aleatoria de imágenes (ASLR es obligatorio)|Sistema y nivel de aplicación|ForceRelocateImages|Auditoría no disponible|
|Aleatorizar las asignaciones de memoria (ASLR ascendente)|Sistema y nivel de aplicación|BottomUp, HighEntropy|Auditoría no disponible|
|Validar cadenas de excepción (SEHOP)|Sistema y nivel de aplicación|SEHOP, SEHOPTelemetry|Auditoría no disponible|
|Validar la integridad del montón|Sistema y nivel de aplicación|TerminateOnError|Auditoría no disponible|
|Protección de código arbitrario (ACG)|Solo a nivel de aplicación|DynamicCode|AuditDynamicCode|
|Bloquear imágenes de integridad baja|Solo a nivel de aplicación|BlockLowLabel|AuditImageLoad|
|Bloquear imágenes remotas|Solo a nivel de aplicación|BlockRemoteImages|Auditoría no disponible|
|Bloquear fuentes que no son de confianza|Solo a nivel de aplicación|DisableNonSystemFonts|AuditFont, FontAuditOnly|
|Protección de integridad de código|Solo a nivel de aplicación|BlockNonMicrosoftSigned, AllowStoreSigned|AuditMicrosoftSigned, AuditStoreSigned|
|Deshabilitar los puntos de extensión|Solo a nivel de aplicación|ExtensionPoint|Auditoría no disponible|
|Deshabilitar llamadas del sistema de Win32k|Solo a nivel de aplicación|DisableWin32kSystemCalls|AuditSystemCall|
|No permitir procesos secundarios|Solo a nivel de aplicación|DisallowChildProcessCreation|AuditChildProcess|
|Exportar filtrado de direcciones (EAF)|Solo a nivel de aplicación|EnableExportAddressFilterPlus, EnableExportAddressFilter <a href="#r1" id="t1">\[1\]</a>|Auditoría no <a href="#r2" id="t2">disponible2\[\]</a>|
|Importar filtrado de direcciones (IAF)|Solo a nivel de aplicación|EnableImportAddressFilter|Auditoría no <a href="#r2" id="t2">disponible2\[\]</a>|
|Simular la ejecución (SimExec)|Solo a nivel de aplicación|EnableRopSimExec|Auditoría no <a href="#r2" id="t2">disponible2\[\]</a>|
|Validar la invocación de la API (CallerCheck)|Solo a nivel de aplicación|EnableRopCallerCheck|Auditoría no <a href="#r2" id="t2">disponible2\[\]</a>|
|Validar el uso de identificador|Solo a nivel de aplicación|StrictHandle|Auditoría no disponible|
|Validar la integridad de la dependencia de imagen|Solo a nivel de aplicación|EnforceModuleDepencySigning|Auditoría no disponible|
|Validar la integridad de la pila (StackPivot)|Solo a nivel de aplicación|EnableRopStackPivot|Auditoría no <a href="#r2" id="t2">disponible2\[\]</a>|

<a href="#t1" id="r1">\[1\]</a>: Use el siguiente formato para habilitar módulos EAF para dll para un proceso:

```PowerShell
Set-ProcessMitigation -Name processName.exe -Enable EnableExportAddressFilterPlus -EAFModules dllName1.dll,dllName2.dll
```

<a href="#t2" id="r2">\[2\]</a>: La auditoría de esta mitigación no está disponible a través de cmdlets de PowerShell.

## <a name="customize-the-notification"></a>Personalizar la notificación

Para obtener más información sobre cómo personalizar la notificación cuando se desencadena una regla y bloquea una aplicación o un archivo, consulta [Seguridad de Windows](/windows/security/threat-protection/windows-defender-security-center/windows-defender-security-center).

## <a name="see-also"></a>Ver también

- [Proteger los dispositivos contra vulnerabilidades de seguridad](exploit-protection.md)
- [Evaluar protección contra vulnerabilidades](evaluate-exploit-protection.md)
- [Habilitar la protección contra vulnerabilidades de seguridad](enable-exploit-protection.md)
- [Importar, exportar e implementar configuraciones de protección de vulnerabilidades de seguridad](import-export-exploit-protection-emet-xml.md)
