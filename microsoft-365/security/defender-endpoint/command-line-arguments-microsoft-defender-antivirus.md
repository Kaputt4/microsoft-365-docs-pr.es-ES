---
title: Use la línea de comandos para administrar Antivirus de Microsoft Defender
description: Ejecute Antivirus de Microsoft Defender y configure la protección de próxima generación con una utilidad de línea de comandos dedicada.
keywords: ejecutar el examen de Windows Defender, ejecutar el examen antivirus desde la línea de comandos, ejecutar el examen de Windows Defender desde la línea de comandos, mpcmdrun, defender
search.product: eADQiWindows 10XVcnh
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
author: denisebmsft
ms.author: deniseb
ms.custom: nextgen
ms.reviewer: ksarens
manager: dansimp
ms.date: 05/24/2021
ms.technology: mde
ms.topic: how-to
ms.openlocfilehash: 25f038846f9dd9855823382d4e1babcf0547fed6
ms.sourcegitcommit: 17f0aada83627d9defa0acf4db03a2d58e46842f
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/24/2021
ms.locfileid: "52636175"
---
# <a name="configure-and-manage-microsoft-defender-antivirus-with-the-mpcmdrunexe-command-line-tool"></a><span data-ttu-id="e5d8c-104">Configurar y administrar Antivirus de Microsoft Defender con la mpcmdrun.exe de línea de comandos</span><span class="sxs-lookup"><span data-stu-id="e5d8c-104">Configure and manage Microsoft Defender Antivirus with the mpcmdrun.exe command-line tool</span></span>

<span data-ttu-id="e5d8c-105">**Se aplica a:**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-105">**Applies to:**</span></span>

- [<span data-ttu-id="e5d8c-106">Microsoft Defender para punto de conexión</span><span class="sxs-lookup"><span data-stu-id="e5d8c-106">Microsoft Defender for Endpoint</span></span>](/microsoft-365/security/defender-endpoint/)

<span data-ttu-id="e5d8c-107">Puede realizar varias funciones en Antivirus de Microsoft Defender con la herramienta de línea de comandos dedicada **mpcmdrun.exe**.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-107">You can perform various functions in Microsoft Defender Antivirus using the dedicated command-line tool **mpcmdrun.exe**.</span></span> <span data-ttu-id="e5d8c-108">Esta utilidad es útil cuando se desea automatizar Antivirus de Microsoft Defender tareas.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-108">This utility is useful when you want to automate Microsoft Defender Antivirus tasks.</span></span> <span data-ttu-id="e5d8c-109">Puede encontrar la utilidad en `%ProgramFiles%\Windows Defender\MpCmdRun.exe` .</span><span class="sxs-lookup"><span data-stu-id="e5d8c-109">You can find the utility in `%ProgramFiles%\Windows Defender\MpCmdRun.exe`.</span></span> <span data-ttu-id="e5d8c-110">Ejecutarlo desde un símbolo del sistema.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-110">Run it from a command prompt.</span></span>

> [!TIP]
> <span data-ttu-id="e5d8c-111">Es posible que deba abrir una versión de nivel de administrador del símbolo del sistema.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-111">You might need to open an administrator-level version of the command prompt.</span></span> <span data-ttu-id="e5d8c-112">Cuando busque símbolo **del sistema en** el menú Inicio, elija Ejecutar como **administrador**.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-112">When you search for **Command Prompt** on the Start menu, choose **Run as administrator**.</span></span> <span data-ttu-id="e5d8c-113">Si está ejecutando una versión actualizada de Microsoft Defender Platform, ejecute `MpCmdRun` desde la siguiente ubicación: `C:\ProgramData\Microsoft\Windows Defender\Platform\<antimalware platform version>` .</span><span class="sxs-lookup"><span data-stu-id="e5d8c-113">If you're running an updated Microsoft Defender Platform version, run `MpCmdRun` from the following location: `C:\ProgramData\Microsoft\Windows Defender\Platform\<antimalware platform version>`.</span></span> <span data-ttu-id="e5d8c-114">Para obtener más información acerca de la plataforma antimalware, [vea Antivirus de Microsoft Defender actualizaciones y líneas base](manage-updates-baselines-microsoft-defender-antivirus.md).</span><span class="sxs-lookup"><span data-stu-id="e5d8c-114">For more information about the antimalware platform, see [Microsoft Defender Antivirus updates and baselines](manage-updates-baselines-microsoft-defender-antivirus.md).</span></span>

<span data-ttu-id="e5d8c-115">La utilidad MpCmdRun usa la siguiente sintaxis:</span><span class="sxs-lookup"><span data-stu-id="e5d8c-115">The MpCmdRun utility uses the following syntax:</span></span>

```console
MpCmdRun.exe [command] [-options]
```

<span data-ttu-id="e5d8c-116">Aquí le mostramos un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e5d8c-116">Here's an example:</span></span>

```console
MpCmdRun.exe -Scan -ScanType 2
``` 

<span data-ttu-id="e5d8c-117">En nuestro ejemplo, la utilidad MpCmdRun inicia un examen antivirus completo en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-117">In our example, the MpCmdRun utility starts a full antivirus scan on the device.</span></span>

## <a name="commands"></a><span data-ttu-id="e5d8c-118">Comandos</span><span class="sxs-lookup"><span data-stu-id="e5d8c-118">Commands</span></span>

| <span data-ttu-id="e5d8c-119">Comando</span><span class="sxs-lookup"><span data-stu-id="e5d8c-119">Command</span></span>  | <span data-ttu-id="e5d8c-120">Descripción</span><span class="sxs-lookup"><span data-stu-id="e5d8c-120">Description</span></span>   |
|:----|:----|
| <span data-ttu-id="e5d8c-121">`-?`**o**`-h`</span><span class="sxs-lookup"><span data-stu-id="e5d8c-121">`-?` **or** `-h`</span></span>   | <span data-ttu-id="e5d8c-122">Muestra todas las opciones disponibles para la herramienta MpCmdRun</span><span class="sxs-lookup"><span data-stu-id="e5d8c-122">Displays all available options for the MpCmdRun tool</span></span> |
| `-Scan [-ScanType [<value>]] [-File <path> [-DisableRemediation] [-BootSectorScan] [-CpuThrottling]] [-Timeout <days>] [-Cancel]` | <span data-ttu-id="e5d8c-123">Busca software malintencionado.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-123">Scans for malicious software.</span></span> <span data-ttu-id="e5d8c-124">Los valores **de ScanType** son:</span><span class="sxs-lookup"><span data-stu-id="e5d8c-124">Values for **ScanType** are:</span></span><p><span data-ttu-id="e5d8c-125">**0** Valor predeterminado, según la configuración</span><span class="sxs-lookup"><span data-stu-id="e5d8c-125">**0** Default, according to your configuration</span></span><p><span data-ttu-id="e5d8c-126">**1** Examen rápido</span><span class="sxs-lookup"><span data-stu-id="e5d8c-126">**1** Quick scan</span></span><p><span data-ttu-id="e5d8c-127">**2** Examen completo</span><span class="sxs-lookup"><span data-stu-id="e5d8c-127">**2** Full scan</span></span><p><span data-ttu-id="e5d8c-128">**3** Examen personalizado de archivos y directorios.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-128">**3** File and directory custom scan.</span></span><p><span data-ttu-id="e5d8c-129">CpuThrottling se ejecuta según las configuraciones de directivas</span><span class="sxs-lookup"><span data-stu-id="e5d8c-129">CpuThrottling runs according to policy configurations</span></span> |
| `-Trace [-Grouping #] [-Level #]` | <span data-ttu-id="e5d8c-130">Inicia el seguimiento de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="e5d8c-130">Starts diagnostic tracing</span></span> |
| `-GetFiles [-SupportLogLocation <path>]` | <span data-ttu-id="e5d8c-131">Recopila información de soporte técnico.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-131">Collects support information.</span></span> <span data-ttu-id="e5d8c-132">Vea '[collecting diagnostic data](collect-diagnostic-data.md)'</span><span class="sxs-lookup"><span data-stu-id="e5d8c-132">See '[collecting diagnostic data](collect-diagnostic-data.md)'</span></span>  |
| `-GetFilesDiagTrack`  | <span data-ttu-id="e5d8c-133">Igual que `-GetFiles` , pero salidas a la carpeta temporal de DiagTrack</span><span class="sxs-lookup"><span data-stu-id="e5d8c-133">Same as `-GetFiles`, but outputs to temporary DiagTrack folder</span></span> |
| `-RemoveDefinitions [-All]` | <span data-ttu-id="e5d8c-134">Restaura la inteligencia de seguridad instalada a una copia de seguridad anterior o al conjunto predeterminado original</span><span class="sxs-lookup"><span data-stu-id="e5d8c-134">Restores the installed Security intelligence to a previous backup copy or to the original default set</span></span> |
| `-RemoveDefinitions [-DynamicSignatures]` | <span data-ttu-id="e5d8c-135">Quita solo la inteligencia de seguridad descargada dinámicamente</span><span class="sxs-lookup"><span data-stu-id="e5d8c-135">Removes only the dynamically downloaded Security intelligence</span></span> |
| `-RemoveDefinitions [-Engine]` | <span data-ttu-id="e5d8c-136">Restaura el motor instalado anterior</span><span class="sxs-lookup"><span data-stu-id="e5d8c-136">Restores the previous installed engine</span></span> |
| `-SignatureUpdate [-UNC \| -MMPC]` | <span data-ttu-id="e5d8c-137">Comprueba si hay nuevas actualizaciones de inteligencia de seguridad</span><span class="sxs-lookup"><span data-stu-id="e5d8c-137">Checks for new Security intelligence updates</span></span> |
| `-Restore  [-ListAll \| [[-Name <name>] [-All] \| [-FilePath <filePath>]] [-Path <path>]]` | <span data-ttu-id="e5d8c-138">Restaura o enumera elementos en cuarentena</span><span class="sxs-lookup"><span data-stu-id="e5d8c-138">Restores or lists quarantined item(s)</span></span> |
| `-AddDynamicSignature [-Path]` | <span data-ttu-id="e5d8c-139">Carga inteligencia de seguridad dinámica</span><span class="sxs-lookup"><span data-stu-id="e5d8c-139">Loads dynamic Security intelligence</span></span> |
| `-ListAllDynamicSignatures` | <span data-ttu-id="e5d8c-140">Enumera la inteligencia de seguridad dinámica cargada</span><span class="sxs-lookup"><span data-stu-id="e5d8c-140">Lists the loaded dynamic Security intelligence</span></span> |
| `-RemoveDynamicSignature [-SignatureSetID]` | <span data-ttu-id="e5d8c-141">Quita la inteligencia de seguridad dinámica</span><span class="sxs-lookup"><span data-stu-id="e5d8c-141">Removes dynamic Security intelligence</span></span> |
| `-CheckExclusion -path <path>` | <span data-ttu-id="e5d8c-142">Comprueba si se excluye una ruta de acceso</span><span class="sxs-lookup"><span data-stu-id="e5d8c-142">Checks whether a path is excluded</span></span> |
| `-ValidateMapsConnection` | <span data-ttu-id="e5d8c-143">Comprueba que la red se puede comunicar con el Antivirus de Microsoft Defender de nube.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-143">Verifies that your network can communicate with the Microsoft Defender Antivirus cloud service.</span></span> <span data-ttu-id="e5d8c-144">Este comando solo funcionará en Windows 10 versión 1703 o posterior.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-144">This command will only work on Windows 10, version 1703 or higher.</span></span>|

## <a name="common-errors-in-running-commands-via-mpcmdrunexe"></a><span data-ttu-id="e5d8c-145">Errores comunes al ejecutar comandos mediante mpcmdrun.exe</span><span class="sxs-lookup"><span data-stu-id="e5d8c-145">Common errors in running commands via mpcmdrun.exe</span></span> 

<span data-ttu-id="e5d8c-146">En la tabla siguiente se enumeran los errores comunes que pueden producirse al usar la herramienta MpCmdRun.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-146">The following table lists common errors that can occur while using the MpCmdRun tool.</span></span>

|<span data-ttu-id="e5d8c-147">Mensaje de error</span><span class="sxs-lookup"><span data-stu-id="e5d8c-147">Error message</span></span> | <span data-ttu-id="e5d8c-148">Posible motivo</span><span class="sxs-lookup"><span data-stu-id="e5d8c-148">Possible reason</span></span> |
|:----|:----|
| <span data-ttu-id="e5d8c-149">**Error en ValidateMapsConnection (800106BA)** **o 0x800106BA**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-149">**ValidateMapsConnection failed (800106BA)** or **0x800106BA**</span></span> | <span data-ttu-id="e5d8c-150">El Antivirus de Microsoft Defender está deshabilitado.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-150">The Microsoft Defender Antivirus service is disabled.</span></span> <span data-ttu-id="e5d8c-151">Habilite el servicio e inténtelo de nuevo.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-151">Enable the service and try again.</span></span> <span data-ttu-id="e5d8c-152">Si necesita ayuda para volver a habilitar Antivirus de Microsoft Defender, vea [Reinstall/enable Antivirus de Microsoft Defender on your endpoints](switch-to-microsoft-defender-setup.md#reinstallenable-microsoft-defender-antivirus-on-your-endpoints).</span><span class="sxs-lookup"><span data-stu-id="e5d8c-152">If you need help re-enabling Microsoft Defender Antivirus, see [Reinstall/enable Microsoft Defender Antivirus on your endpoints](switch-to-microsoft-defender-setup.md#reinstallenable-microsoft-defender-antivirus-on-your-endpoints).</span></span><p>   <span data-ttu-id="e5d8c-153">**SUGERENCIA**  En Windows 10 1909 o versiones anteriores, y Windows Server 2019 o versiones anteriores, el servicio se llamaba *anteriormente Antivirus de Windows Defender*.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-153">**TIP**  In Windows 10 1909 or older, and Windows Server 2019 or older, the service was formerly called *Windows Defender Antivirus*.</span></span> |
| <span data-ttu-id="e5d8c-154">**0x80070667**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-154">**0x80070667**</span></span> | <span data-ttu-id="e5d8c-155">Está ejecutando el comando desde un equipo que Windows 10 versión 1607 o anterior, o Windows Server 2016 `-ValidateMapsConnection` o posterior.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-155">You're running the `-ValidateMapsConnection` command from a computer that is Windows 10 version 1607 or older, or Windows Server 2016 or older.</span></span> <span data-ttu-id="e5d8c-156">Ejecute el comando desde un equipo que Windows 10 versión 1703 o posterior, o Windows Server 2019 o posterior.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-156">Run the command from a machine that is Windows 10 version 1703 or newer, or Windows Server 2019 or newer.</span></span>|
| <span data-ttu-id="e5d8c-157">**MpCmdRun no se reconoce como un comando interno o externo, un programa operable o un archivo por lotes.**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-157">**MpCmdRun is not recognized as an internal or external command, operable program, or batch file.**</span></span> | <span data-ttu-id="e5d8c-158">La herramienta debe ejecutarse desde cualquiera o (donde podría diferir ya que las actualizaciones de la plataforma `%ProgramFiles%\Windows Defender` `C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2012.4-0` son `2012.4-0` mensuales excepto marzo)</span><span class="sxs-lookup"><span data-stu-id="e5d8c-158">The tool must be run from either `%ProgramFiles%\Windows Defender` or `C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2012.4-0` (where `2012.4-0` might differ since platform updates are monthly except for March)</span></span>|
| <span data-ttu-id="e5d8c-159">**ValidateMapsConnection no pudo establecer una conexión a MAPS (hr=80070005 httpcode=450)**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-159">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80070005 httpcode=450)**</span></span> | <span data-ttu-id="e5d8c-160">El comando se intentó con privilegios insuficientes.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-160">The command was attempted using insufficient privileges.</span></span> <span data-ttu-id="e5d8c-161">Use el símbolo del sistema (cmd.exe) como administrador.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-161">Use the command prompt (cmd.exe) as an administrator.</span></span>|
| <span data-ttu-id="e5d8c-162">**ValidateMapsConnection no pudo establecer una conexión a MAPS (hr=80070006 httpcode=451)**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-162">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80070006 httpcode=451)**</span></span> | <span data-ttu-id="e5d8c-163">El firewall bloquea la conexión o realiza una inspección SSL.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-163">The firewall is blocking the connection or conducting SSL inspection.</span></span> |
| <span data-ttu-id="e5d8c-164">**ValidateMapsConnection no pudo establecer una conexión a MAPS (hr=80004005 httpcode=450)**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-164">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80004005 httpcode=450)**</span></span> | <span data-ttu-id="e5d8c-165">Posibles problemas relacionados con la red, como problemas de resolución de nombres</span><span class="sxs-lookup"><span data-stu-id="e5d8c-165">Possible network-related issues, like name resolution problems</span></span>|
| <span data-ttu-id="e5d8c-166">**ValidateMapsConnection no pudo establecer una conexión a MAPS (hr=0x80508015**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-166">**ValidateMapsConnection failed to establish a connection to MAPS (hr=0x80508015**</span></span> | <span data-ttu-id="e5d8c-167">El firewall bloquea la conexión o realiza una inspección SSL.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-167">The firewall is blocking the connection or conducting SSL inspection.</span></span> |
| <span data-ttu-id="e5d8c-168">**ValidateMapsConnection no pudo establecer una conexión a MAPS (hr=800722F0D**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-168">**ValidateMapsConnection failed to establish a connection to MAPS (hr=800722F0D**</span></span> | <span data-ttu-id="e5d8c-169">El firewall bloquea la conexión o realiza una inspección SSL.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-169">The firewall is blocking the connection or conducting SSL inspection.</span></span> |
| <span data-ttu-id="e5d8c-170">**ValidateMapsConnection no pudo establecer una conexión a MAPS (hr=80072EE7 httpcode=451)**</span><span class="sxs-lookup"><span data-stu-id="e5d8c-170">**ValidateMapsConnection failed to establish a connection to MAPS (hr=80072EE7 httpcode=451)**</span></span> | <span data-ttu-id="e5d8c-171">El firewall bloquea la conexión o realiza una inspección SSL.</span><span class="sxs-lookup"><span data-stu-id="e5d8c-171">The firewall is blocking the connection or conducting SSL inspection.</span></span> |

## <a name="see-also"></a><span data-ttu-id="e5d8c-172">Vea también</span><span class="sxs-lookup"><span data-stu-id="e5d8c-172">See also</span></span>

- [<span data-ttu-id="e5d8c-173">Configurar las funciones del Antivirus de Microsoft Defender</span><span class="sxs-lookup"><span data-stu-id="e5d8c-173">Configure Microsoft Defender Antivirus features</span></span>](configure-microsoft-defender-antivirus-features.md)
- [<span data-ttu-id="e5d8c-174">Configurar y validar las conexiones de red del Antivirus de Windows Defender</span><span class="sxs-lookup"><span data-stu-id="e5d8c-174">Configure and validate Microsoft Defender Antivirus network connections</span></span>](configure-network-connections-microsoft-defender-antivirus.md)
- [<span data-ttu-id="e5d8c-175">Temas de referencia para herramientas de administración y configuración</span><span class="sxs-lookup"><span data-stu-id="e5d8c-175">Reference topics for management and configuration tools</span></span>](configuration-management-reference-microsoft-defender-antivirus.md)
